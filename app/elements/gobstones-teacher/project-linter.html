<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../scripts/behaviors/busListenerBehavior.html">
<link rel="import" href="../../scripts/behaviors/localizationBehavior.html">

<dom-module id="project-linter">
  <style>
    .container {
      margin: 0 auto;
    }

    .check-title {
      margin-block-end: 0;
    }

    .check-success {
      color: green;
    }

    .check-error {
      color: red;
    }

    .check-warning {
      color: #efb200;
    }
  </style>

  <template>
    <h1>Validando proyecto...</h1>
    <div class="container">
      <template is="dom-if" if="[[ _pendingChecks() ]]">
        <h3>Se est√°n ejecutando los chequeos.</h3>
      </template>

      <template is="dom-if" if="[[ !_pendingChecks() ]]">
        <template is="dom-if" if="[[ _anyError(checks) ]]">
          <template is="dom-repeat" items="[[failedChecks]]">
            <div>
              <h3 class="check-title">
                <iron-icon icon="icons:{{item.level}}" class$="check-{{item.level}}"></iron-icon>
                <span>{{_errorTitle(item)}}</span>
              </h3>
              <span>{{_errorDescription(item)}}</span>
            </div>
          </template>
        </template>

        <template is="dom-if" if="[[ !_anyError(checks) ]]">
          <div>
            <h3 class="check-title">
              <iron-icon icon="icons:check-circle" class="check-success"></iron-icon>
              <span>[[localize("check-no-errors")]]</span>
            </h3>
          </div>
        </template>
      </template>
    </div>
  </template>

  <script>

    Polymer({
      is: 'project-linter',
      behaviors: [
        Polymer.LocalizationBehavior,
        Polymer.BusListenerBehavior
      ],
      properties: {
        failedChecks: {
          type: Array,
          default: []
        },
        checks: {
          type: Number,
          default: 0
        }
      },

      ready: function() {
        this.subscribeTo("compilation-error", () => {
          this.push('failedChecks', {
            name: 'check-student-code-error',
            level: 'error'
          });

          this.checks++;
        });

        this.subscribeTo("project-linter-start", this.reset.bind(this));
      },

      reset: function() {
        this.set('failedChecks', []);
        this.checks = 0;
      },

      _anyError: function(checks) {
        return checks > 0;
      },

      _errorTitle: function(error) {
        return this.localize(`${error.name}-title`);
      },

      _errorDescription: function(error) {
        return this.localize(`${error.name}-description`);
      },

      _pendingChecks: function() {
        return false;
      }
    });

  </script>
</dom-module>
