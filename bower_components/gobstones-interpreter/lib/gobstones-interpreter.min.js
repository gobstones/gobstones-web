!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("gobstones-interpreter",[],e):"object"==typeof exports?exports["gobstones-interpreter"]=e():t["gobstones-interpreter"]=e()}(this,function(){return function(t){function e(n){if(r[n])return r[n].exports;var i=r[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,e),i.l=!0,i.exports}var r={};return e.m=t,e.c=r,e.d=function(t,r,n){e.o(t,r)||Object.defineProperty(t,r,{configurable:!1,enumerable:!0,get:n})},e.n=function(t){var r=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(r,"a",r),r},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=10)}([function(t,e,r){"use strict";function n(t){return l[c][t]}function i(t,e){if(!(t in l))throw Error("Invalid language code: "+t);var r=c;c=t;try{return e()}finally{c=r}}function o(t){return n("<position>")(t.filename,t.line,t.column)}Object.defineProperty(e,"__esModule",{value:!0}),e.i18n=n,e.i18nWithLanguage=i,e.i18nPosition=o;var a=r(7),s=r(11),u=r(12),c="es",l={es:a.LOCALE_ES,en:s.LOCALE_EN,pt:u.LOCALE_PT}},function(t,e,r){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0}),e.GbsRuntimeError=e.GbsSyntaxError=e.GbsWarning=e.GbsInterpreterException=void 0;var a=r(0),s=e.GbsInterpreterException=function(t){function e(t,r,o,s,u){n(this,e);var c=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,s,t.filename,t.row));return c.isGobstonesException=!0,c.startPos=t,c.endPos=r,c.reason=s,c.args=u,c.message="boom-called"===s?u[0]:(0,a.i18n)(o+":"+s),u.length>0&&"function"==typeof c.message&&(c.message=c.message.apply(null,u)),c}return o(e,t),e}(Error);e.GbsWarning=function(t){function e(t,r,o,a){return n(this,e),i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,r,"warning",o,a))}return o(e,t),e}(s),e.GbsSyntaxError=function(t){function e(t,r,o,a){return n(this,e),i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,r,"errmsg",o,a))}return o(e,t),e}(s),e.GbsRuntimeError=function(t){function e(t,r,o,a){return n(this,e),i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,r,"errmsg",o,a))}return o(e,t),e}(s)},function(t,e,r){"use strict";function n(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t){var e=[],r=!0,n=!1,i=void 0;try{for(var o,a=t.split("\n")[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){var s=o.value;e.push("  "+s)}}catch(t){n=!0,i=t}finally{try{!r&&a.return&&a.return()}finally{if(n)throw i}}return e.join("\n")}function s(t){return null===t?"null":t instanceof Array?"[\n"+Y(t).join(",\n")+"\n]":t instanceof l.Token?t.toString():Symbol.keyFor(t.tag).substring(2)+"(\n"+Y(t.children).join(",\n")+"\n)"}Object.defineProperty(e,"__esModule",{value:!0}),e.ASTConstructorDeclaration=e.ASTFieldBinding=e.ASTExprFunctionCall=e.ASTExprStructureUpdate=e.ASTExprStructure=e.ASTExprTuple=e.ASTExprRange=e.ASTExprList=e.ASTExprMatching=e.ASTExprChoose=e.ASTExprConstantString=e.ASTExprConstantNumber=e.ASTExprVariable=e.ASTPatternTimeout=e.ASTPatternTuple=e.ASTPatternStructure=e.ASTPatternNumber=e.ASTPatternVariable=e.ASTPatternWildcard=e.ASTStmtProcedureCall=e.ASTStmtAssignTuple=e.ASTStmtAssignVariable=e.ASTMatchingBranch=e.ASTSwitchBranch=e.ASTStmtSwitch=e.ASTStmtWhile=e.ASTStmtForeach=e.ASTStmtRepeat=e.ASTStmtIf=e.ASTStmtReturn=e.ASTStmtBlock=e.ASTDefType=e.ASTDefFunction=e.ASTDefProcedure=e.ASTDefInteractiveProgram=e.ASTDefProgram=e.ASTMain=e.ASTNode=e.N_ConstructorDeclaration=e.N_FieldBinding=e.N_MatchingBranch=e.N_SwitchBranch=e.N_ExprFunctionCall=e.N_ExprStructureUpdate=e.N_ExprStructure=e.N_ExprTuple=e.N_ExprRange=e.N_ExprList=e.N_ExprMatching=e.N_ExprChoose=e.N_ExprConstantString=e.N_ExprConstantNumber=e.N_ExprVariable=e.N_PatternTimeout=e.N_PatternTuple=e.N_PatternStructure=e.N_PatternNumber=e.N_PatternVariable=e.N_PatternWildcard=e.N_StmtProcedureCall=e.N_StmtAssignTuple=e.N_StmtAssignVariable=e.N_StmtSwitch=e.N_StmtWhile=e.N_StmtForeach=e.N_StmtRepeat=e.N_StmtIf=e.N_StmtReturn=e.N_StmtBlock=e.N_DefType=e.N_DefFunction=e.N_DefProcedure=e.N_DefInteractiveProgram=e.N_DefProgram=e.N_Main=void 0;var u=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),c=r(6),l=r(3),h=e.N_Main=Symbol.for("N_Main"),p=e.N_DefProgram=Symbol.for("N_DefProgram"),f=e.N_DefInteractiveProgram=Symbol.for("N_DefInteractiveProgram"),_=e.N_DefProcedure=Symbol.for("N_DefProcedure"),m=e.N_DefFunction=Symbol.for("N_DefFunction"),d=e.N_DefType=Symbol.for("N_DefType"),v=e.N_StmtBlock=Symbol.for("N_StmtBlock"),y=e.N_StmtReturn=Symbol.for("N_StmtReturn"),g=e.N_StmtIf=Symbol.for("N_StmtIf"),b=e.N_StmtRepeat=Symbol.for("N_StmtRepeat"),T=e.N_StmtForeach=Symbol.for("N_StmtForeach"),P=e.N_StmtWhile=Symbol.for("N_StmtWhile"),S=e.N_StmtSwitch=Symbol.for("N_StmtSwitch"),k=e.N_StmtAssignVariable=Symbol.for("N_StmtAssignVariable"),E=e.N_StmtAssignTuple=Symbol.for("N_StmtAssignTuple"),w=e.N_StmtProcedureCall=Symbol.for("N_StmtProcedureCall"),I=e.N_PatternWildcard=Symbol.for("N_PatternWildcard"),N=e.N_PatternVariable=Symbol.for("N_PatternVariable"),C=e.N_PatternNumber=Symbol.for("N_PatternNumber"),R=e.N_PatternStructure=Symbol.for("N_PatternStructure"),O=e.N_PatternTuple=Symbol.for("N_PatternTuple"),x=e.N_PatternTimeout=Symbol.for("N_PatternTimeout"),A=e.N_ExprVariable=Symbol.for("N_ExprVariable"),L=e.N_ExprConstantNumber=Symbol.for("N_ExprConstantNumber"),F=e.N_ExprConstantString=Symbol.for("N_ExprConstantString"),M=e.N_ExprChoose=Symbol.for("N_ExprChoose"),D=e.N_ExprMatching=Symbol.for("N_ExprMatching"),V=e.N_ExprList=Symbol.for("N_ExprList"),B=e.N_ExprRange=Symbol.for("N_ExprRange"),j=e.N_ExprTuple=Symbol.for("N_ExprTuple"),U=e.N_ExprStructure=Symbol.for("N_ExprStructure"),W=e.N_ExprStructureUpdate=Symbol.for("N_ExprStructureUpdate"),G=e.N_ExprFunctionCall=Symbol.for("N_ExprFunctionCall"),q=e.N_SwitchBranch=Symbol.for("N_SwitchBranch"),J=e.N_MatchingBranch=Symbol.for("N_MatchingBranch"),H=e.N_FieldBinding=Symbol.for("N_FieldBinding"),z=e.N_ConstructorDeclaration=Symbol.for("N_ConstructorDeclaration"),Y=void 0;Y=function(t){var e=[],r=!0,n=!1,i=void 0;try{for(var o,u=t[Symbol.iterator]();!(r=(o=u.next()).done);r=!0){var c=o.value;e.push(a(s(c)))}}catch(t){n=!0,i=t}finally{try{!r&&u.return&&u.return()}finally{if(n)throw i}}return e};var K=e.ASTNode=function(){function t(e,r){if(o(this,t),this._tag=e,this._children=r,this._startPos=c.UnknownPosition,this._endPos=c.UnknownPosition,this._attributes={},!(r instanceof Array))throw Error("The children of an ASTNode should be an array.")}return u(t,[{key:"toMulangLike",value:function(){return{tag:this._tag.toString().replace(/(^Symbol\(|\)$)/g,""),contents:this._children.map(function(e){return null===e?"null":e instanceof Array?new t(Symbol("?"),e).toMulangLike().contents:e instanceof t?e.toMulangLike():e instanceof l.Token?e.toString():"?"})}}},{key:"toString",value:function(){return s(this)}},{key:"tag",get:function(){return this._tag}},{key:"children",get:function(){return this._children}},{key:"startPos",set:function(t){this._startPos=t},get:function(){return this._startPos}},{key:"endPos",set:function(t){this._endPos=t},get:function(){return this._endPos}},{key:"attributes",get:function(){return this._attributes},set:function(t){this._attributes=t}}]),t}();e.ASTMain=function(t){function e(t){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,h,t))}return i(e,t),u(e,[{key:"definitions",get:function(){return this._children}}]),e}(K),e.ASTDefProgram=function(t){function e(t){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,p,[t]))}return i(e,t),u(e,[{key:"body",get:function(){return this.children[0]}}]),e}(K),e.ASTDefInteractiveProgram=function(t){function e(t){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,f,t))}return i(e,t),u(e,[{key:"branches",get:function(){return this.children}}]),e}(K),e.ASTDefProcedure=function(t){function e(t,r,i){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,_,[t,r,i]))}return i(e,t),u(e,[{key:"name",get:function(){return this.children[0]}},{key:"parameters",get:function(){return this.children[1]}},{key:"body",get:function(){return this.children[2]}}]),e}(K),e.ASTDefFunction=function(t){function e(t,r,i){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,m,[t,r,i]))}return i(e,t),u(e,[{key:"name",get:function(){return this.children[0]}},{key:"parameters",get:function(){return this.children[1]}},{key:"body",get:function(){return this.children[2]}}]),e}(K),e.ASTDefType=function(t){function e(t,r){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,d,[t,r]))}return i(e,t),u(e,[{key:"typeName",get:function(){return this._children[0]}},{key:"constructorDeclarations",get:function(){return this._children[1]}}]),e}(K),e.ASTStmtBlock=function(t){function e(t){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,v,t))}return i(e,t),u(e,[{key:"statements",get:function(){return this.children}}]),e}(K),e.ASTStmtReturn=function(t){function e(t){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,y,[t]))}return i(e,t),u(e,[{key:"result",get:function(){return this.children[0]}}]),e}(K),e.ASTStmtIf=function(t){function e(t,r,i){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,g,[t,r,i]))}return i(e,t),u(e,[{key:"condition",get:function(){return this._children[0]}},{key:"thenBlock",get:function(){return this._children[1]}},{key:"elseBlock",get:function(){return this._children[2]}}]),e}(K),e.ASTStmtRepeat=function(t){function e(t,r){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,b,[t,r]))}return i(e,t),u(e,[{key:"times",get:function(){return this._children[0]}},{key:"body",get:function(){return this._children[1]}}]),e}(K),e.ASTStmtForeach=function(t){function e(t,r,i){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,T,[t,r,i]))}return i(e,t),u(e,[{key:"pattern",get:function(){return this._children[0]}},{key:"range",get:function(){return this._children[1]}},{key:"body",get:function(){return this._children[2]}}]),e}(K),e.ASTStmtWhile=function(t){function e(t,r){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,P,[t,r]))}return i(e,t),u(e,[{key:"condition",get:function(){return this._children[0]}},{key:"body",get:function(){return this._children[1]}}]),e}(K),e.ASTStmtSwitch=function(t){function e(t,r){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,S,[t,r]))}return i(e,t),u(e,[{key:"subject",get:function(){return this._children[0]}},{key:"branches",get:function(){return this._children[1]}}]),e}(K),e.ASTSwitchBranch=function(t){function e(t,r){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,q,[t,r]))}return i(e,t),u(e,[{key:"pattern",get:function(){return this._children[0]}},{key:"body",get:function(){return this._children[1]}}]),e}(K),e.ASTMatchingBranch=function(t){function e(t,r){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,J,[t,r]))}return i(e,t),u(e,[{key:"pattern",get:function(){return this._children[0]}},{key:"body",get:function(){return this._children[1]}}]),e}(K),e.ASTStmtAssignVariable=function(t){function e(t,r){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,k,[t,r]))}return i(e,t),u(e,[{key:"variable",get:function(){return this._children[0]}},{key:"value",get:function(){return this._children[1]}}]),e}(K),e.ASTStmtAssignTuple=function(t){function e(t,r){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,E,[t,r]))}return i(e,t),u(e,[{key:"variables",get:function(){return this._children[0]}},{key:"value",get:function(){return this._children[1]}}]),e}(K),e.ASTStmtProcedureCall=function(t){function e(t,r){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,w,[t,r]))}return i(e,t),u(e,[{key:"procedureName",get:function(){return this._children[0]}},{key:"args",get:function(){return this._children[1]}}]),e}(K),e.ASTPatternWildcard=function(t){function e(){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,I,[]))}return i(e,t),u(e,[{key:"boundVariables",get:function(){return[]}}]),e}(K),e.ASTPatternVariable=function(t){function e(t){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,N,[t]))}return i(e,t),u(e,[{key:"variableName",get:function(){return this._children[0]}},{key:"boundVariables",get:function(){return[this._children[0]]}}]),e}(K),e.ASTPatternNumber=function(t){function e(t){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,C,[t]))}return i(e,t),u(e,[{key:"number",get:function(){return this._children[0]}},{key:"boundVariables",get:function(){return[]}}]),e}(K),e.ASTPatternStructure=function(t){function e(t,r){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,R,[t,r]))}return i(e,t),u(e,[{key:"constructorName",get:function(){return this._children[0]}},{key:"boundVariables",get:function(){return this._children[1]}}]),e}(K),e.ASTPatternTuple=function(t){function e(t){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,O,t))}return i(e,t),u(e,[{key:"boundVariables",get:function(){return this._children}}]),e}(K),e.ASTPatternTimeout=function(t){function e(t){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,x,[t]))}return i(e,t),u(e,[{key:"boundVariables",get:function(){return[]}},{key:"timeout",get:function(){return parseInt(this._children[0].value,10)}}]),e}(K),e.ASTExprVariable=function(t){function e(t){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,A,[t]))}return i(e,t),u(e,[{key:"variableName",get:function(){return this._children[0]}}]),e}(K),e.ASTExprConstantNumber=function(t){function e(t){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,L,[t]))}return i(e,t),u(e,[{key:"number",get:function(){return this._children[0]}}]),e}(K),e.ASTExprConstantString=function(t){function e(t){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,F,[t]))}return i(e,t),u(e,[{key:"string",get:function(){return this._children[0]}}]),e}(K),e.ASTExprChoose=function(t){function e(t,r,i){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,M,[t,r,i]))}return i(e,t),u(e,[{key:"condition",get:function(){return this._children[0]}},{key:"trueExpr",get:function(){return this._children[1]}},{key:"falseExpr",get:function(){return this._children[2]}}]),e}(K),e.ASTExprMatching=function(t){function e(t,r){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,D,[t,r]))}return i(e,t),u(e,[{key:"subject",get:function(){return this._children[0]}},{key:"branches",get:function(){return this._children[1]}}]),e}(K),e.ASTExprList=function(t){function e(t){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,V,t))}return i(e,t),u(e,[{key:"elements",get:function(){return this._children}}]),e}(K),e.ASTExprRange=function(t){function e(t,r,i){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,B,[t,r,i]))}return i(e,t),u(e,[{key:"first",get:function(){return this._children[0]}},{key:"second",get:function(){return this._children[1]}},{key:"last",get:function(){return this._children[2]}}]),e}(K),e.ASTExprTuple=function(t){function e(t){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,j,t))}return i(e,t),u(e,[{key:"elements",get:function(){return this.children}}]),e}(K),e.ASTExprStructure=function(t){function e(t,r){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,U,[t,r]))}return i(e,t),u(e,[{key:"fieldNames",value:function(){var t=[],e=!0,r=!1,n=void 0;try{for(var i,o=this.fieldBindings[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var a=i.value;t.push(a.fieldName.value)}}catch(t){r=!0,n=t}finally{try{!e&&o.return&&o.return()}finally{if(r)throw n}}return t}},{key:"constructorName",get:function(){return this._children[0]}},{key:"fieldBindings",get:function(){return this._children[1]}}]),e}(K),e.ASTExprStructureUpdate=function(t){function e(t,r,i){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,W,[t,r,i]))}return i(e,t),u(e,[{key:"fieldNames",value:function(){var t=[],e=!0,r=!1,n=void 0;try{for(var i,o=this.fieldBindings[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var a=i.value;t.push(a.fieldName.value)}}catch(t){r=!0,n=t}finally{try{!e&&o.return&&o.return()}finally{if(r)throw n}}return t}},{key:"constructorName",get:function(){return this._children[0]}},{key:"original",get:function(){return this._children[1]}},{key:"fieldBindings",get:function(){return this._children[2]}}]),e}(K),e.ASTExprFunctionCall=function(t){function e(t,r){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,G,[t,r]))}return i(e,t),u(e,[{key:"functionName",get:function(){return this._children[0]}},{key:"args",get:function(){return this._children[1]}}]),e}(K),e.ASTFieldBinding=function(t){function e(t,r){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,H,[t,r]))}return i(e,t),u(e,[{key:"fieldName",get:function(){return this._children[0]}},{key:"value",get:function(){return this._children[1]}}]),e}(K),e.ASTConstructorDeclaration=function(t){function e(t,r){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,z,[t,r]))}return i(e,t),u(e,[{key:"constructorName",get:function(){return this._children[0]}},{key:"fieldNames",get:function(){return this._children[1]}}]),e}(K)},function(t,e,r){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}();e.T_EOF=Symbol.for("T_EOF"),e.T_NUM=Symbol.for("T_NUM"),e.T_STRING=Symbol.for("T_STRING"),e.T_UPPERID=Symbol.for("T_UPPERID"),e.T_LOWERID=Symbol.for("T_LOWERID"),e.T_PROGRAM=Symbol.for("T_PROGRAM"),e.T_INTERACTIVE=Symbol.for("T_INTERACTIVE"),e.T_PROCEDURE=Symbol.for("T_PROCEDURE"),e.T_FUNCTION=Symbol.for("T_FUNCTION"),e.T_RETURN=Symbol.for("T_RETURN"),e.T_IF=Symbol.for("T_IF"),e.T_THEN=Symbol.for("T_THEN"),e.T_ELSEIF=Symbol.for("T_ELSEIF"),e.T_ELSE=Symbol.for("T_ELSE"),e.T_CHOOSE=Symbol.for("T_CHOOSE"),e.T_WHEN=Symbol.for("T_WHEN"),e.T_OTHERWISE=Symbol.for("T_OTHERWISE"),e.T_MATCHING=Symbol.for("T_MATCHING"),e.T_SELECT=Symbol.for("T_SELECT"),e.T_ON=Symbol.for("T_ON"),e.T_REPEAT=Symbol.for("T_REPEAT"),e.T_FOREACH=Symbol.for("T_FOREACH"),e.T_IN=Symbol.for("T_IN"),e.T_WHILE=Symbol.for("T_WHILE"),e.T_SWITCH=Symbol.for("T_SWITCH"),e.T_TO=Symbol.for("T_TO"),e.T_LET=Symbol.for("T_LET"),e.T_NOT=Symbol.for("T_NOT"),e.T_DIV=Symbol.for("T_DIV"),e.T_MOD=Symbol.for("T_MOD"),e.T_TYPE=Symbol.for("T_TYPE"),e.T_IS=Symbol.for("T_IS"),e.T_RECORD=Symbol.for("T_RECORD"),e.T_VARIANT=Symbol.for("T_VARIANT"),e.T_CASE=Symbol.for("T_CASE"),e.T_FIELD=Symbol.for("T_FIELD"),e.T_UNDERSCORE=Symbol.for("T_UNDERSCORE"),e.T_TIMEOUT=Symbol.for("T_TIMEOUT"),e.T_LPAREN=Symbol.for("T_LPAREN"),e.T_RPAREN=Symbol.for("T_RPAREN"),e.T_LBRACE=Symbol.for("T_LBRACE"),e.T_RBRACE=Symbol.for("T_RBRACE"),e.T_LBRACK=Symbol.for("T_LBRACK"),e.T_RBRACK=Symbol.for("T_RBRACK"),e.T_COMMA=Symbol.for("T_COMMA"),e.T_SEMICOLON=Symbol.for("T_SEMICOLON"),e.T_ELLIPSIS=Symbol.for("T_ELLIPSIS"),e.T_RANGE=Symbol.for("T_RANGE"),e.T_GETS=Symbol.for("T_GETS"),e.T_PIPE=Symbol.for("T_PIPE"),e.T_ARROW=Symbol.for("T_ARROW"),e.T_ASSIGN=Symbol.for("T_ASSIGN"),e.T_EQ=Symbol.for("T_EQ"),e.T_NE=Symbol.for("T_NE"),e.T_LE=Symbol.for("T_LE"),e.T_GE=Symbol.for("T_GE"),e.T_LT=Symbol.for("T_LT"),e.T_GT=Symbol.for("T_GT"),e.T_AND=Symbol.for("T_AND"),e.T_OR=Symbol.for("T_OR"),e.T_CONCAT=Symbol.for("T_CONCAT"),e.T_PLUS=Symbol.for("T_PLUS"),e.T_MINUS=Symbol.for("T_MINUS"),e.T_TIMES=Symbol.for("T_TIMES"),e.T_POW=Symbol.for("T_POW"),e.Token=function(){function t(e,r,i,o){n(this,t),this._tag=e,this._value=r,this._startPos=i,this._endPos=o}return i(t,[{key:"toString",value:function(){var t=Symbol.keyFor(this._tag).substring(2);switch(t){case"NUM":case"STRING":case"UPPERID":case"LOWERID":return t+'("'+this._value+'")';default:return t}}},{key:"tag",get:function(){return this._tag}},{key:"value",get:function(){return this._value}},{key:"startPos",get:function(){return this._startPos}},{key:"endPos",get:function(){return this._endPos}}]),t}()},function(t,e,r){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e,r,n){throw new J.GbsRuntimeError(t,e,r,n)}function o(){return[(0,G.i18n)("CONS:False"),(0,G.i18n)("CONS:True")]}function a(){return[(0,G.i18n)("CONS:Color0"),(0,G.i18n)("CONS:Color1"),(0,G.i18n)("CONS:Color2"),(0,G.i18n)("CONS:Color3")]}function s(){return[(0,G.i18n)("CONS:Dir0"),(0,G.i18n)("CONS:Dir1"),(0,G.i18n)("CONS:Dir2"),(0,G.i18n)("CONS:Dir3")]}function u(){return[(0,G.i18n)("CONS:INIT"),(0,G.i18n)("CONS:TIMEOUT")].concat(H)}function c(t,e){return t.indexOf(e)}function l(t,e){return t[e]}function h(t){return l(s(),(c(s(),t)+2)%4)}function p(t){return l(s(),(c(s(),t)+1)%4)}function f(t){return l(s(),(c(s(),t)+3)%4)}function _(t){return l(a(),(c(a(),t)+1)%4)}function m(t){return l(a(),(c(a(),t)+3)%4)}function d(){return new q.TypeStructure((0,G.i18n)("TYPE:Bool"),{})}function v(t){return t?new q.ValueStructure((0,G.i18n)("TYPE:Bool"),(0,G.i18n)("CONS:True"),{}):new q.ValueStructure((0,G.i18n)("TYPE:Bool"),(0,G.i18n)("CONS:False"),{})}function y(t){return t.constructorName===(0,G.i18n)("CONS:True")}function g(){return new q.TypeStructure((0,G.i18n)("TYPE:Color"),{})}function b(t){return new q.ValueStructure((0,G.i18n)("TYPE:Color"),t,{})}function T(t){return t.constructorName}function P(){return new q.TypeStructure((0,G.i18n)("TYPE:Dir"),{})}function S(t){return new q.ValueStructure((0,G.i18n)("TYPE:Dir"),t,{})}function k(t){return t.constructorName}function E(t,e,r,n){}function w(t){return null!==(0,q.joinTypes)(t.type(),K)}function I(t){return null!==(0,q.joinTypes)(t.type(),d())}function N(t){return null!==(0,q.joinTypes)(t.type(),g())}function C(t){return null!==(0,q.joinTypes)(t.type(),P())}function R(){return[K,d(),P()]}function O(){return[K,d(),g(),P()]}function x(t){if(I(t))return y(t)?1:0;if(N(t))return c(a(),T(t));if(C(t))return c(s(),k(t));throw Error("Value should be Bool, Color or Dir.")}function A(t,e){return v(w(t)?t.le(e):x(t)<=x(e))}function L(t,e){return v(w(t)?t.ge(e):x(t)>=x(e))}function F(t,e){return v(w(t)?t.lt(e):x(t)<x(e))}function M(t,e){return v(w(t)?t.gt(e):x(t)>x(e))}function D(t){if(w(t))return t.add(new q.ValueInteger(1));if(I(t))return v(y(t)?!1:!0);if(N(t))return b(_(T(t)));if(C(t))return S(p(k(t)));throw Error("genericNext: value has no next.")}function V(t){if(w(t))return t.sub(new q.ValueInteger(1));if(I(t))return v(y(t)?!1:!0);if(N(t))return b(m(T(t)));if(C(t))return S(f(k(t)));throw Error("genericPrev: value has no prev.")}function B(t){if(w(t))return t.negate();if(I(t))return v(!y(t));if(C(t))return S(h(k(t)));throw Error("genericOpposite: value has no opposite.")}function j(t,e,r,n){var o=!0,a=!1,s=void 0;try{for(var u,c=n[Symbol.iterator]();!(o=(u=c.next()).done);o=!0){var l=u.value;if(null!==(0,q.joinTypes)(r.type(),l))return}}catch(t){a=!0,s=t}finally{try{!o&&c.return&&c.return()}finally{if(a)throw s}}i(t,e,"expected-value-of-some-type-but-got",[n,r.type()])}function U(t,e,r,n){null===(0,q.joinTypes)(r.type(),n.type())&&i(t,e,"expected-values-to-have-compatible-types",[r.type(),n.type()])}Object.defineProperty(e,"__esModule",{value:!0}),e.RuntimePrimitives=e.RuntimeState=void 0;var W=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}();e.boolFromValue=y,e.typesWithOpposite=R,e.typesWithOrder=O;var G=r(0),q=r(5),J=r(1),H=function(){var t=["","CTRL_","ALT_","SHIFT_","CTRL_ALT_","CTRL_SHIFT_","ALT_SHIFT_","CTRL_ALT_SHIFT_"],e=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","0","1","2","3","4","5","6","7","8","9"],r=["SPACE","RETURN","TAB","BACKSPACE","ESCAPE","INSERT","DELETE","HOME","END","PAGEUP","PAGEDOWN","F1","F2","F3","F4","F5","F6","F7","F8","F9","F10","F11","F12"],n=["AMPERSAND","ASTERISK","AT","BACKSLASH","CARET","COLON","DOLLAR","EQUALS","EXCLAIM","GREATER","HASH","LESS","PERCENT","PLUS","SEMICOLON","SLASH","QUESTION","QUOTE","QUOTEDBL","UNDERSCORE","LEFTPAREN","RIGHTPAREN","LEFTBRACKET","RIGHTBRACKET","LEFTBRACE","RIGHTBRACE"],i=["LEFT","RIGHT","UP","DOWN"],o=e.concat(r).concat(n).concat(i),a=[],s=!0,u=!1,c=void 0;try{for(var l,h=t[Symbol.iterator]();!(s=(l=h.next()).done);s=!0){var p=l.value,f=!0,_=!1,m=void 0;try{for(var d,v=o[Symbol.iterator]();!(f=(d=v.next()).done);f=!0){var y=d.value;a.push("K_"+p+y)}}catch(t){_=!0,m=t}finally{try{!f&&v.return&&v.return()}finally{if(_)throw m}}}}catch(t){u=!0,c=t}finally{try{!s&&h.return&&h.return()}finally{if(u)throw c}}return a}(),z=(e.RuntimeState=function(){function t(){n(this,t),this._width=11,this._height=7,this._board=[];for(var e=0;e<this._width;e++){for(var r=[],i=0;i<this._height;i++)r.push(this._emptyCell());this._board.push(r)}this._head={x:0,y:0}}return W(t,[{key:"clone",value:function(){var e=new t;e._width=this._width,e._height=this._height,e._board=[];for(var r=0;r<this._width;r++){for(var n=[],i=0;i<this._height;i++){var o={},s=!0,u=!1,c=void 0;try{for(var l,h=a()[Symbol.iterator]();!(s=(l=h.next()).done);s=!0){var p=l.value;o[p]=this._board[r][i][p]}}catch(t){u=!0,c=t}finally{try{!s&&h.return&&h.return()}finally{if(u)throw c}}n.push(o)}e._board.push(n)}return e._head={x:this._head.x,y:this._head.y},e}},{key:"dump",value:function(){var t={};t.width=this._width,t.height=this._height,t.head=[this._head.x,this._head.y],t.board=[];for(var e=0;e<this._width;e++){for(var r=[],n=0;n<this._height;n++){var i={};i.a=this._board[e][n][(0,G.i18n)("CONS:Color0")].asNumber(),i.n=this._board[e][n][(0,G.i18n)("CONS:Color1")].asNumber(),i.r=this._board[e][n][(0,G.i18n)("CONS:Color2")].asNumber(),i.v=this._board[e][n][(0,G.i18n)("CONS:Color3")].asNumber(),r.push(i)}t.board.push(r)}return t}},{key:"load",value:function(t){this._width=t.width,this._height=t.height,this._head.x=t.head[0],this._head.y=t.head[1],this._board=[];for(var e=0;e<this._width;e++){for(var r=[],n=0;n<this._height;n++){var i=t.board[e][n],o={};o[(0,G.i18n)("CONS:Color0")]=new q.ValueInteger(i.a),o[(0,G.i18n)("CONS:Color1")]=new q.ValueInteger(i.n),o[(0,G.i18n)("CONS:Color2")]=new q.ValueInteger(i.r),o[(0,G.i18n)("CONS:Color3")]=new q.ValueInteger(i.v),r.push(o)}this._board.push(r)}}},{key:"putStone",value:function(t){var e=this._board[this._head.x][this._head.y][t];e=e.add(new q.ValueInteger(1)),this._board[this._head.x][this._head.y][t]=e}},{key:"removeStone",value:function(t){var e=this._board[this._head.x][this._head.y][t];if(e.le(new q.ValueInteger(0)))throw Error("Cannot remove stone.");e=e.sub(new q.ValueInteger(1)),this._board[this._head.x][this._head.y][t]=e}},{key:"numStones",value:function(t){return this._board[this._head.x][this._head.y][t]}},{key:"move",value:function(t){if(!this.canMove(t))throw Error("Cannot move.");var e=this._deltaForDirection(t);this._head.x+=e[0],this._head.y+=e[1]}},{key:"goToEdge",value:function(t){if(t===(0,G.i18n)("CONS:Dir0"))this._head.y=this._height-1;else if(t===(0,G.i18n)("CONS:Dir1"))this._head.x=this._width-1;else if(t===(0,G.i18n)("CONS:Dir2"))this._head.y=0;else{if(t!==(0,G.i18n)("CONS:Dir3"))throw Error("Invalid direction: "+t);this._head.x=0}}},{key:"emptyBoardContents",value:function(){for(var t=0;t<this._width;t++)for(var e=0;e<this._height;e++)this._board[t][e]=this._emptyCell()}},{key:"canMove",value:function(t){var e=this._deltaForDirection(t),r=this._head.x+e[0],n=this._head.y+e[1];return 0<=r&&r<this._width&&0<=n&&n<this._height}},{key:"_deltaForDirection",value:function(t){var e=void 0;if(t===(0,G.i18n)("CONS:Dir0"))e=[0,1];else if(t===(0,G.i18n)("CONS:Dir1"))e=[1,0];else if(t===(0,G.i18n)("CONS:Dir2"))e=[0,-1];else{if(t!==(0,G.i18n)("CONS:Dir3"))throw Error("Invalid direction: "+t);e=[-1,0]}return e}},{key:"_emptyCell",value:function(){var t={},e=!0,r=!1,n=void 0;try{for(var i,o=a()[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){t[i.value]=new q.ValueInteger(0)}}catch(t){r=!0,n=t}finally{try{!e&&o.return&&o.return()}finally{if(r)throw n}}return t}}]),t}(),function(){function t(e,r,i){n(this,t),this._argumentTypes=e,this._argumentValidator=r,this._implementation=i}return W(t,[{key:"nargs",value:function(){return this._argumentTypes.length}},{key:"call",value:function(t,e){return this._implementation.apply(null,[t].concat(e))}},{key:"validateArguments",value:function(t,e,r,n){this._argumentValidator(t,e,r,n)}},{key:"argumentTypes",get:function(){return this._argumentTypes}}]),t}()),Y=new q.TypeAny,K=new q.TypeInteger,Z=new q.TypeString,Q=new q.TypeList(new q.TypeAny);e.RuntimePrimitives=function(){function t(){n(this,t),this._primitiveTypes={},this._primitiveProcedures={},this._primitiveFunctions={},this._primitiveTypes[(0,G.i18n)("TYPE:Bool")]={};var e=!0,r=!1,c=void 0;try{for(var l,h=o()[Symbol.iterator]();!(e=(l=h.next()).done);e=!0){var p=l.value;this._primitiveTypes[(0,G.i18n)("TYPE:Bool")][p]=[]}}catch(t){r=!0,c=t}finally{try{!e&&h.return&&h.return()}finally{if(r)throw c}}this._primitiveTypes[(0,G.i18n)("TYPE:Color")]={};var f=!0,_=!1,m=void 0;try{for(var w,I=a()[Symbol.iterator]();!(f=(w=I.next()).done);f=!0){var N=w.value;this._primitiveTypes[(0,G.i18n)("TYPE:Color")][N]=[]}}catch(t){_=!0,m=t}finally{try{!f&&I.return&&I.return()}finally{if(_)throw m}}this._primitiveTypes[(0,G.i18n)("TYPE:Dir")]={};var C=!0,x=!1,W=void 0;try{for(var J,H=s()[Symbol.iterator]();!(C=(J=H.next()).done);C=!0){var X=J.value;this._primitiveTypes[(0,G.i18n)("TYPE:Dir")][X]=[]}}catch(t){x=!0,W=t}finally{try{!C&&H.return&&H.return()}finally{if(x)throw W}}this._primitiveTypes[(0,G.i18n)("TYPE:Event")]={};var $=!0,tt=!1,et=void 0;try{for(var rt,nt=u()[Symbol.iterator]();!($=(rt=nt.next()).done);$=!0){var it=rt.value;this._primitiveTypes[(0,G.i18n)("TYPE:Event")][it]=[]}}catch(t){tt=!0,et=t}finally{try{!$&&nt.return&&nt.return()}finally{if(tt)throw et}}this._primitiveProcedures[(0,G.i18n)("PRIM:TypeCheck")]=new z([Y,Y,Z],function(t,e,r,n){var o=n[0],a=n[1],s=n[2];null===(0,q.joinTypes)(o.type(),a.type())&&i(t,e,"typecheck-failed",[s.string,o.type(),a.type()])},function(t,e){return null}),this._primitiveProcedures[(0,G.i18n)("PRIM:PutStone")]=new z([g()],E,function(t,e){return t.putStone(T(e)),null}),this._primitiveProcedures[(0,G.i18n)("PRIM:RemoveStone")]=new z([g()],function(t,e,r,n){var o=T(n[0]);r.numStones(o).le(new q.ValueInteger(0))&&i(t,e,"cannot-remove-stone",[o])},function(t,e){return t.removeStone(T(e)),null}),this._primitiveProcedures[(0,G.i18n)("PRIM:Move")]=new z([P()],function(t,e,r,n){var o=k(n[0]);r.canMove(o)||i(t,e,"cannot-move-to",[o])},function(t,e){return t.move(k(e)),null}),this._primitiveProcedures[(0,G.i18n)("PRIM:GoToEdge")]=new z([P()],E,function(t,e){return t.goToEdge(k(e)),null}),this._primitiveProcedures[(0,G.i18n)("PRIM:EmptyBoardContents")]=new z([],E,function(t,e){return t.emptyBoardContents(),null}),this._primitiveProcedures._FAIL=new z([Z],function(t,e,r,n){i(t,e,n[0].string,[])},function(t,e){return null}),this._primitiveFunctions._makeRange=new z([Y,Y],function(t,e,r,n){var i=n[0],o=n[1];U(t,e,i,o),j(t,e,i,O()),j(t,e,o,O())},function(t,e,r){var n=e;if(y(M(n,r)))return new q.ValueList([]);for(var i=[];y(F(n,r));)i.push(n),n=D(n);return i.push(n),new q.ValueList(i)}),this._primitiveFunctions.not=new z([d()],E,function(t,e){return v(!y(e))}),this._primitiveFunctions["&&"]=new z([Y,Y],E,function(t,e,r){throw Error('The function "&&" should never be called')}),this._primitiveFunctions["||"]=new z([Y,Y],E,function(t,e,r){throw Error('The function "||" should never be called')}),this._primitiveFunctions._makeRangeWithSecond=new z([Y,Y,Y],function(t,e,r,n){var i=n[0],o=n[1],a=n[2];j(t,e,i,[K]),j(t,e,o,[K]),j(t,e,a,[K])},function(t,e,r,n){var i=n.sub(e);if(i.lt(new q.ValueInteger(1)))return new q.ValueList([]);for(var o=e,a=[];o.le(r);)a.push(o),o=o.add(i);return new q.ValueList(a)}),this._primitiveFunctions._unsafeListLength=new z([Y],E,function(t,e){return new q.ValueInteger(e.length())}),this._primitiveFunctions._unsafeListNth=new z([Y,Y],E,function(t,e,r){return e.elements[r.asNumber()]}),this._primitiveFunctions[(0,G.i18n)("PRIM:numStones")]=new z([g()],E,function(t,e){return t.numStones(T(e))}),this._primitiveFunctions[(0,G.i18n)("PRIM:anyStones")]=new z([g()],E,function(t,e){return v(t.numStones(T(e)).gt(new q.ValueInteger(0)))}),this._primitiveFunctions[(0,G.i18n)("PRIM:canMove")]=new z([P()],E,function(t,e){return v(t.canMove(k(e)))}),this._primitiveFunctions[(0,G.i18n)("PRIM:next")]=new z([Y],function(t,e,r,n){j(t,e,n[0],O())},function(t,e){return D(e)}),this._primitiveFunctions[(0,G.i18n)("PRIM:prev")]=new z([Y],function(t,e,r,n){j(t,e,n[0],O())},function(t,e){return V(e)}),this._primitiveFunctions[(0,G.i18n)("PRIM:opposite")]=new z([Y],function(t,e,r,n){j(t,e,n[0],R())},function(t,e){return B(e)}),this._primitiveFunctions[(0,G.i18n)("PRIM:minBool")]=new z([],E,function(t){return v(!1)}),this._primitiveFunctions[(0,G.i18n)("PRIM:maxBool")]=new z([],E,function(t){return v(!0)}),this._primitiveFunctions[(0,G.i18n)("PRIM:minColor")]=new z([],E,function(t){return b(a()[0])}),this._primitiveFunctions[(0,G.i18n)("PRIM:maxColor")]=new z([],E,function(t){return b(a()[a().length-1])}),this._primitiveFunctions[(0,G.i18n)("PRIM:minDir")]=new z([],E,function(t){return S(s()[0])}),this._primitiveFunctions[(0,G.i18n)("PRIM:maxDir")]=new z([],E,function(t){return S(s()[s().length-1])}),this._primitiveFunctions["+"]=new z([K,K],E,function(t,e,r){return e.add(r)}),this._primitiveFunctions["-"]=new z([K,K],E,function(t,e,r){return e.sub(r)}),this._primitiveFunctions["*"]=new z([K,K],E,function(t,e,r){return e.mul(r)}),this._primitiveFunctions.div=new z([K,K],function(t,e,r,n){n[1].eq(new q.ValueInteger(0))&&i(t,e,"cannot-divide-by-zero",[])},function(t,e,r){return e.div(r)}),this._primitiveFunctions.mod=new z([K,K],function(t,e,r,n){n[1].eq(new q.ValueInteger(0))&&i(t,e,"cannot-divide-by-zero",[])},function(t,e,r){return e.mod(r)}),this._primitiveFunctions["^"]=new z([K,K],function(t,e,r,n){n[1].lt(new q.ValueInteger(0))&&i(t,e,"negative-exponent",[])},function(t,e,r){return e.pow(r)}),this._primitiveFunctions["-(unary)"]=new z([Y],function(t,e,r,n){j(t,e,n[0],R())},function(t,e){return B(e)}),this._primitiveFunctions["=="]=new z([Y,Y],function(t,e,r,n){U(t,e,n[0],n[1])},function(t,e,r){return v(e.equal(r))}),this._primitiveFunctions["/="]=new z([Y,Y],function(t,e,r,n){U(t,e,n[0],n[1])},function(t,e,r){return v(!e.equal(r))}),this._primitiveFunctions["<="]=new z([Y,Y],function(t,e,r,n){var i=n[0],o=n[1];U(t,e,i,o),j(t,e,i,O()),j(t,e,o,O())},function(t,e,r){return A(e,r)}),this._primitiveFunctions[">="]=new z([Y,Y],function(t,e,r,n){var i=n[0],o=n[1];U(t,e,i,o),j(t,e,i,O()),j(t,e,o,O())},function(t,e,r){return L(e,r)}),this._primitiveFunctions["<"]=new z([Y,Y],function(t,e,r,n){var i=n[0],o=n[1];U(t,e,i,o),j(t,e,i,O()),j(t,e,o,O())},function(t,e,r){return F(e,r)}),this._primitiveFunctions[">"]=new z([Y,Y],function(t,e,r,n){var i=n[0],o=n[1];U(t,e,i,o),j(t,e,i,O()),j(t,e,o,O())},function(t,e,r){return M(e,r)}),this._primitiveProcedures[(0,G.i18n)("PRIM:BOOM")]=new z([Z],function(t,e,r,n){i(t,e,"boom-called",[n[0].string])},function(t,e){throw Error("Should not be reachable.")}),this._primitiveFunctions[(0,G.i18n)("PRIM:boom")]=this._primitiveProcedures[(0,G.i18n)("PRIM:BOOM")],this._primitiveFunctions["++"]=new z([Q,Q],function(t,e,r,n){U(t,e,n[0],n[1])},function(t,e,r){return e.append(r)}),this._primitiveFunctions[(0,G.i18n)("PRIM:isEmpty")]=new z([Q],E,function(t,e){return v(0===e.length())}),this._primitiveFunctions[(0,G.i18n)("PRIM:head")]=new z([Q],function(t,e,r,n){0===n[0].length()&&i(t,e,"list-cannot-be-empty",[])},function(t,e){return e.head()}),this._primitiveFunctions[(0,G.i18n)("PRIM:tail")]=new z([Q],function(t,e,r,n){0===n[0].length()&&i(t,e,"list-cannot-be-empty",[])},function(t,e){return e.tail()}),this._primitiveFunctions[(0,G.i18n)("PRIM:oldTail")]=this._primitiveFunctions[(0,G.i18n)("PRIM:tail")],this._primitiveFunctions[(0,G.i18n)("PRIM:init")]=new z([Q],function(t,e,r,n){0===n[0].length()&&i(t,e,"list-cannot-be-empty",[])},function(t,e){return e.init()}),this._primitiveFunctions[(0,G.i18n)("PRIM:last")]=new z([Q],function(t,e,r,n){0===n[0].length()&&i(t,e,"list-cannot-be-empty",[])},function(t,e){return e.last()})}return W(t,[{key:"types",value:function(){var t=[];for(var e in this._primitiveTypes)t.push(e);return t}},{key:"typeConstructors",value:function(t){if(!(t in this._primitiveTypes))throw Error("Not a primitive type: "+t);var e=[];for(var r in this._primitiveTypes[t])e.push(r);return e}},{key:"constructorFields",value:function(t,e){if(!(t in this._primitiveTypes))throw Error("Not a primitive type: "+t);if(!(e in this._primitiveTypes[t]))throw Error("Not a primitive constructor: "+e);return this._primitiveTypes[t][e]}},{key:"isOperation",value:function(t){return t in this._primitiveProcedures||t in this._primitiveFunctions}},{key:"getOperation",value:function(t){if(t in this._primitiveProcedures)return this._primitiveProcedures[t];if(t in this._primitiveFunctions)return this._primitiveFunctions[t];throw Error(t+" is not a primitive.")}},{key:"procedures",value:function(){var t=[];for(var e in this._primitiveProcedures)t.push(e);return t}},{key:"isProcedure",value:function(t){return t in this._primitiveProcedures}},{key:"functions",value:function(){var t=[];for(var e in this._primitiveFunctions)t.push(e);return t}},{key:"isFunction",value:function(t){return t in this._primitiveFunctions}}]),t}()},function(t,e,r){"use strict";function n(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){return null===t||null===e?null:t.tag===h?e:e.tag===h?t:t.tag===p&&e.tag===p?t:t.tag===f&&e.tag===f?t:t.tag===_&&e.tag===_?k(t,e):t.tag===m&&e.tag===m?E(t,e):t.tag===d&&e.tag===d?w(t,e):null}function s(t){var e=[];for(var r in t)e.push(r);return e.sort()}Object.defineProperty(e,"__esModule",{value:!0}),e.ValueStructure=e.ValueList=e.ValueTuple=e.ValueString=e.ValueInteger=e.Value=e.V_Structure=e.V_List=e.V_Tuple=e.V_String=e.V_Integer=e.TypeStructure=e.TypeList=e.TypeTuple=e.TypeString=e.TypeInteger=e.TypeAny=void 0;var u=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}();e.joinTypes=a;var c=r(0),l=r(13),h=Symbol.for("Ty_Any"),p=Symbol.for("Ty_Integer"),f=Symbol.for("Ty_String"),_=Symbol.for("Ty_Tuple"),m=Symbol.for("Ty_List"),d=Symbol.for("Ty_Structure"),v=function(){function t(e){o(this,t),this._tag=e}return u(t,[{key:"isAny",value:function(){return!1}},{key:"isInteger",value:function(){return!1}},{key:"isString",value:function(){return!1}},{key:"isTuple",value:function(){return!1}},{key:"isList",value:function(){return!1}},{key:"isStructure",value:function(){return!1}},{key:"isBoolean",value:function(){return!1}},{key:"isColor",value:function(){return!1}},{key:"isDirection",value:function(){return!1}},{key:"tag",get:function(){return this._tag}}]),t}(),y=e.TypeAny=function(t){function e(){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,h))}return i(e,t),u(e,[{key:"toString",value:function(){return"?"}},{key:"isAny",value:function(){return!0}}]),e}(v),g=e.TypeInteger=function(t){function e(){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,p))}return i(e,t),u(e,[{key:"toString",value:function(){return(0,c.i18n)("TYPE:Integer")}},{key:"isInteger",value:function(){return!0}}]),e}(v),b=e.TypeString=function(t){function e(){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,f))}return i(e,t),u(e,[{key:"toString",value:function(){return(0,c.i18n)("TYPE:String")}},{key:"isString",value:function(){return!0}}]),e}(v),T=e.TypeTuple=function(t){function e(t){o(this,e);var r=n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,_));return r._componentTypes=t,r}return i(e,t),u(e,[{key:"toString",value:function(){var t=[],e=!0,r=!1,n=void 0;try{for(var i,o=this._componentTypes[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var a=i.value;t.push(a.toString())}}catch(t){r=!0,n=t}finally{try{!e&&o.return&&o.return()}finally{if(r)throw n}}return(0,c.i18n)("TYPE:Tuple")+"("+t.join(", ")+")"}},{key:"isTuple",value:function(){return!0}},{key:"componentTypes",get:function(){return this._componentTypes}}]),e}(v),P=e.TypeList=function(t){function e(t){o(this,e);var r=n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,m));return r._contentType=t,r}return i(e,t),u(e,[{key:"toString",value:function(){var t="";return this._contentType.isAny()||(t="("+this._contentType.toString()+")"),(0,c.i18n)("TYPE:List")+t}},{key:"isList",value:function(){return!0}},{key:"contentType",get:function(){return this._contentType}}]),e}(v),S=e.TypeStructure=function(t){function e(t,r){o(this,e);var i=n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,d));return i._typeName=t,i._cases=r,i}return i(e,t),u(e,[{key:"toString",value:function(){var t=[],e=!0,r=!1,n=void 0;try{for(var i,o=s(this._cases)[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var a=i.value,u=this._cases[a],c=[],l=!0,h=!1,p=void 0;try{for(var f,_=s(u)[Symbol.iterator]();!(l=(f=_.next()).done);l=!0){var m=f.value;c.push(m+" <- "+u[m].toString())}}catch(t){h=!0,p=t}finally{try{!l&&_.return&&_.return()}finally{if(h)throw p}}0!==c.length&&t.push(a+"("+c.join(", ")+")")}}catch(t){r=!0,n=t}finally{try{!e&&o.return&&o.return()}finally{if(r)throw n}}return 0===t.length?this._typeName:this._typeName+" { "+t.join(" | ")+" }"}},{key:"isStructure",value:function(){return!0}},{key:"isBoolean",value:function(){return this._typeName===(0,c.i18n)("TYPE:Bool")}},{key:"isColor",value:function(){return this._typeName===(0,c.i18n)("TYPE:Color")}},{key:"isDirection",value:function(){return this._typeName===(0,c.i18n)("TYPE:Dir")}},{key:"typeName",get:function(){return this._typeName}},{key:"cases",get:function(){return this._cases}}]),e}(v),k=void 0,E=void 0,w=void 0,I=void 0;k=function(t,e){if(t.componentTypes.length!==e.componentTypes.length)return null;for(var r=[],n=0;n<t.componentTypes.length;n++){var i=t.componentTypes[n],o=e.componentTypes[n],s=a(i,o);if(null===s)return null;r.push(s)}return new T(r)},E=function(t,e){var r=a(t.contentType,e.contentType);return null===r?null:new P(r)},w=function(t,e){function r(t,e){for(var r in t.cases)r in e.cases||(n[r]=t.cases[r])}if(t.typeName!==e.typeName)return null;var n={};r(t,e),r(e,t);for(var i in t.cases)if(i in e.cases){var o=I(t.cases[i],e.cases[i]);if(null===o)return null;n[i]=o}return new S(t.typeName,n)},I=function(t,e){function r(t,e){for(var r in t)if(!(r in e))throw Error("Join fields: structures built using the same constructor should have the same set of fields.")}r(t,e),r(e,t);var n={};for(var i in t){var o=t[i],s=e[i],u=a(o,s);if(null===u)return null;n[i]=u}return n};var N=e.V_Integer=Symbol.for("V_Integer"),C=e.V_String=Symbol.for("V_String"),R=e.V_Tuple=Symbol.for("V_Tuple"),O=e.V_List=Symbol.for("V_List"),x=e.V_Structure=Symbol.for("V_Structure"),A=e.Value=function(){function t(e){o(this,t),this._tag=e}return u(t,[{key:"type",value:function(){return new v("?",[])}},{key:"isInteger",value:function(){return this.type().isInteger()}},{key:"isString",value:function(){return this.type().isString()}},{key:"isTuple",value:function(){return this.type().isTuple()}},{key:"isList",value:function(){return this.type().isList()}},{key:"isStructure",value:function(){return this.type().isStructure()}},{key:"isBoolean",value:function(){return this.type().isBoolean()}},{key:"tag",get:function(){return this._tag}}]),t}();e.ValueInteger=function(t){function e(t){o(this,e);var r=n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,N));if("number"==typeof t)r._number=t.toString();else{if("string"!=typeof t)throw Error("Integer value must be constructed with an integer or a string");r._number=t}return r}return i(e,t),u(e,[{key:"toString",value:function(){return this._number}},{key:"type",value:function(){return new g}},{key:"equal",value:function(t){return t.tag===N&&this.number===t.number}},{key:"add",value:function(t){var r=(0,l.Integer)(this._number),n=(0,l.Integer)(t._number);return new e(r.add(n).toString())}},{key:"sub",value:function(t){var r=(0,l.Integer)(this._number),n=(0,l.Integer)(t._number);return new e(r.subtract(n).toString())}},{key:"mul",value:function(t){var r=(0,l.Integer)(this._number),n=(0,l.Integer)(t._number);return new e(r.multiply(n).toString())}},{key:"div",value:function(t){var r=new e(0);if(this.gt(r)===t.gt(r)){var n=(0,l.Integer)(this.abs()._number),i=(0,l.Integer)(t.abs()._number);return new e(n.divide(i).toString())}var o=t.abs().sub(new e(1)),a=(0,l.Integer)(this.abs().add(o)._number),s=(0,l.Integer)(t.abs()._number);return new e(a.divide(s).negate().toString())}},{key:"mod",value:function(t){var e=this.div(t);return this.sub(e.mul(t))}},{key:"pow",value:function(t){var r=(0,l.Integer)(this._number),n=(0,l.Integer)(t._number);return new e(r.pow(n).toString())}},{key:"eq",value:function(t){return this.equal(t)}},{key:"ne",value:function(t){return!this.equal(t)}},{key:"le",value:function(t){var e=(0,l.Integer)(this._number),r=(0,l.Integer)(t._number);return e.leq(r)}},{key:"lt",value:function(t){var e=(0,l.Integer)(this._number),r=(0,l.Integer)(t._number);return e.lt(r)}},{key:"ge",value:function(t){var e=(0,l.Integer)(this._number),r=(0,l.Integer)(t._number);return e.geq(r)}},{key:"gt",value:function(t){var e=(0,l.Integer)(this._number),r=(0,l.Integer)(t._number);return e.gt(r)}},{key:"negate",value:function(){return new e((0,l.Integer)(this._number).negate().toString())}},{key:"abs",value:function(){return this.gt(new e(0))?this:this.negate()}},{key:"asNumber",value:function(){return parseInt(this._number,10)}},{key:"number",get:function(){return this._number}}]),e}(A),e.ValueString=function(t){function e(t){o(this,e);var r=n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,C));return r._string=t,r}return i(e,t),u(e,[{key:"toString",value:function(){for(var t=['"'],e=0;e<this._string.length;e++){var r=this._string[e];switch(r){case'"':t.push("\\"),t.push('"');break;case"\\":t.push("\\"),t.push("\\");break;case"":t.push("\\"),t.push("a");break;case"\b":t.push("\\"),t.push("b");break;case"\f":t.push("\\"),t.push("f");break;case"\n":t.push("\\"),t.push("n");break;case"\r":t.push("\\"),t.push("r");break;case"\t":t.push("\\"),t.push("t");break;case"\v":t.push("\\"),t.push("v");break;default:t.push(r)}}return t.push('"'),t.join("")}},{key:"equal",value:function(t){return t.tag===C&&this.string===t.string}},{key:"type",value:function(){return new b}},{key:"string",get:function(){return this._string}}]),e}(A),e.ValueTuple=function(t){function e(t){o(this,e);var r=n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,R));return r._components=t,r._type=r._inferType(),r}return i(e,t),u(e,[{key:"toString",value:function(){var t=[],e=!0,r=!1,n=void 0;try{for(var i,o=this._components[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var a=i.value;t.push(a.toString())}}catch(t){r=!0,n=t}finally{try{!e&&o.return&&o.return()}finally{if(r)throw n}}return"("+t.join(", ")+")"}},{key:"size",value:function(){return this._components.length}},{key:"equal",value:function(t){if(t.tag!==R)return!1;if(this.components.length!==t.components.length)return!1;for(var e=0;e<this.components.length;e++)if(!this.components[e].equal(t.components[e]))return!1;return!0}},{key:"type",value:function(){return this._type}},{key:"_inferType",value:function(){var t=[],e=!0,r=!1,n=void 0;try{for(var i,o=this._components[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var a=i.value;t.push(a.type())}}catch(t){r=!0,n=t}finally{try{!e&&o.return&&o.return()}finally{if(r)throw n}}return new T(t)}},{key:"components",get:function(){return this._components}}]),e}(A),e.ValueList=function(t){function e(t){o(this,e);var r=n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,O));return r._elements=t,r._type=r._inferType(),r}return i(e,t),u(e,[{key:"toString",value:function(){var t=[],e=!0,r=!1,n=void 0;try{for(var i,o=this._elements[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var a=i.value;t.push(a.toString())}}catch(t){r=!0,n=t}finally{try{!e&&o.return&&o.return()}finally{if(r)throw n}}return"["+t.join(", ")+"]"}},{key:"equal",value:function(t){if(t.tag!==O)return!1;if(this.elements.length!==t.elements.length)return!1;for(var e=0;e<this.elements.length;e++)if(!this.elements[e].equal(t.elements[e]))return!1;return!0}},{key:"type",value:function(){return this._type}},{key:"length",value:function(){return this._elements.length}},{key:"_inferType",value:function(){var t=new y,e=!0,r=!1,n=void 0;try{for(var i,o=this._elements[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){t=a(t,i.value.type())}}catch(t){r=!0,n=t}finally{try{!e&&o.return&&o.return()}finally{if(r)throw n}}return new P(t)}},{key:"append",value:function(t){var r=[],n=!0,i=!1,o=void 0;try{for(var a,s=this.elements[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var u=a.value;r.push(u)}}catch(t){i=!0,o=t}finally{try{!n&&s.return&&s.return()}finally{if(i)throw o}}var c=!0,l=!1,h=void 0;try{for(var p,f=t.elements[Symbol.iterator]();!(c=(p=f.next()).done);c=!0){var _=p.value;r.push(_)}}catch(t){l=!0,h=t}finally{try{!c&&f.return&&f.return()}finally{if(l)throw h}}return new e(r)}},{key:"head",value:function(){return this.elements[0]}},{key:"tail",value:function(){for(var t=[],r=1;r<this.elements.length;r++)t.push(this.elements[r]);return new e(t)}},{key:"init",value:function(){for(var t=[],r=0;r<this.elements.length-1;r++)t.push(this.elements[r]);return new e(t)}},{key:"last",value:function(){return this.elements[this.elements.length-1]}},{key:"elements",get:function(){return this._elements}}]),e}(A),e.ValueStructure=function(t){function e(t,r,i){o(this,e);var a=n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,x));return a._typeName=t,a._constructorName=r,a._fields=i,a}return i(e,t),u(e,[{key:"toString",value:function(){var t=[],e=this.fieldNames();if(0===e.length)return this._constructorName;var r=!0,n=!1,i=void 0;try{for(var o,a=e[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){var s=o.value;t.push(s+" <- "+this.fields[s].toString())}}catch(t){n=!0,i=t}finally{try{!r&&a.return&&a.return()}finally{if(n)throw i}}return this._constructorName+"("+t.join(", ")+")"}},{key:"fieldNames",value:function(){return s(this._fields)}},{key:"_clone",value:function(){var t={};for(var r in this._fields)t[r]=this._fields[r];return new e(this._typeName,this._constructorName,t)}},{key:"updateFields",value:function(t){var e=this._clone();for(var r in t)e.fields[r]=t[r];return e}},{key:"equal",value:function(t){if(t.tag!==x)return!1;if(this.constructorName!==t.constructorName)return!1;var e=this.fieldNames(),r=!0,n=!1,i=void 0;try{for(var o,a=e[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){var s=o.value;if(!this.fields[s].equal(t.fields[s]))return!1}}catch(t){n=!0,i=t}finally{try{!r&&a.return&&a.return()}finally{if(n)throw i}}return!0}},{key:"type",value:function(){var t={};for(var e in this._fields)t[e]=this._fields[e].type();var r={};return r[this._constructorName]=t,new S(this._typeName,r)}},{key:"typeName",get:function(){return this._typeName}},{key:"constructorName",get:function(){return this._constructorName}},{key:"fields",get:function(){return this._fields}}]),e}(A)},function(t,e,r){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),o=e.SourceReader=function(){function t(e,r){n(this,t),this._filename=e,this._string=r,this._index=0,this._line=1,this._column=1,this._regions=[]}return i(t,[{key:"_clone",value:function(){var e=new t(this._filename,this._string);return e._index=this._index,e._line=this._line,e._column=this._column,e._regions=this._regions,e}},{key:"consumeCharacter",value:function(){var t=this._clone();return"\n"===t.peek()?(t._line++,t._column=1):t._column++,t._index++,t}},{key:"consumeString",value:function(t){var e=this,r=!0,n=!1,i=void 0;try{for(var o,a=t[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){o.value;e=e.consumeCharacter()}}catch(t){n=!0,i=t}finally{try{!r&&a.return&&a.return()}finally{if(n)throw i}}return e}},{key:"consumeInvisibleCharacter",value:function(){var t=this._clone();return t._index++,t}},{key:"consumeInvisibleString",value:function(t){var e=this,r=!0,n=!1,i=void 0;try{for(var o,a=t[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){o.value;e=e.consumeInvisibleCharacter()}}catch(t){n=!0,i=t}finally{try{!r&&a.return&&a.return()}finally{if(n)throw i}}return e}},{key:"startsWith",value:function(t){var e=this._index,r=this._index+t.length;return r<=this._string.length&&this._string.substring(e,r)===t}},{key:"eof",value:function(){return this._index>=this._string.length}},{key:"peek",value:function(){return this._string[this._index]}},{key:"beginRegion",value:function(t){var e=this._clone();return e._regions=[t].concat(e._regions),e}},{key:"endRegion",value:function(){var t=this._clone();return t._regions.length>0&&(t._regions=t._regions.slice(1)),t}},{key:"filename",get:function(){return this._filename}},{key:"line",get:function(){return this._line}},{key:"column",get:function(){return this._column}},{key:"region",get:function(){return this._regions.length>0?this._regions[0]:""}}]),t}();e.UnknownPosition=new o("(?)",""),e.MultifileReader=function(){function t(e){n(this,t),"string"==typeof e&&(e={"(?)":e}),this._filenames=Object.keys(e),this._filenames.sort(),this._input=e,this._index=0}return i(t,[{key:"moreFiles",value:function(){return this._index+1<this._filenames.length}},{key:"nextFile",value:function(){this._index++}},{key:"readCurrentFile",value:function(){if(this._index<this._filenames.length){var t=this._filenames[this._index];return new o(t,this._input[t])}return new o("(?)","")}}]),t}()},function(t,e,r){"use strict";function n(t){return'la palabra clave "'+t+'"'}function i(t,e,r){return 0===t?"ningún "+e:1===t?"un "+e:t.toString()+" "+r}function o(t){var e=["","primer","segundo","tercer","cuarto","quinto","sexto","séptimo","octavo","noveno"];return 1<=t<=9?e[t]:"#"+t.toString()}function a(t){if(t.isInteger())return["m","número","números"];if(t.isBoolean())return["m","booleano","booleanos"];if(t.isColor())return["m","color","colores"];if(t.isDirection())return["f","dirección","direcciones"];if(t.isList()&&t.contentType.isAny())return["f","lista","listas"];if(t.isList()){var e=a(t.contentType);if(null===e)return null;var r=e[2];return["f","lista de "+r,"listas de "+r]}return null}function s(t){var e=a(t);return null===e?t.toString():e[1]}function u(t){var e=a(t);if(null===e)return"un valor de tipo "+t.toString();var r=e[0],n=e[1];return"m"===r?"un "+n:"una "+n}function c(t){var e=a(t);if(null===e)return"de tipo "+t.toString();var r=e[0],n=e[1];return"m"===r?"un "+n:"una "+n}function l(t){var e=a(t);if(null===e)return"de tipo "+t.toString();var r=(e[0],e[2]);return r}function h(t){var e=[],r=!0,n=!1,i=void 0;try{for(var o,a=t[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){var u=o.value;e.push(s(u))}}catch(t){n=!0,i=t}finally{try{!r&&a.return&&a.return()}finally{if(n)throw i}}return e.join(", ")}function p(t){return"("===t||")"===t?'un paréntesis abierto "("':"["===t||"]"===t?'un corchete abierto "["':"{"===t||"}"===t?'una llave abierta "{"':t}function f(t,e,r){for(var n="",i=0;i<t.length;i++)"%"===t[i]&&i+1<t.length?"%"===t[i+1]?(n+="%",i++):"1"===t[i+1]?(n+=u(e),i++):"2"===t[i+1]?(n+=u(r),i++):n+="%":n+=t[i];return n}Object.defineProperty(e,"__esModule",{value:!0});var _=e.LOCALE_ES={definition:"una definición (de programa, función, procedimiento, o tipo)",pattern:'un patrón (comodín "_", constructor aplicado a variables, o tupla)',statement:"un comando",expression:"una expresión","procedure call":"una invocación a un procedimiento","field name":"el nombre de un campo",T_EOF:"el final del archivo",T_NUM:"un número",T_STRING:"una cadena (string)",T_UPPERID:"un identificador con mayúsculas",T_LOWERID:"un identificador con minúsculas",T_PROGRAM:n("program"),T_INTERACTIVE:n("interactive"),T_PROCEDURE:n("procedure"),T_FUNCTION:n("function"),T_RETURN:n("return"),T_IF:n("if"),T_THEN:n("then"),T_ELSE:n("else"),T_REPEAT:n("repeat"),T_FOREACH:n("foreach"),T_IN:n("in"),T_WHILE:n("while"),T_SWITCH:n("switch"),T_TO:n("to"),T_LET:n("let"),T_NOT:n("not"),T_DIV:n("div"),T_MOD:n("mod"),T_TYPE:n("type"),T_IS:n("is"),T_CHOOSE:n("choose"),T_WHEN:n("when"),T_OTHERWISE:n("otherwise"),T_MATCHING:n("matching"),T_SELECT:n("select"),T_ON:n("on"),T_RECORD:n("record"),T_VARIANT:n("variant"),T_CASE:n("case"),T_FIELD:n("field"),T_UNDERSCORE:'un guión bajo ("_")',T_LPAREN:'un paréntesis izquierdo ("(")',T_RPAREN:'un paréntesis derecho (")")',T_LBRACE:'una llave izquierda ("{")',T_RBRACE:'una llave derecha ("}")',T_LBRACK:'un corchete izquierdo ("[")',T_RBRACK:'un corchete derecho ("]")',T_COMMA:'una coma (",")',T_SEMICOLON:'un punto y coma (";")',T_RANGE:'un separador de rango ("..")',T_GETS:'una flecha hacia la izquierda ("<-")',T_PIPE:'una barra vertical ("|")',T_ARROW:'una flecha ("->")',T_ASSIGN:'un operador de asignación (":=")',T_EQ:'una comparación por igualdad ("==")',T_NE:'una comparación por desigualdad ("/=")',T_LE:'un menor o igual ("<=")',T_GE:'un mayor o igual (">=")',T_LT:'un menor estricto ("<")',T_GT:'un mayor estricto (">")',T_AND:'el "y" lógico ("&&")',T_OR:'el "o" lógico ("||")',T_CONCAT:'el operador de concatenación de listas ("++")',T_PLUS:'el operador de suma ("+")',T_MINUS:'el operador de resta ("-")',T_TIMES:'el operador de producto ("*")',T_POW:'el operador de potencia ("^")',LocalVariable:"variable",LocalIndex:"índice",LocalParameter:"parámetro",V_Integer:"un número",V_String:"una cadena",V_Tuple:"una tupla",V_List:"una lista",V_Structure:"una estructura","errmsg:unclosed-multiline-comment":"El comentario se abre pero nunca se cierra.","errmsg:unclosed-string-constant":"La comilla que abre no tiene una comilla que cierra correspondiente.","errmsg:numeric-constant-should-not-have-leading-zeroes":"Las constantes numéricas no se pueden escribir con ceros a la izquierda.","errmsg:identifier-must-start-with-alphabetic-character":"Los identificadores deben empezar con un caracter alfabético (a...z,A...Z).","errmsg:unknown-token":function(t){return'Símbolo desconocido en la entrada: "'+t+'".'},"warning:empty-pragma":"Directiva pragma vacía.","warning:unknown-pragma":function(t){return'Directiva pragma desconocida: "'+t+'".'},"errmsg:unmatched-opening-delimiter":function(t){return"Se encontró "+p(t)+" pero nunca se cierra."},"errmsg:unmatched-closing-delimiter":function(t){return'Se encontró un "'+t+'" pero no había '+p(t)+"."},"errmsg:unknown-language-option":function(t){return'Opción desconocida. "'+t+'".'},"errmsg:empty-source":"El programa está vacío.","errmsg:expected-but-found":function(t,e){return"Se esperaba "+t+".\nSe encontró: "+e+"."},"errmsg:pattern-number-cannot-be-negative-zero":'El patrón numérico no puede ser "-0".',"errmsg:return-tuple-cannot-be-empty":"El return tiene que devolver algo.","errmsg:pattern-tuple-cannot-be-singleton":"El patrón para una tupla no puede tener una sola componente. Las tuplas tienen 0, 2, 3, o más componentes, pero no 1.","errmsg:assignment-tuple-cannot-be-singleton":"La asignación a una tupla no puede constar de una sola componente. Las tuplas tienen 0, 2, 3, o más componentes, pero no 1.","errmsg:operators-are-not-associative":function(t,e){return"La expresión usa "+t+" y "+e+", pero estos operadores no se pueden asociar. Quizás faltan paréntesis."},"errmsg:obsolete-tuple-assignment":'Se esperaba un comando pero se encontró un paréntesis izquierdo. Nota: la sintaxis de asignación de tuplas "(x1, ..., xN) := y" está obsoleta. Usar "let (x1, ..., xN) := y".',"errmsg:program-already-defined":function(t,e){return"Ya había un programa definido en "+t+".\nNo se puede definir un programa en "+e+"."},"errmsg:procedure-already-defined":function(t,e,r){return'El procedimiento "'+t+'" está definido dos veces: en '+e+" y en "+r+"."},"errmsg:function-already-defined":function(t,e,r){return'La función "'+t+'" está definida dos veces: en '+e+" y en "+r+"."},"errmsg:type-already-defined":function(t,e,r){return'El tipo "'+t+'" está definido dos veces: en '+e+" y en "+r+"."},"errmsg:constructor-already-defined":function(t,e,r){return'El constructor "'+t+'" está definido dos veces: en '+e+" y en "+r+"."},"errmsg:repeated-field-name":function(t,e){return'El campo "'+e+'" no puede estar repetido para el constructor "'+t+'".'},"errmsg:function-and-field-cannot-have-the-same-name":function(t,e,r){return'El nombre "'+t+'" se usa para una función en '+e+" y para un campo en "+r+"."},"errmsg:source-should-have-a-program-definition":'El código debe tener una definición de "program { ... }".',"errmsg:procedure-should-not-have-return":function(t){return'El procedimiento "'+t+'" no debería tener un comando "return".'},"errmsg:function-should-have-return":function(t){return'La función "'+t+'" debería tener un comando "return".'},"errmsg:return-statement-not-allowed-here":'El comando "return" solo puede aparecer como el último comando de una función o como el último comando del programa.',"errmsg:local-name-conflict":function(t,e,r,n,i){return'Conflicto de nombres: "'+t+'" se usa dos veces: como '+e+" en "+r+", y como "+n+" en "+i+"."},"errmsg:repeated-variable-in-tuple-assignment":function(t){return'La variable "'+t+'" está repetida en la asignación de tuplas.'},"errmsg:constructor-used-as-procedure":function(t,e){return'El procedimiento "'+t+'" no está definido. El nombre "'+t+'" es el nombre de un constructor del tipo "'+e+'".'},"errmsg:undefined-procedure":function(t){return'El procedimiento "'+t+'" no está definido.'},"errmsg:undefined-function":function(t){return'La función "'+t+'" no está definida.'},"errmsg:procedure-arity-mismatch":function(t,e,r){return'El procedimiento "'+t+'" espera recibir '+_["<n>-parameters"](e)+" pero se lo invoca con "+_["<n>-arguments"](r)+"."},"errmsg:function-arity-mismatch":function(t,e,r){return'La función "'+t+'" espera recibir '+_["<n>-parameters"](e)+" pero se la invoca con "+_["<n>-arguments"](r)+"."},"errmsg:structure-pattern-arity-mismatch":function(t,e,r){return'El constructor "'+t+'" tiene '+_["<n>-fields"](e)+" pero el patrón tiene "+_["<n>-parameters"](r)+"."},"errmsg:type-used-as-constructor":function(t,e){var r=void 0;return r=0===e.length?"(no tiene constructores).":1===e.length?"(tiene un constructor: "+e[0]+").":"(sus constructores son: "+e.join(", ")+").",'El constructor "'+t+'" no está definido. El nombre "'+t+'" es el nombre de un tipo '+r},"errmsg:procedure-used-as-constructor":function(t){return'El constructor "'+t+'" no está definido. El nombre "'+t+'" es el nombre de un procedimiento.'},"errmsg:undeclared-constructor":function(t){return'El constructor "'+t+'" no está definido.'},"errmsg:wildcard-pattern-should-be-last":'El comodín "_" debe estar en la última rama.',"errmsg:variable-pattern-should-be-last":function(t){return'El patrón variable "'+t+'" tiene debe estar en la última rama.'},"errmsg:numeric-pattern-repeats-number":function(t){return'Hay dos ramas distintas para el número "'+t+'".'},"errmsg:structure-pattern-repeats-constructor":function(t){return'Hay dos ramas distintas para el constructor "'+t+'".'},"errmsg:structure-pattern-repeats-tuple-arity":function(t){return"Hay dos ramas distintas para las tuplas de "+t.toString()+" componentes."},"errmsg:structure-pattern-repeats-timeout":"Hay dos ramas distintas para el TIMEOUT.","errmsg:pattern-does-not-match-type":function(t,e){return"Los patrones tienen que ser todos del mismo tipo. El patrón debería ser de tipo "+t+"pero es de tipo "+e+"."},"errmsg:patterns-in-interactive-program-must-be-events":'Los patrones de un "interactive program" deben ser eventos.',"errmsg:patterns-in-interactive-program-cannot-be-variables":"El patrón no puede ser una variable.","errmsg:patterns-in-switch-must-not-be-events":"El patrón no puede ser un evento.","errmsg:structure-construction-repeated-field":function(t,e){return'El campo "'+e+'" está repetido en la instanciación del constructor "'+t+'".'},"errmsg:structure-construction-invalid-field":function(t,e){return'El campo "'+e+'" no es un campo válido para el constructor "'+t+'".'},"errmsg:structure-construction-missing-field":function(t,e){return'Falta darle valor al campo "'+e+'" del constructor "'+t+'".'},"errmsg:structure-construction-cannot-be-an-event":function(t){return'El constructor "'+t+'" corresponde a un evento, y solamente se puede manejar implícitamente en un programa interactivo (el usuario no puede construir instancias).'},"errmsg:forbidden-extension-destructuring-foreach":"El índice de la repetición indexada debe ser un identificador.","errmsg:forbidden-extension-allow-recursion":function(t){var e=[],r=!0,n=!1,i=void 0;try{for(var o,a=t[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){var s=o.value;e.push("  "+s.caller+" llama a "+s.callee+" ("+s.location.startPos.filename.toString()+":"+s.location.startPos.line.toString()+":"+s.location.startPos.column.toString()+")")}}catch(t){n=!0,i=t}finally{try{!r&&a.return&&a.return()}finally{if(n)throw i}}return"La recursión está deshabilitada. Hay un ciclo en las invocaciones:\n"+e.join("\n")},"errmsg:patterns-in-foreach-must-not-be-events":"El patrón de un foreach no puede ser un evento.","errmsg:ellipsis":"El programa todavía no está completo.","errmsg:undefined-variable":function(t){return'La variable "'+t+'" no está definida.'},"errmsg:too-few-arguments":function(t){return'Faltan argumentos para "'+t+'".'},"errmsg:expected-structure-but-got":function(t,e){return'Se esperaba una estructura construida con el constructor "'+t+'", pero se recibió '+e+"."},"errmsg:expected-constructor-but-got":function(t,e){return'Se esperaba una estructura construida con el constructor "'+t+'", pero el constructor recibido es '+e+'".'},"errmsg:incompatible-types-on-assignment":function(t,e,r){return'La variable "'+t+'" contenía '+u(e)+", no se le puede asignar "+u(r)+'".'},"errmsg:incompatible-types-on-list-creation":function(t,e,r){return"Todos los elementos de una lista deben ser del mismo tipo. Los elementos son "+l(e)+", pero el elemento en la posición "+t.toString()+" es "+c(r)+"."},"errmsg:incompatible-types-on-structure-update":function(t,e,r){return'El campo "'+t+'" es '+c(e)+". No se lo puede actualizar con "+u(r)+"."},"errmsg:expected-tuple-value-but-got":function(t){return"Se esperaba una tupla pero se recibió "+u(t)+"."},"errmsg:tuple-component-out-of-bounds":function(t,e){return"Índice fuera de rango. La tupla es de tamaño "+t.toString()+" y el índice es "+e.toString()+"."},"errmsg:expected-structure-value-but-got":function(t){return"Se esperaba una estructura pero se recibió "+u(t)+"."},"errmsg:structure-field-not-present":function(t,e){return'La estructura no tiene un campo "'+e+'". Los campos son: ['+t.join(", ")+"]."},"errmsg:primitive-does-not-exist":function(t){return'La operación primitiva "'+t+'" no existe o no está disponible.'},"errmsg:primitive-arity-mismatch":function(t,e,r){return'La operación "'+t+'" espera recibir '+_["<n>-parameters"](e)+" pero se la invoca con "+_["<n>-arguments"](r)+"."},"errmsg:primitive-argument-type-mismatch":function(t,e,r,n,i){var a="El ";return r>1&&(a+=o(e)+" "),a+="parámetro ",a+='de "'+t+'" ',a+="debería ser "+c(n)+" ",a+="pero es "+c(i)+"."},"errmsg:expected-value-of-type-but-got":function(t,e){return"Se esperaba "+u(t)+" pero se recibió "+u(e)+"."},"errmsg:expected-value-of-some-type-but-got":function(t,e){return"Se esperaba un valor de alguno de los siguientes tipos: "+h(t)+". Pero se recibió "+u(e)+"."},"errmsg:expected-values-to-have-compatible-types":function(t,e){return"Los tipos de las expresiones no coinciden: la primera es "+c(t)+" y la segunda es "+c(e)+"."},"errmsg:switch-does-not-match":"El valor analizado no coincide con ninguna de las ramas del switch.","errmsg:foreach-pattern-does-not-match":"El elemento no coincide con el patrón esperado por el foreach.","errmsg:cannot-divide-by-zero":"No se puede dividir por cero.","errmsg:negative-exponent":"El exponente de la potencia no puede ser negativo.","errmsg:list-cannot-be-empty":"La lista no puede ser vacía.","errmsg:timeout":function(t){return"La ejecución del programa demoró más de "+t.toString()+"ms."},"errmsg:typecheck-failed":function(t,e,r){return f(t,e,r)},"errmsg:cannot-move-to":function(t){return"No se puede mover hacia la dirección "+t+": cae afuera del tablero."},"errmsg:cannot-remove-stone":function(t){return"No se puede sacar una bolita de color "+t+": no hay bolitas de ese color."},"TYPE:Integer":"Number","TYPE:String":"String","TYPE:Tuple":"","TYPE:List":"List","TYPE:Event":"Event","CONS:INIT":"INIT","CONS:TIMEOUT":"TIMEOUT","TYPE:Bool":"Bool","CONS:False":"False","CONS:True":"True","TYPE:Color":"Color","CONS:Color0":"Azul","CONS:Color1":"Negro","CONS:Color2":"Rojo","CONS:Color3":"Verde","TYPE:Dir":"Dir","CONS:Dir0":"Norte","CONS:Dir1":"Este","CONS:Dir2":"Sur","CONS:Dir3":"Oeste","PRIM:TypeCheck":"TypeCheck","PRIM:BOOM":"BOOM","PRIM:boom":"boom","PRIM:PutStone":"Poner","PRIM:RemoveStone":"Sacar","PRIM:Move":"Mover","PRIM:GoToEdge":"IrAlBorde","PRIM:EmptyBoardContents":"VaciarTablero","PRIM:numStones":"nroBolitas","PRIM:anyStones":"hayBolitas","PRIM:canMove":"puedeMover","PRIM:next":"siguiente","PRIM:prev":"previo","PRIM:opposite":"opuesto","PRIM:minBool":"minBool","PRIM:maxBool":"maxBool","PRIM:minColor":"minColor","PRIM:maxColor":"maxColor","PRIM:minDir":"minDir","PRIM:maxDir":"maxDir","PRIM:isEmpty":"esVacía","PRIM:head":"primero","PRIM:tail":"sinElPrimero","PRIM:oldTail":"resto","PRIM:init":"comienzo","PRIM:last":"último","<alternative>":function(t){return"alguna de las siguientes alternativas:\n"+t.map(function(t){return"  "+t}).join("\n")},"<position>":function(t,e,r){return t+":"+e.toString()+":"+r.toString()},"<n>-parameters":function(t){return i(t,"parámetro","parámetros")},"<n>-arguments":function(t){return i(t,"argumento","argumentos")},"<n>-fields":function(t){return i(t,"campo","campos")},"<pattern-type>":function(t){return"Event"===t?"evento del programa interactivo":"_TUPLE_"===t.substring(0,7)?"tupla de "+t.substring(7)+" componentes":t}}},function(t,e,r){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e,r,n){throw new s.GbsSyntaxError(t,e,r,n)}Object.defineProperty(e,"__esModule",{value:!0}),e.SymbolTable=e.LocalIndex=e.LocalParameter=e.LocalVariable=void 0;var o=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),a=r(0),s=r(1),u=function(){function t(e,r,i){n(this,t),this._typeName=e,this._constructorName=r,this._index=i}return o(t,[{key:"typeName",get:function(){return this._typeName}},{key:"constructorName",get:function(){return this._constructorName}},{key:"index",get:function(){return this._index}}]),t}(),c=(e.LocalVariable=Symbol.for("LocalVariable"),e.LocalParameter=Symbol.for("LocalParameter"),e.LocalIndex=Symbol.for("LocalIndex"),function(){function t(e,r){n(this,t),this._category=e,this._position=r}return o(t,[{key:"category",get:function(){return this._category}},{key:"position",get:function(){return this._position}}]),t}());e.SymbolTable=function(){function t(){n(this,t),this._program=null,this._isInteractiveProgram=!1,this._procedures={},this._procedureParameters={},this._functions={},this._functionParameters={},this._types={},this._typeConstructors={},this._constructors={},this._constructorType={},this._constructorFields={},this._fields={},this._localNames={}}return o(t,[{key:"isInteractiveProgram",value:function(){return this._isInteractiveProgram}},{key:"isProcedure",value:function(t){return t in this._procedures}},{key:"allProcedureNames",value:function(){var t=[];for(var e in this._procedures)t.push(e);return t.sort()}},{key:"procedureDefinition",value:function(t){if(this.isProcedure(t))return this._procedures[t];throw Error("Undefined procedure.")}},{key:"procedureParameters",value:function(t){if(this.isProcedure(t))return this._procedureParameters[t];throw Error("Undefined procedure.")}},{key:"isFunction",value:function(t){return t in this._functions}},{key:"allFunctionNames",value:function(){var t=[];for(var e in this._functions)t.push(e);return t.sort()}},{key:"functionDefinition",value:function(t){if(this.isFunction(t))return this._functions[t];throw Error("Undefined function.")}},{key:"functionParameters",value:function(t){if(this.isFunction(t))return this._functionParameters[t];throw Error("Undefined function.")}},{key:"isType",value:function(t){return t in this._types}},{key:"typeDefinition",value:function(t){if(this.isType(t))return this._types[t];throw Error("Undefined type.")}},{key:"typeConstructors",value:function(t){if(this.isType(t))return this._typeConstructors[t];throw Error("Undefined type.")}},{key:"isConstructor",value:function(t){return t in this._constructors}},{key:"constructorDeclaration",value:function(t){if(this.isConstructor(t))return this._constructors[t];throw Error("Undefined constructor.")}},{key:"constructorType",value:function(t){if(this.isConstructor(t))return this._constructorType[t];throw Error("Undefined constructor.")}},{key:"constructorFields",value:function(t){if(this.isConstructor(t))return this._constructorFields[t];throw Error("Undefined constructor.")}},{key:"isField",value:function(t){return t in this._fields}},{key:"fieldDescriptor",value:function(t){if(this.isField(t))return this._fields[t];throw Error("Undefined field.")}},{key:"defProgram",value:function(t){null!==this._program&&i(t.startPos,t.endPos,"program-already-defined",[(0,a.i18nPosition)(this._program.startPos),(0,a.i18nPosition)(t.startPos)]),this._program=t}},{key:"defInteractiveProgram",value:function(t){this.defProgram(t),this._isInteractiveProgram=!0}},{key:"defProcedure",value:function(t){var e=t.name.value;e in this._procedures&&i(t.name.startPos,t.name.endPos,"procedure-already-defined",[e,(0,a.i18nPosition)(this._procedures[e].startPos),(0,a.i18nPosition)(t.startPos)]);var r=[],n=!0,o=!1,s=void 0;try{for(var u,c=t.parameters[Symbol.iterator]();!(n=(u=c.next()).done);n=!0){var l=u.value;r.push(l.value)}}catch(t){o=!0,s=t}finally{try{!n&&c.return&&c.return()}finally{if(o)throw s}}this._procedures[e]=t,this._procedureParameters[e]=r}},{key:"defFunction",value:function(t){var e=t.name.value;if(e in this._functions)i(t.name.startPos,t.name.endPos,"function-already-defined",[e,(0,a.i18nPosition)(this._functions[e].startPos),(0,a.i18nPosition)(t.startPos)]);else if(e in this._fields){var r=this._constructors[this._fields[e][0].constructorName].startPos;i(t.name.startPos,t.name.endPos,"function-and-field-cannot-have-the-same-name",[e,(0,a.i18nPosition)(t.startPos),(0,a.i18nPosition)(r)])}var n=[],o=!0,s=!1,u=void 0;try{for(var c,l=t.parameters[Symbol.iterator]();!(o=(c=l.next()).done);o=!0){var h=c.value;n.push(h.value)}}catch(t){s=!0,u=t}finally{try{!o&&l.return&&l.return()}finally{if(s)throw u}}this._functions[e]=t,this._functionParameters[e]=n}},{key:"defType",value:function(t){var e=t.typeName.value;e in this._types&&i(t.typeName.startPos,t.typeName.endPos,"type-already-defined",[e,(0,a.i18nPosition)(this._types[e].startPos),(0,a.i18nPosition)(t.startPos)]),this._types[e]=t;var r=[],n=!0,o=!1,s=void 0;try{for(var u,c=t.constructorDeclarations[Symbol.iterator]();!(n=(u=c.next()).done);n=!0){var l=u.value;this._declareConstructor(e,l),r.push(l.constructorName.value)}}catch(t){o=!0,s=t}finally{try{!n&&c.return&&c.return()}finally{if(o)throw s}}this._typeConstructors[e]=r}},{key:"_declareConstructor",value:function(t,e){var r=e.constructorName.value;r in this._constructors&&i(e.constructorName.startPos,e.constructorName.endPos,"constructor-already-defined",[r,(0,a.i18nPosition)(this._constructors[r].startPos),(0,a.i18nPosition)(e.startPos)]),this._constructors[r]=e,this._constructorType[r]=t;var n={},o=[],s=0,u=!0,c=!1,l=void 0;try{for(var h,p=e.fieldNames[Symbol.iterator]();!(u=(h=p.next()).done);u=!0){var f=h.value;f.value in n&&i(f.startPos,f.endPos,"repeated-field-name",[r,f.value]),n[f.value]=!0,o.push(f.value),this._declareField(f.startPos,f.endPos,t,r,f.value,s),s++}}catch(t){c=!0,l=t}finally{try{!u&&p.return&&p.return()}finally{if(c)throw l}}this._constructorFields[r]=o}},{key:"_declareField",value:function(t,e,r,n,o,s){o in this._functions&&i(t,e,"function-and-field-cannot-have-the-same-name",[o,(0,a.i18nPosition)(this._functions[o].startPos),(0,a.i18nPosition)(t)]),o in this._fields||(this._fields[o]=[]),this._fields[o].push(new u(r,n,s))}},{key:"addNewLocalName",value:function(t,e){t.value in this._localNames&&i(t.startPos,t.endPos,"local-name-conflict",[t.value,(0,a.i18n)(Symbol.keyFor(this._localNames[t.value].category)),(0,a.i18nPosition)(this._localNames[t.value].position),(0,a.i18n)(Symbol.keyFor(e)),(0,a.i18nPosition)(t.startPos)]),this.setLocalName(t,e)}},{key:"setLocalName",value:function(t,e){t.value in this._localNames&&this._localNames[t.value].category!==e&&i(t.startPos,t.endPos,"local-name-conflict",[t.value,(0,a.i18n)(Symbol.keyFor(this._localNames[t.value].category)),(0,a.i18nPosition)(this._localNames[t.value].position),(0,a.i18n)(Symbol.keyFor(e)),(0,a.i18nPosition)(t.startPos)]),this._localNames[t.value]=new c(e,t.startPos)}},{key:"removeLocalName",value:function(t){delete this._localNames[t.value]}},{key:"exitScope",value:function(){this._localNames={}}},{key:"getAttributes",value:function(t){return"program"===t&&null!==this._program?this._program.attributes:t in this._procedures?this._procedures[t].attributes:t in this._functions?this._functions[t].attributes:t in this._types?this._types[t].attributes:{}}},{key:"program",get:function(){return this._program}}]),t}()},function(t,e,r){"use strict";function n(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t){if(t instanceof Array){var e=[],r=!0,n=!1,i=void 0;try{for(var o,s=t[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var u=o.value;e.push(a(u))}}catch(t){n=!0,i=t}finally{try{!r&&s.return&&s.return()}finally{if(n)throw i}}return"["+e.join(", ")+"]"}return t.toString()}Object.defineProperty(e,"__esModule",{value:!0}),e.ITypeCheck=e.IRestoreState=e.ISaveState=e.IPrimitiveCall=e.IPop=e.IDup=e.IAdd=e.IReadStructureFieldPop=e.IReadStructureField=e.IReadTupleComponent=e.IUpdateStructure=e.IMakeStructure=e.IMakeList=e.IMakeTuple=e.IReturn=e.ICall=e.IJumpIfTuple=e.IJumpIfStructure=e.IJumpIfFalse=e.IJump=e.ILabel=e.IUnsetVariable=e.ISetVariable=e.IPushVariable=e.IPushString=e.IPushInteger=e.Instruction=e.Code=e.I_TypeCheck=e.I_RestoreState=e.I_SaveState=e.I_PrimitiveCall=e.I_Pop=e.I_Dup=e.I_Add=e.I_ReadStructureFieldPop=e.I_ReadStructureField=e.I_ReadTupleComponent=e.I_UpdateStructure=e.I_MakeStructure=e.I_MakeList=e.I_MakeTuple=e.I_Return=e.I_Call=e.I_JumpIfTuple=e.I_JumpIfStructure=e.I_JumpIfFalse=e.I_Jump=e.I_Label=e.I_UnsetVariable=e.I_SetVariable=e.I_PushVariable=e.I_PushString=e.I_PushInteger=void 0;var s=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),u=r(6),c=e.I_PushInteger=Symbol.for("I_PushInteger"),l=e.I_PushString=Symbol.for("I_PushString"),h=e.I_PushVariable=Symbol.for("I_PushVariable"),p=e.I_SetVariable=Symbol.for("I_SetVariable"),f=e.I_UnsetVariable=Symbol.for("I_UnsetVariable"),_=e.I_Label=Symbol.for("I_Label"),m=e.I_Jump=Symbol.for("I_Jump"),d=e.I_JumpIfFalse=Symbol.for("I_JumpIfFalse"),v=e.I_JumpIfStructure=Symbol.for("I_JumpIfStructure"),y=e.I_JumpIfTuple=Symbol.for("I_JumpIfTuple"),g=e.I_Call=Symbol.for("I_Call"),b=e.I_Return=Symbol.for("I_Return"),T=e.I_MakeTuple=Symbol.for("I_MakeTuple"),P=e.I_MakeList=Symbol.for("I_MakeList"),S=e.I_MakeStructure=Symbol.for("I_MakeStructure"),k=e.I_UpdateStructure=Symbol.for("I_UpdateStructure"),E=e.I_ReadTupleComponent=Symbol.for("I_ReadTupleComponent"),w=e.I_ReadStructureField=Symbol.for("I_ReadStructureField"),I=e.I_ReadStructureFieldPop=Symbol.for("I_ReadStructureFieldPop"),N=e.I_Add=Symbol.for("I_Add"),C=e.I_Dup=Symbol.for("I_Dup"),R=e.I_Pop=Symbol.for("I_Pop"),O=e.I_PrimitiveCall=Symbol.for("I_PrimitiveCall"),x=e.I_SaveState=Symbol.for("I_SaveState"),A=e.I_RestoreState=Symbol.for("I_RestoreState"),L=e.I_TypeCheck=Symbol.for("I_TypeCheck"),F=(e.Code=function(){function t(e){o(this,t),this._instructions=e}return s(t,[{key:"toString",value:function(){var t=[],e=!0,r=!1,n=void 0;try{for(var i,o=this._instructions[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var a=i.value;t.push(a.toString())}}catch(t){r=!0,n=t}finally{try{!e&&o.return&&o.return()}finally{if(r)throw n}}return t.join("\n")}},{key:"produce",value:function(t){this._instructions.push(t)}},{key:"at",value:function(t){if(0<=t&&t<this._instructions.length)return this._instructions[t];throw Error("Code: instruction pointer out of range.")}},{key:"labelTargets",value:function(){for(var t={},e=0;e<this._instructions.length;e++)if(this._instructions[e].opcode===_){var r=this._instructions[e].label;if(r in t)throw Error('Code: label "'+r+'" is repeated.');t[r]=e}return t}}]),t}(),e.Instruction=function(){function t(e,r){o(this,t),this._opcode=e,this._args=r,this._startPos=u.UnknownPosition,this._endPos=u.UnknownPosition}return s(t,[{key:"toString",value:function(){var t=Symbol.keyFor(this._opcode).substring(2),e=[],r=!0,n=!1,i=void 0;try{for(var o,s=this._args[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var u=o.value;e.push(a(u))}}catch(t){n=!0,i=t}finally{try{!r&&s.return&&s.return()}finally{if(n)throw i}}return"  "+t+" "+e.join(", ")}},{key:"opcode",get:function(){return this._opcode}},{key:"args",get:function(){return this._args}},{key:"startPos",set:function(t){this._startPos=t},get:function(){return this._startPos}},{key:"endPos",set:function(t){this._endPos=t},get:function(){return this._endPos}}]),t}());e.IPushInteger=function(t){function e(t){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,c,[t]))}return i(e,t),s(e,[{key:"number",get:function(){return this._args[0]}}]),e}(F),e.IPushString=function(t){function e(t){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,l,[t]))}return i(e,t),s(e,[{key:"string",get:function(){return this._args[0]}}]),e}(F),e.IPushVariable=function(t){function e(t){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,h,[t]))}return i(e,t),s(e,[{key:"variableName",get:function(){return this._args[0]}}]),e}(F),e.ISetVariable=function(t){function e(t){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,p,[t]))}return i(e,t),s(e,[{key:"variableName",get:function(){return this._args[0]}}]),e}(F),e.IUnsetVariable=function(t){function e(t){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,f,[t]))}return i(e,t),s(e,[{key:"variableName",get:function(){return this._args[0]}}]),e}(F),e.ILabel=function(t){function e(t){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,_,[t]))}return i(e,t),s(e,[{key:"toString",value:function(){return this.label+":"}},{key:"label",get:function(){return this._args[0]}}]),e}(F),e.IJump=function(t){function e(t){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,m,[t]))}return i(e,t),s(e,[{key:"targetLabel",get:function(){return this._args[0]}}]),e}(F),e.IJumpIfFalse=function(t){function e(t){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,d,[t]))}return i(e,t),s(e,[{key:"targetLabel",get:function(){return this._args[0]}}]),e}(F),e.IJumpIfStructure=function(t){function e(t,r){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,v,[t,r]))}return i(e,t),s(e,[{key:"constructorName",get:function(){return this._args[0]}},{key:"targetLabel",get:function(){return this._args[1]}}]),e}(F),e.IJumpIfTuple=function(t){function e(t,r){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,y,[t,r]))}return i(e,t),s(e,[{key:"size",get:function(){return this._args[0]}},{key:"targetLabel",get:function(){return this._args[1]}}]),e}(F),e.ICall=function(t){function e(t,r){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,g,[t,r]))}return i(e,t),s(e,[{key:"targetLabel",get:function(){return this._args[0]}},{key:"nargs",get:function(){return this._args[1]}}]),e}(F),e.IReturn=function(t){function e(){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,b,[]))}return i(e,t),e}(F),e.IMakeTuple=function(t){function e(t){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,T,[t]))}return i(e,t),s(e,[{key:"size",get:function(){return this._args[0]}}]),e}(F),e.IMakeList=function(t){function e(t){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,P,[t]))}return i(e,t),s(e,[{key:"size",get:function(){return this._args[0]}}]),e}(F),e.IMakeStructure=function(t){function e(t,r,i){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,S,[t,r,i]))}return i(e,t),s(e,[{key:"typeName",get:function(){return this._args[0]}},{key:"constructorName",get:function(){return this._args[1]}},{key:"fieldNames",get:function(){return this._args[2]}}]),e}(F),e.IUpdateStructure=function(t){function e(t,r,i){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,k,[t,r,i]))}return i(e,t),s(e,[{key:"typeName",get:function(){return this._args[0]}},{key:"constructorName",get:function(){return this._args[1]}},{key:"fieldNames",get:function(){return this._args[2]}}]),e}(F),e.IReadTupleComponent=function(t){function e(t){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,E,[t]))}return i(e,t),s(e,[{key:"index",get:function(){return this._args[0]}}]),e}(F),e.IReadStructureField=function(t){function e(t){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,w,[t]))}return i(e,t),s(e,[{key:"fieldName",get:function(){return this._args[0]}}]),e}(F),e.IReadStructureFieldPop=function(t){function e(t){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,I,[t]))}return i(e,t),s(e,[{key:"fieldName",get:function(){return this._args[0]}}]),e}(F),e.IAdd=function(t){function e(){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,N,[]))}return i(e,t),e}(F),e.IDup=function(t){function e(){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,C,[]))}return i(e,t),e}(F),e.IPop=function(t){function e(){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,R,[]))}return i(e,t),e}(F),e.IPrimitiveCall=function(t){function e(t,r){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,O,[t,r]))}return i(e,t),s(e,[{key:"primitiveName",get:function(){return this._args[0]}},{key:"nargs",get:function(){return this._args[1]}}]),e}(F),e.ISaveState=function(t){function e(){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,x,[]))}return i(e,t),e}(F),e.IRestoreState=function(t){function e(){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,A,[]))}return i(e,t),e}(F),e.ITypeCheck=function(t){function e(t){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,L,[t]))}return i(e,t),s(e,[{key:"type",get:function(){return this._args[0]}}]),e}(F)},function(t,e,r){"use strict";function n(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t){var e=new l.RuntimeState;return e.load((0,f.apiboardToJboard)(t)),e}function s(t){return(0,f.apiboardFromJboard)(t.dump())}function u(t){var e=function(e){var r=t[e].map(function(t){var e=u(t);return e&&e.value});return{type:t.type().toString(),value:r}};return null===t?null:t.isInteger()?{type:(0,p.i18n)("TYPE:Integer"),value:t.asNumber()}:t.isBoolean()?{type:(0,p.i18n)("TYPE:Bool"),value:(0,l.boolFromValue)(t)}:t.isString()?{type:(0,p.i18n)("TYPE:String"),value:t.string}:t.isTuple()?e("components"):t.isList()?e("elements"):t.isStructure()?{type:t.typeName,value:t.toString()}:{type:t.type().toString(),value:t.toString()}}Object.defineProperty(e,"__esModule",{value:!0}),e.GobstonesInterpreterAPI=void 0;var c=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),l=r(4),h=r(14),p=r(0),f=r(21),_=r(5),m=r(2),d=function t(e){o(this,t),this.message=e.message,this.reason={code:e.reason,detail:e.args},this.on={range:{start:{row:e.startPos.line,column:e.startPos.column},end:{row:e.endPos.line,column:e.endPos.column}},region:e.startPos.region}},v=function(t){function e(t){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return i(e,t),e}(d),y=function(t){function e(t,r,i){o(this,e);var a=n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t)),s="timeout"===a.reason.code;return a.snapshots=s?[r[r.length-1]]:r,a.on.regionStack=i,a}return i(e,t),e}(d),g=function t(e,r,n){o(this,t),this.finalBoard=e,this.snapshots=r,this.returnValue=u(n),this.actualReturnValue=n},b=function(){function t(e){o(this,t),this.keys=this._collectKeyNames(e),this.timeout=this._timeoutValue(e),this.onInit=this._onInitFunction(e),this.onKey=this._onKeyFunction(e),this.onTimeout=this._onTimeoutFunction(e)}return c(t,[{key:"_hasInit",value:function(t){var e=!0,r=!1,n=void 0;try{for(var i,o=t.runner.symbolTable.program.branches[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var a=i.value,s=a.pattern;if(s.tag===m.N_PatternStructure&&s.constructorName.value===(0,p.i18n)("CONS:INIT"))return!0}}catch(t){r=!0,n=t}finally{try{!e&&o.return&&o.return()}finally{if(r)throw n}}return!1}},{key:"_hasTimeout",value:function(t){return null!==this.timeout}},{key:"_collectKeyNames",value:function(t){var e=[],r=!0,n=!1,i=void 0;try{for(var o,a=t.runner.symbolTable.program.branches[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){var s=o.value,u=s.pattern;u.tag===m.N_PatternStructure&&u.constructorName.value!==(0,p.i18n)("CONS:INIT")&&e.push(u.constructorName.value)}}catch(t){n=!0,i=t}finally{try{!r&&a.return&&a.return()}finally{if(n)throw i}}return e}},{key:"_timeoutValue",value:function(t){var e=!0,r=!1,n=void 0;try{for(var i,o=t.runner.symbolTable.program.branches[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var a=i.value;if(a.pattern.tag===m.N_PatternTimeout)return a.pattern.timeout}}catch(t){r=!0,n=t}finally{try{!e&&o.return&&o.return()}finally{if(r)throw n}}return null}},{key:"_onInitFunction",value:function(t){if(this._hasInit(t)){var e=this;return function(){return(0,p.i18nWithLanguage)(t.language,function(){return e._onEvent(t,new _.ValueStructure((0,p.i18n)("TYPE:Event"),(0,p.i18n)("CONS:INIT")))})}}return function(){return(0,p.i18nWithLanguage)(t.language,function(){return s(t.runner.globalState)})}}},{key:"_onTimeoutFunction",value:function(t){if(this._hasTimeout(t)){var e=this;return function(){return(0,p.i18nWithLanguage)(t.language,function(){return e._onEvent(t,new _.ValueStructure((0,p.i18n)("TYPE:Event"),(0,p.i18n)("CONS:TIMEOUT")))})}}return function(){return(0,p.i18nWithLanguage)(t.language,function(){return s(t.runner.globalState)})}}},{key:"_onKeyFunction",value:function(t){var e=this;return function(r){return(0,p.i18nWithLanguage)(t.language,function(){return e._onEvent(t,new _.ValueStructure((0,p.i18n)("TYPE:Event"),r))})}}},{key:"_onEvent",value:function(t,e){return(0,p.i18nWithLanguage)(t.language,function(){try{return t.runner.executeEventWithTimeout(e,t.infiniteLoopTimeout),s(t.runner.globalState)}catch(e){if(void 0===e.isGobstonesException)throw e;return new y(e,[],t.runner.regionStack())}})}}]),t}(),T=function(){function t(e){o(this,t),this._runner=e,this._snapshots=[]}return c(t,[{key:"takeSnapshot",value:function(t,e,r,n){this._shouldTakeSnapshot(t,r)&&this._snapshots.push(this._snapshot(t,e,r,n))}},{key:"snapshots",value:function(){return this._snapshots}},{key:"_snapshot",value:function(t,e,r,n){var i={};i.contextNames=[];var o=!0,a=!1,u=void 0;try{for(var c,l=r[Symbol.iterator]();!(o=(c=l.next()).done);o=!0){var h=c.value,p=h.routineName;"program"!==p&&(p=p+"-"+h.uniqueFrameId.toString()),i.contextNames.push(p)}}catch(t){a=!0,u=t}finally{try{!o&&l.return&&l.return()}finally{if(a)throw u}}return i.board=s(n),i.region=e.region,i.regionStack=this._runner.regionStack(),i}},{key:"_shouldTakeSnapshot",value:function(t,e){var r=[],n=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var u=a.value;r.push(u.routineName)}}catch(t){i=!0,o=t}finally{try{!n&&s.return&&s.return()}finally{if(i)throw o}}return this._runner.primitives.isProcedure(t)?this._noAtomicRoutines(r):(r.pop(),this._isRecorded(t)&&this._noAtomicRoutines(r))}},{key:"_noAtomicRoutines",value:function(t){var e=!0,r=!1,n=void 0;try{for(var i,o=t[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var a=i.value;if(this._isAtomic(a))return!1}}catch(t){r=!0,n=t}finally{try{!e&&o.return&&o.return()}finally{if(r)throw n}}return!0}},{key:"_isAtomic",value:function(t){return"program"!==t&&(!this._runner.primitives.isProcedure(t)&&!this._runner.symbolTable.isProcedure(t))}},{key:"_isRecorded",value:function(t){return"program"===t||(!!this._runner.primitives.isProcedure(t)||(this._runner.symbolTable.isProcedure(t),!1))}}]),t}(),P=function(){function t(e){o(this,t),null===e.runner.symbolTable.program?this.program=null:e.runner.symbolTable.isInteractiveProgram()?this.program=this._resultForInteractiveProgram(e):this.program=this._resultForProgram(e),this.declarations=this._collectDeclarations(e.runner),this.getAttributes=function(t){return e.runner.symbolTable.getAttributes(t)}}return c(t,[{key:"_resultForProgram",value:function(t){var e={};return e.alias="program",e.interpret=function(e){var r=new T(t.runner);return(0,p.i18nWithLanguage)(t.language,function(){try{t.runner.compile(),t.runner.executeWithTimeoutTakingSnapshots(a(e),t.infiniteLoopTimeout,r.takeSnapshot.bind(r));var n=s(t.runner.globalState),i=t.runner.result;return new g(n,r.snapshots(),i)}catch(e){if(void 0===e.isGobstonesException)throw e;return new y(e,r.snapshots(),t.runner.regionStack())}})},e}},{key:"_resultForInteractiveProgram",value:function(t){var e={};return e.alias="interactiveProgram",e.interpret=function(e){return(0,p.i18nWithLanguage)(t.language,function(){try{return t.runner.compile(),t.runner.initializeVirtualMachine(a(e)),new b(t)}catch(e){if(void 0===e.isGobstonesException)throw e;return new y(e,[],t.runner.regionStack())}})},e}},{key:"_collectDeclarations",value:function(t){var e=[],r=!0,n=!1,i=void 0;try{for(var o,a=t.symbolTable.allProcedureNames()[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){var s=o.value;t.primitives.isProcedure(s)||e.push({alias:"procedureDeclaration",name:s})}}catch(t){n=!0,i=t}finally{try{!r&&a.return&&a.return()}finally{if(n)throw i}}var u=!0,c=!1,l=void 0;try{for(var h,p=t.symbolTable.allFunctionNames()[Symbol.iterator]();!(u=(h=p.next()).done);u=!0){var f=h.value;t.primitives.isFunction(f)||e.push({alias:"functionDeclaration",name:f})}}catch(t){c=!0,l=t}finally{try{!u&&p.return&&p.return()}finally{if(c)throw l}}return e}}]),t}();e.GobstonesInterpreterAPI=function t(){o(this,t);var e={infiniteLoopTimeout:3e3,language:"es",runner:new h.Runner};this.config={setLanguage:function(t){e.language=t},setInfiniteLoopTimeout:function(t){e.infiniteLoopTimeout=t},setXGobstonesEnabled:function(t){}},this.gbb={read:function(t){return(0,f.apiboardFromJboard)((0,f.gbbToJboard)(t))},write:function(t){return(0,f.gbbFromJboard)((0,f.apiboardToJboard)(t))}},this.getAst=function(t){return this._withState(t,!1,function(t){return t.runner.abstractSyntaxTree.toMulangLike()})},this.parse=function(t){return this._withState(t,!0,function(t){return new P(t)})},this._withState=function(t,r,n){return(0,p.i18nWithLanguage)(e.language,function(){try{return e.runner.initialize(),e.runner.parse(t),e.runner.enableLintCheck("source-should-have-a-program-definition",!1),r&&e.runner.lint(),n(e)}catch(t){if(void 0===t.isGobstonesException)throw t;return new v(t)}})}}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.LOCALE_EN=void 0;var n=r(7),i=e.LOCALE_EN={};for(var o in n.LOCALE_ES)i[o]=n.LOCALE_ES[o];i["TYPE:Color"]="Color",i["CONS:Color0"]="Blue",i["CONS:Color1"]="Black",i["CONS:Color2"]="Red",i["CONS:Color3"]="Green",i["TYPE:Dir"]="Dir",i["CONS:Dir0"]="North",i["CONS:Dir1"]="East",i["CONS:Dir2"]="South",i["CONS:Dir3"]="West",i["PRIM:PutStone"]="Drop",i["PRIM:RemoveStone"]="Grab",i["PRIM:Move"]="Move",i["PRIM:GoToEdge"]="GoToEdge",i["PRIM:EmptyBoardContents"]="EmptyBoardContents",i["PRIM:numStones"]="numStones",i["PRIM:anyStones"]="anyStones",i["PRIM:canMove"]="canMove",i["PRIM:next"]="next",i["PRIM:prev"]="prev",i["PRIM:opposite"]="opposite",i["PRIM:minBool"]="minBool",i["PRIM:maxBool"]="maxBool",i["PRIM:minColor"]="minColor",i["PRIM:maxColor"]="maxColor",i["PRIM:minDir"]="minDir",i["PRIM:maxDir"]="maxDir",i["PRIM:head"]="head",i["PRIM:tail"]="tail",i["PRIM:oldTail"]="tail",i["PRIM:init"]="init",i["PRIM:last"]="last"},function(t,e,r){"use strict";function n(t){return'‘a palavra chave "'+t+'"'}function i(t,e,r){return 0===t?"nenhum "+e:1===t?"um "+e:t.toString()+" "+r}Object.defineProperty(e,"__esModule",{value:!0}),e.LOCALE_PT=void 0;var o=r(7),a=e.LOCALE_PT={};for(var s in o.LOCALE_ES)a[s]=o.LOCALE_ES[s];a.definition="uma definição (de programa, função, procedimento, ou tipo)",a.pattern='um padrão (comodín "_", construtor aplicado a variáveis, ou tupla)',a.statement="um comando",a.expression="uma expressão",a["procedure call"]="uma invocação a um procedimento",a["field name"]="o nome de um campo",a.T_EOF="o fim do arquivo",a.T_NUM="um número",a.T_STRING="uma corrente (string)",a.T_UPPERID="um identificador com maiúsculas",a.T_LOWERID="um identificador com minúsculas",a.T_PROGRAM=n("program"),a.T_INTERACTIVE=n("interactive"),a.T_PROCEDURE=n("procedure"),a.T_FUNCTION=n("function"),a.T_RETURN=n("return"),a.T_IF=n("if"),a.T_THEN=n("then"),a.T_ELSE=n("else"),a.T_REPEAT=n("repeat"),a.T_FOREACH=n("foreach"),a.T_IN=n("in"),a.T_WHILE=n("while"),a.T_SWITCH=n("switch"),a.T_TO=n("to"),a.T_LET=n("let"),a.T_NOT=n("not"),a.T_DIV=n("div"),a.T_MOD=n("mod"),a.T_TYPE=n("type"),a.T_IS=n("is"),a.T_RECORD=n("record"),a.T_VARIANT=n("variant"),a.T_CASE=n("case"),a.T_FIELD=n("field"),a.T_UNDERSCORE='um sublinhado ("_")',a.T_LPAREN='um parênteses esquerdo ("(")',a.T_RPAREN='um parênteses direito (")")',a.T_LBRACE='uma chave esquerda ("{")',a.T_RBRACE='uma chave direita ("}")',a.T_LBRACK='um colchete esquerdo ("[")',a.T_RBRACK='um colchete direito ("]")',a.T_COMMA='uma vírgula  (",")',a.T_SEMICOLON='um ponto e vírgula (";")',a.T_RANGE='um separador de intervalo ("..")',a.T_GETS='uma flecha para a esquerda ("<-")',a.T_PIPE='uma barra vertical ("|")',a.T_ARROW='uma flecha ("->")',a.T_ASSIGN='um operador de designação  (":=")',a.T_EQ='uma comparação por igualdade ("==")',a.T_NE='uma comparação por desigualdade ("/=")',a.T_LE='um menor ou igual ("<=")',a.T_GE='um maior ou igual (">=")',a.T_LT='um menor estrito ("<")',a.T_GT='um maior estrito (">")',a.T_AND='o "e" lógico ("&&")',a.T_OR='o "ou" lógico ("||")',a.T_CONCAT='o operador de concatenação de listas ("++")',a.T_PLUS='o operador de soma ("+")',a.T_MINUS='o operador de diferença ("-")',a.T_TIMES='o operador de produto ("*")',a.T_POW='o operador de potência ("^")',a.LocalVariable="variável",a.LocalIndex="índice",a.LocalParameter="parâmetro",a.V_Integer="um número",a.V_String="uma cadeia",a.V_Tuple="uma tupla",a.V_List="uma lista",a.V_Structure="uma estrutura",a["errmsg:unclosed-multiline-comment"]="O comentário abre mas nunca fecha.",a["errmsg:unclosed-string-constant"]="As aspas que abrem não possuem as aspas correspondentes que fecham.",a["errmsg:numeric-constant-should-not-have-leading-zeroes"]="As constantes numéricas não podem ser escritas com zeros à esquerda.",a["errmsg:identifier-must-start-with-alphabetic-character"]="Os identificadores devem começar com um caractere alfabético (a...z,A...Z).",a["errmsg:unknown-token"]=function(t){return'Símbolo desconhecido na entrada: "'+t+'".'},a["warning:empty-pragma"]="Diretiva pragma vazia.",a["warning:unknown-pragma"]=function(t){return'Diretiva pragma desconhecida: "'+t+'".'},a["errmsg:empty-source"]="O programa está vazio.",a["errmsg:expected-but-found"]=function(t,e){return"Esperava-se "+t+".\nEncontrado: "+e+"."},a["errmsg:pattern-number-cannot-be-negative-zero"]='O padrão numérico não pode ser "-0".',a["errmsg:pattern-tuple-cannot-be-singleton"]="O padrão para uma tupla não pode ter apenas um componente. As tuplas têm 0, 2, 3, ou mais componentes, mas não 1.",a["errmsg:assignment-tuple-cannot-be-singleton"]="A designação a uma tupla não pode ser  constituída por apenas um componente. As tuplas têm 0, 2, 3, ou mais componentes, mas não 1.",a["errmsg:operators-are-not-associative"]=function(t,e){return"A expressão usa "+t+" e "+e+", mas estes operadores não podem ser associados. Talvez faltam parênteses."},a["errmsg:obsolete-tuple-assignment"]='Esperava-se um comando mas não foi encontrado um parênteses esquerdo. Nota: a sintaxe de designação de tuplas "(x1, ..., xN) := y" está obsoleta. Usar "let (x1, ..., xN) := y".',a["errmsg:program-already-defined"]=function(t,e){return"Já havia um programa definido em "+t+".\nNão é possível definir um programa em "+e+"."},a["errmsg:procedure-already-defined"]=function(t,e,r){return'O procedimiento "'+t+'" está definido duas vezes: em '+e+" e em "+r+"."},a["errmsg:function-already-defined"]=function(t,e,r){return'A função "'+t+'" está definida duas vezes: em '+e+" e em "+r+"."},a["errmsg:type-already-defined"]=function(t,e,r){return'O tipo "'+t+'" está definido duas vezes: em '+e+" e em "+r+"."},a["errmsg:constructor-already-defined"]=function(t,e,r){return'O construtor "'+t+'" está definido duas vezes: em '+e+" e em "+r+"."},a["errmsg:repeated-field-name"]=function(t,e){return'O campo "'+e+'" não pode estar repetido para o construtor "'+t+'".'},a["errmsg:function-and-field-cannot-have-the-same-name"]=function(t,e,r){return'O nome "'+t+'" usa-se para uma função em '+e+" e para um campo em "+r+"."},a["errmsg:source-should-have-a-program-definition"]='O código deve ter uma definição de "program { ... }".',a["errmsg:procedure-should-not-have-return"]=function(t){return'O procedimento "'+t+'" não deveria ter um comando "return".'},a["errmsg:function-should-have-return"]=function(t){return'A função "'+t+'" deveria ter um comando "return".'},a["errmsg:return-statement-not-allowed-here"]='O comando "return"  pode aparecer apenas como o último comando de uma função ou como o último comando do programa.',a["errmsg:local-name-conflict"]=function(t,e,r,n,i){return'Conflito de nomes: "'+t+'" se usa duas vezes: como '+e+" em "+r+", e como "+n+" em "+i+"."},a["errmsg:repeated-variable-in-tuple-assignment"]=function(t){return'La variável "'+t+'" está repetida na designação de tuplas.'},a["errmsg:constructor-used-as-procedure"]=function(t,e){return'O procedimento "'+t+'" não está definido. O nome "'+t+'" é o nome de um construtor do tipo "'+e+'".'},a["errmsg:undefined-procedure"]=function(t){return'O procedimento "'+t+'" não está definido.'},a["errmsg:undefined-function"]=function(t){return'A função "'+t+'" não está definida.'},a["errmsg:procedure-arity-mismatch"]=function(t,e,r){return'O procedimento "'+t+'" espera receber '+o.LOCALE_ES["<n>-parameters"](e)+" mas é invocado com "+o.LOCALE_ES["<n>-arguments"](r)+"."},a["errmsg:function-arity-mismatch"]=function(t,e,r){return'A função "'+t+'" espera receber '+o.LOCALE_ES["<n>-parameters"](e)+" mas é invocado com "+o.LOCALE_ES["<n>-arguments"](r)+"."},a["errmsg:structure-pattern-arity-mismatch"]=function(t,e,r){return'O construtor "'+t+'" tem '+o.LOCALE_ES["<n>-fields"](e)+" mas o padrão tem "+o.LOCALE_ES["<n>-parameters"](r)+"."},a["errmsg:type-used-as-constructor"]=function(t,e){var r=void 0;return r=0===e.length?"(não tem construtores).":1===e.length?"(tem um construtor: "+e[0]+").":"(seus construtores são: "+e.join(", ")+").",'O construtor "'+t+'" não está definido. O nome "'+t+'" é o nome de um tipo '+r},a["errmsg:procedure-used-as-constructor"]=function(t){return'O construtor "'+t+'" não está definido. O nome "'+t+'" é o nome de um procedimento.'},a["errmsg:undeclared-constructor"]=function(t){return'O construtor "'+t+'" não está definido.'},a["errmsg:wildcard-pattern-should-be-last"]='O comodín "_" tem que ser o último ramo do switch.',a["errmsg:numeric-pattern-repeats-number"]=function(t){return'Tem dois ramos diferentes para o número "'+t+'".'},a["errmsg:structure-pattern-repeats-constructor"]=function(t){return'Há dois ramos distintos para o construtor "'+t+'".'},a["errmsg:structure-pattern-repeats-tuple-arity"]=function(t){return"Há dois ramos distintos para as tuplas de "+t.toString()+" componentes."},a["errmsg:structure-pattern-repeats-timeout"]="Há dois ramos distintos para o TIMEOUT.",a["errmsg:pattern-does-not-match-type"]=function(t,e){return'Os padrões devem ser todos do mesmo tipo. O padrão deveria ser de tipo "'+t+'" pero es de tipo "'+e+'".'},a["errmsg:patterns-in-interactive-program-must-be-events"]='Os padrões de um "interactive program" devem ser eventos.',a["errmsg:patterns-in-switch-must-not-be-events"]='Os padrões de um "switch" não podem ser eventos.',a["errmsg:structure-construction-repeated-field"]=function(t,e){return'O campo "'+e+'" está repetido em a instanciação do construtor "'+t+'".'},a["errmsg:structure-construction-invalid-field"]=function(t,e){return'O campo "'+e+'" não é um campo válido para o construtor "'+t+'".'},a["errmsg:structure-construction-missing-field"]=function(t,e){return'Falta dar valor ao campo "'+e+'" do construtor "'+t+'".'},a["errmsg:structure-construction-cannot-be-an-event"]=function(t){return'O construtor "'+t+'" corresponde a um evento, e só pode ser administrado implicitamente em um programa interativo (o usuário não pode construir instâncias).'},a["errmsg:undefined-variable"]=function(t){return'A variável "'+t+'" não está definida.'},a["errmsg:too-few-arguments"]=function(t){return'Faltam argumentos para "'+t+'".'},a["errmsg:expected-structure-but-got"]=function(t,e){return'Esperava-se uma estrutura construída com o construtor "'+t+'", mas foi recebido '+e+"."},a["errmsg:expected-constructor-but-got"]=function(t,e){return'Esperava-se uma estrutura construída com o construtor "'+t+'", mas o construtor recebido é '+e+'".'},a["errmsg:incompatible-types-on-assignment"]=function(t,e,r){return'A variável "'+t+'" continha un valor do tipo '+e+", não é possível designar um valor de tipo "+r+'".'},a["errmsg:incompatible-types-on-list-creation"]=function(t,e,r){return"Todos os elementos de uma lista devem ser do mesmo tipo. Os elementos são do tipo "+e+", mas o elemento na posição "+t.toString()+" é do tipo "+r+"."},a["errmsg:incompatible-types-on-structure-update"]=function(t,e,r){return'O campo "'+t+'" é do tipo '+e+". Não pode ser atualizado com um valor do tipo "+r+"."},a["errmsg:expected-tuple-value-but-got"]=function(t){return"Esperava-se uma tupla mas um valor não foi recebido de tipo "+t+"."},a["errmsg:tuple-component-out-of-bounds"]=function(t,e){return"Índice fora do intervalo. A tupla é do tamanho "+t.toString()+" e o índice é "+e.toString()+"."},a["errmsg:expected-structure-value-but-got"]=function(t){return"Se esperaba una estructura pero se recibió un valor de tipo "+t+"."},a["errmsg:structure-field-not-present"]=function(t,e){return'A estrutura não possui um campo "'+e+'". Os campos são: ['+t.join(", ")+"]."},a["errmsg:primitive-does-not-exist"]=function(t){return'A operação primitiva "'+t+'" não existe ou não está disponível.'},a["errmsg:primitive-arity-mismatch"]=function(t,e,r){return'A operação "'+t+'" espera receber '+o.LOCALE_ES["<n>-parameters"](e)+" mas é invocada com "+o.LOCALE_ES["<n>-arguments"](r)+"."},a["errmsg:primitive-argument-type-mismatch"]=function(t,e,r,n){return"O parâmetro #"+e.toString()+' da operação "'+t+'" deveria ser do tipo '+r+" mas o argumento é do tipo "+n+"."},a["errmsg:expected-value-of-type-but-got"]=function(t,e){return"Esperava-se um valor do tipo "+t+" mas foi recebido um valor do tipo "+e+"."},a["errmsg:expected-value-of-some-type-but-got"]=function(t,e){return"Esperava-se um valor de algum dos seguintes tipos: "+t.join(", ")+"; mas foi recebido um valor do tipo "+e+"."},a["errmsg:expected-values-to-have-compatible-types"]=function(t,e){return"Os tipos dos valores devem ser compatíveis, mas um é do tipo "+t+" e o outro é do tipo "+e+"."},a["errmsg:switch-does-not-match"]="O valor analisado não coincide com nenhum dos ramos do switch.",a["errmsg:cannot-divide-by-zero"]="Não é possível dividir por zero.",a["errmsg:list-cannot-be-empty"]="A lista não pode ser vazia.",a["errmsg:timeout"]=function(t){return"A execução do programa demorou mais de "+t.toString()+"ms."},a["errmsg:cannot-move-to"]=function(t){return"Não é possível mover para a direção "+t+": cai fora do tabuleiro."},a["errmsg:cannot-remove-stone"]=function(t){return"Não é posível retirar uma pedra de cor "+t+": não há pedras dessa cor."},a["TYPE:Color"]="Cor",a["CONS:Color0"]="Azul",a["CONS:Color1"]="Preto",a["CONS:Color2"]="Vermelho",a["CONS:Color3"]="Verde",a["TYPE:Dir"]="Dir",a["CONS:Dir0"]="Norte",a["CONS:Dir1"]="Leste",a["CONS:Dir2"]="Sul",a["CONS:Dir3"]="Oeste",a["PRIM:PutStone"]="Colocar",a["PRIM:RemoveStone"]="Retirar",a["PRIM:Move"]="Mover",a["PRIM:GoToEdge"]="IrABorda",a["PRIM:EmptyBoardContents"]="EsvaziarTabuleiro",a["PRIM:numStones"]="nroPedras",a["PRIM:anyStones"]="haPedras",a["PRIM:canMove"]="podeMover",a["PRIM:next"]="seguinte",a["PRIM:prev"]="previo",a["PRIM:opposite"]="oposto",a["PRIM:minBool"]="minBool",a["PRIM:maxBool"]="maxBool",a["PRIM:minColor"]="minCor",a["PRIM:maxColor"]="maxCor",a["PRIM:minDir"]="minDir",a["PRIM:maxDir"]="maxDir",a["PRIM:head"]="primeiro",a["PRIM:tail"]="resto",a["PRIM:oldTail"]="resto",a["PRIM:init"]="comeco",a["PRIM:last"]="ultimo",a["<alternative>"]=function(t){return"alguma das seguintes alternativas:\n"+t.map(function(t){return"  "+t}).join("\n")},a["<position>"]=function(t,e,r){return t+":"+e.toString()+":"+r.toString()},a["<n>-parameters"]=function(t){return i(t,"parâmetro","parâmetros")},a["<n>-arguments"]=function(t){return i(t,"argumento","argumentos")},a["<n>-fields"]=function(t){return i(t,"campo","campos")},a["<pattern-type>"]=function(t){return"Event"===t?"evento do programa interativo":"_TUPLE_"===t.substring(0,7)?"tupla de "+t.substring(7)+" componentes":t}},function(t,e,r){"use strict";function n(t,e){return void 0===t?n[0]:void 0!==e?10==+e?q(t):et(t,e):q(t)}function i(t,e){this.value=t,this.sign=e,this.isSmall=!1}function o(t){this.value=t,this.sign=t<0,this.isSmall=!0}function a(t){return-z<t&&t<z}function s(t){return t<1e7?[t]:t<1e14?[t%1e7,Math.floor(t/1e7)]:[t%1e7,Math.floor(t/1e7)%1e7,Math.floor(t/1e14)]}function u(t){c(t);var e=t.length;if(e<4&&C(t,Y)<0)switch(e){case 0:return 0;case 1:return t[0];case 2:return t[0]+t[1]*J;default:return t[0]+(t[1]+t[2]*J)*J}return t}function c(t){for(var e=t.length;0===t[--e];);t.length=e+1}function l(t){for(var e=new Array(t),r=-1;++r<t;)e[r]=0;return e}function h(t){return t>0?Math.floor(t):Math.ceil(t)}function p(t,e){var r,n,i=t.length,o=e.length,a=new Array(i),s=0,u=J;for(n=0;n<o;n++)r=t[n]+e[n]+s,s=r>=u?1:0,a[n]=r-s*u;for(;n<i;)r=t[n]+s,s=r===u?1:0,a[n++]=r-s*u;return s>0&&a.push(s),a}function f(t,e){return t.length>=e.length?p(t,e):p(e,t)}function _(t,e){var r,n,i=t.length,o=new Array(i),a=J;for(n=0;n<i;n++)r=t[n]-a+e,e=Math.floor(r/a),o[n]=r-e*a,e+=1;for(;e>0;)o[n++]=e%a,e=Math.floor(e/a);return o}function m(t,e){var r,n,i=t.length,o=e.length,a=new Array(i),s=0,u=J;for(r=0;r<o;r++)n=t[r]-s-e[r],n<0?(n+=u,s=1):s=0,a[r]=n;for(r=o;r<i;r++){if(!((n=t[r]-s)<0)){a[r++]=n;break}n+=u,a[r]=n}for(;r<i;r++)a[r]=t[r];return c(a),a}function d(t,e,r){var n;return C(t,e)>=0?n=m(t,e):(n=m(e,t),r=!r),n=u(n),"number"==typeof n?(r&&(n=-n),new o(n)):new i(n,r)}function v(t,e,r){var n,a,s=t.length,c=new Array(s),l=-e,h=J;for(n=0;n<s;n++)a=t[n]+l,l=Math.floor(a/h),a%=h,c[n]=a<0?a+h:a;return c=u(c),"number"==typeof c?(r&&(c=-c),new o(c)):new i(c,r)}function y(t,e){var r,n,i,o,a,s=t.length,u=e.length,h=s+u,p=l(h),f=J;for(i=0;i<s;++i){o=t[i];for(var _=0;_<u;++_)a=e[_],r=o*a+p[i+_],n=Math.floor(r/f),p[i+_]=r-n*f,p[i+_+1]+=n}return c(p),p}function g(t,e){var r,n,i=t.length,o=new Array(i),a=J,s=0;for(n=0;n<i;n++)r=t[n]*e+s,s=Math.floor(r/a),o[n]=r-s*a;for(;s>0;)o[n++]=s%a,s=Math.floor(s/a);return o}function b(t,e){for(var r=[];e-- >0;)r.push(0);return r.concat(t)}function T(t,e){var r=Math.max(t.length,e.length);if(r<=30)return y(t,e);r=Math.ceil(r/2);var n=t.slice(r),i=t.slice(0,r),o=e.slice(r),a=e.slice(0,r),s=T(i,a),u=T(n,o),l=T(f(i,n),f(a,o)),h=f(f(s,b(m(m(l,s),u),r)),b(u,2*r));return c(h),h}function P(t,e){return-.012*t-.012*e+15e-6*t*e>0}function S(t,e,r){return t<J?new i(g(e,t),r):new i(y(e,s(t)),r)}function k(t){var e,r,n,i,o,a=t.length,s=l(a+a),u=J;for(n=0;n<a;n++){i=t[n];for(var h=0;h<a;h++)o=t[h],e=i*o+s[n+h],r=Math.floor(e/u),s[n+h]=e-r*u,s[n+h+1]+=r}return c(s),s}function E(t,e){var r,n,i,o,a,s,c,h=t.length,p=e.length,f=J,_=l(e.length),m=e[p-1],d=Math.ceil(f/(2*m)),v=g(t,d),y=g(e,d);for(v.length<=h&&v.push(0),y.push(0),m=y[p-1],n=h-p;n>=0;n--){for(r=f-1,v[n+p]!==m&&(r=Math.floor((v[n+p]*f+v[n+p-1])/m)),i=0,o=0,s=y.length,a=0;a<s;a++)i+=r*y[a],c=Math.floor(i/f),o+=v[n+a]-(i-c*f),i=c,o<0?(v[n+a]=o+f,o=-1):(v[n+a]=o,o=0);for(;0!==o;){for(r-=1,i=0,a=0;a<s;a++)i+=v[n+a]-f+y[a],i<0?(v[n+a]=i+f,i=0):(v[n+a]=i,i=1);o+=i}_[n]=r}return v=I(v,d)[0],[u(_),u(v)]}function w(t,e){for(var r,n,i,o,a,s=t.length,l=e.length,h=[],p=[],f=J;s;)if(p.unshift(t[--s]),c(p),C(p,e)<0)h.push(0);else{n=p.length,i=p[n-1]*f+p[n-2],o=e[l-1]*f+e[l-2],n>l&&(i=(i+1)*f),r=Math.ceil(i/o);do{if(a=g(e,r),C(a,p)<=0)break;r--}while(r);h.push(r),p=m(p,a)}return h.reverse(),[u(h),u(p)]}function I(t,e){var r,n,i,o,a=t.length,s=l(a),u=J;for(i=0,r=a-1;r>=0;--r)o=i*u+t[r],n=h(o/e),i=o-n*e,s[r]=0|n;return[s,0|i]}function N(t,e){var r,a,c=q(e),l=t.value,p=c.value;if(0===p)throw new Error("Cannot divide by zero");if(t.isSmall)return c.isSmall?[new o(h(l/p)),new o(l%p)]:[n[0],t];if(c.isSmall){if(1===p)return[t,n[0]];if(-1==p)return[t.negate(),n[0]];var f=Math.abs(p);if(f<J){r=I(l,f),a=u(r[0]);var _=r[1];return t.sign&&(_=-_),"number"==typeof a?(t.sign!==c.sign&&(a=-a),[new o(a),new o(_)]):[new i(a,t.sign!==c.sign),new o(_)]}p=s(f)}var m=C(l,p);if(-1===m)return[n[0],t];if(0===m)return[n[t.sign===c.sign?1:-1],n[0]];r=l.length+p.length<=200?E(l,p):w(l,p),a=r[0];var d=t.sign!==c.sign,v=r[1],y=t.sign;return"number"==typeof a?(d&&(a=-a),a=new o(a)):a=new i(a,d),"number"==typeof v?(y&&(v=-v),v=new o(v)):v=new i(v,y),[a,v]}function C(t,e){if(t.length!==e.length)return t.length>e.length?1:-1;for(var r=t.length-1;r>=0;r--)if(t[r]!==e[r])return t[r]>e[r]?1:-1;return 0}function R(t){var e=t.abs();return!e.isUnit()&&(!!(e.equals(2)||e.equals(3)||e.equals(5))||!(e.isEven()||e.isDivisibleBy(3)||e.isDivisibleBy(5))&&(!!e.lesser(25)||void 0))}function O(t){return("number"==typeof t||"string"==typeof t)&&+Math.abs(t)<=J||t instanceof i&&t.value.length<=1}function x(t,e,r){e=q(e);for(var n=t.isNegative(),i=e.isNegative(),o=n?t.not():t,a=i?e.not():e,s=[],u=[],c=!1,l=!1;!c||!l;)o.isZero()?(c=!0,s.push(n?1:0)):n?s.push(o.isEven()?1:0):s.push(o.isEven()?0:1),a.isZero()?(l=!0,u.push(i?1:0)):i?u.push(a.isEven()?1:0):u.push(a.isEven()?0:1),o=o.over(2),a=a.over(2);for(var h=[],p=0;p<s.length;p++)h.push(r(s[p],u[p]));for(var f=bigInt(h.pop()).negate().times(bigInt(2).pow(h.length));h.length;)f=f.add(bigInt(h.pop()).times(bigInt(2).pow(h.length)));return f}function A(t){var e=t.value,r="number"==typeof e?e|$:e[0]+e[1]*J|tt;return r&-r}function L(t,e){return t=q(t),e=q(e),t.greater(e)?t:e}function F(t,e){return t=q(t),e=q(e),t.lesser(e)?t:e}function M(t,e){if(t=q(t).abs(),e=q(e).abs(),t.equals(e))return t;if(t.isZero())return e;if(e.isZero())return t;for(var r,i,o=n[1];t.isEven()&&e.isEven();)r=Math.min(A(t),A(e)),t=t.divide(r),e=e.divide(r),o=o.multiply(r);for(;t.isEven();)t=t.divide(A(t));do{for(;e.isEven();)e=e.divide(A(e));t.greater(e)&&(i=e,e=t,t=i),e=e.subtract(t)}while(!e.isZero());return o.isUnit()?t:t.multiply(o)}function D(t,e){return t=q(t).abs(),e=q(e).abs(),t.divide(M(t,e)).multiply(e)}function V(t,e){t=q(t),e=q(e);var r=F(t,e),n=L(t,e),a=n.subtract(r);if(a.isSmall)return r.add(Math.round(Math.random()*a));for(var s=a.value.length-1,c=[],l=!0,p=s;p>=0;p--){var f=l?a.value[p]:J,_=h(Math.random()*f);c.unshift(_),_<f&&(l=!1)}return c=u(c),r.add("number"==typeof c?new o(c):new i(c,!1))}function B(t,e,r){var i,o=n[0],a=n[1];for(i=t.length-1;i>=0;i--)o=o.add(t[i].times(a)),a=a.times(e);return r?o.negate():o}function j(t){var e=t.value;return"number"==typeof e&&(e=[e]),1===e.length&&e[0]<=35?"0123456789abcdefghijklmnopqrstuvwxyz".charAt(e[0]):"<"+e+">"}function U(t,e){if(e=bigInt(e),e.isZero()){if(t.isZero())return"0";throw new Error("Cannot convert nonzero numbers to base 0.")}if(e.equals(-1))return t.isZero()?"0":t.isNegative()?new Array(1-t).join("10"):"1"+new Array(+t).join("01");var r="";if(t.isNegative()&&e.isPositive()&&(r="-",t=t.abs()),e.equals(1))return t.isZero()?"0":r+new Array(+t+1).join(1);for(var n,i=[],o=t;o.isNegative()||o.compareAbs(e)>=0;){n=o.divmod(e),o=n.quotient;var a=n.remainder;a.isNegative()&&(a=e.minus(a).abs(),o=o.next()),i.push(j(a))}return i.push(j(o)),r+i.reverse().join("")}function W(t){if(a(+t)){var e=+t;if(e===h(e))return new o(e);throw"Invalid integer: "+t}var r="-"===t[0];r&&(t=t.slice(1));var n=t.split(/e/i);if(n.length>2)throw new Error("Invalid integer: "+n.join("e"));if(2===n.length){var s=n[1];if("+"===s[0]&&(s=s.slice(1)),(s=+s)!==h(s)||!a(s))throw new Error("Invalid integer: "+s+" is not a valid exponent.");var u=n[0],l=u.indexOf(".");if(l>=0&&(s-=u.length-l-1,u=u.slice(0,l)+u.slice(l+1)),s<0)throw new Error("Cannot include negative exponent part for integers");u+=new Array(s+1).join("0"),t=u}if(!/^([0-9][0-9]*)$/.test(t))throw new Error("Invalid integer: "+t);for(var p=[],f=t.length,_=H,m=f-_;f>0;)p.push(+t.slice(m,f)),m-=_,m<0&&(m=0),f-=_;return c(p),new i(p,r)}function G(t){if(a(t)){if(t!==h(t))throw new Error(t+" is not an integer.");return new o(t)}return W(t.toString())}function q(t){return"number"==typeof t?G(t):"string"==typeof t?W(t):t}Object.defineProperty(e,"__esModule",{value:!0}),e.Integer=n;var J=1e7,H=7,z=9007199254740992,Y=s(z),K=Math.log(z);i.prototype=Object.create(n.prototype),o.prototype=Object.create(n.prototype),i.prototype.add=function(t){var e=q(t);if(this.sign!==e.sign)return this.subtract(e.negate());var r=this.value,n=e.value;return e.isSmall?new i(_(r,Math.abs(n)),this.sign):new i(f(r,n),this.sign)},i.prototype.plus=i.prototype.add,o.prototype.add=function(t){var e=q(t),r=this.value;if(r<0!==e.sign)return this.subtract(e.negate());var n=e.value;if(e.isSmall){if(a(r+n))return new o(r+n);n=s(Math.abs(n))}return new i(_(n,Math.abs(r)),r<0)},o.prototype.plus=o.prototype.add,i.prototype.subtract=function(t){var e=q(t);if(this.sign!==e.sign)return this.add(e.negate());var r=this.value,n=e.value;return e.isSmall?v(r,Math.abs(n),this.sign):d(r,n,this.sign)},i.prototype.minus=i.prototype.subtract,o.prototype.subtract=function(t){var e=q(t),r=this.value;if(r<0!==e.sign)return this.add(e.negate());var n=e.value;return e.isSmall?new o(r-n):v(n,Math.abs(r),r>=0)},o.prototype.minus=o.prototype.subtract,i.prototype.negate=function(){return new i(this.value,!this.sign)},o.prototype.negate=function(){var t=this.sign,e=new o(-this.value);return e.sign=!t,e},i.prototype.abs=function(){return new i(this.value,!1)},o.prototype.abs=function(){return new o(Math.abs(this.value))},i.prototype.multiply=function(t){var e,r=q(t),o=this.value,a=r.value,u=this.sign!==r.sign;if(r.isSmall){if(0===a)return n[0];if(1===a)return this;if(-1===a)return this.negate();if((e=Math.abs(a))<J)return new i(g(o,e),u);a=s(e)}return P(o.length,a.length)?new i(T(o,a),u):new i(y(o,a),u)},i.prototype.times=i.prototype.multiply,o.prototype._multiplyBySmall=function(t){return a(t.value*this.value)?new o(t.value*this.value):S(Math.abs(t.value),s(Math.abs(this.value)),this.sign!==t.sign)},i.prototype._multiplyBySmall=function(t){return 0===t.value?n[0]:1===t.value?this:-1===t.value?this.negate():S(Math.abs(t.value),this.value,this.sign!==t.sign)},o.prototype.multiply=function(t){return q(t)._multiplyBySmall(this)},o.prototype.times=o.prototype.multiply,i.prototype.square=function(){return new i(k(this.value),!1)},o.prototype.square=function(){var t=this.value*this.value;return a(t)?new o(t):new i(k(s(Math.abs(this.value))),!1)},i.prototype.divmod=function(t){var e=N(this,t);return{quotient:e[0],remainder:e[1]}},o.prototype.divmod=i.prototype.divmod,i.prototype.divide=function(t){return N(this,t)[0]},o.prototype.over=o.prototype.divide=i.prototype.over=i.prototype.divide,i.prototype.mod=function(t){return N(this,t)[1]},o.prototype.remainder=o.prototype.mod=i.prototype.remainder=i.prototype.mod,i.prototype.pow=function(t){var e,r,i,s=q(t),u=this.value,c=s.value;if(0===c)return n[1];if(0===u)return n[0];if(1===u)return n[1];if(-1===u)return s.isEven()?n[1]:n[-1];if(s.sign)return n[0];if(!s.isSmall)throw new Error("The exponent "+s.toString()+" is too large.");if(this.isSmall&&a(e=Math.pow(u,c)))return new o(h(e));for(r=this,i=n[1];;){if(!0&c&&(i=i.times(r),--c),0===c)break;c/=2,r=r.square()}return i},o.prototype.pow=i.prototype.pow,i.prototype.modPow=function(t,e){if(t=q(t),e=q(e),e.isZero())throw new Error("Cannot take modPow with modulus 0");for(var r=n[1],i=this.mod(e);t.isPositive();){if(i.isZero())return n[0];t.isOdd()&&(r=r.multiply(i).mod(e)),t=t.divide(2),i=i.square().mod(e)}return r},o.prototype.modPow=i.prototype.modPow,i.prototype.compareAbs=function(t){var e=q(t),r=this.value,n=e.value;return e.isSmall?1:C(r,n)},o.prototype.compareAbs=function(t){var e=q(t),r=Math.abs(this.value),n=e.value;return e.isSmall?(n=Math.abs(n),r===n?0:r>n?1:-1):-1},i.prototype.compare=function(t){if(t===1/0)return-1;if(t===-1/0)return 1;var e=q(t),r=this.value,n=e.value;return this.sign!==e.sign?e.sign?1:-1:e.isSmall?this.sign?-1:1:C(r,n)*(this.sign?-1:1)},i.prototype.compareTo=i.prototype.compare,o.prototype.compare=function(t){if(t===1/0)return-1;if(t===-1/0)return 1;var e=q(t),r=this.value,n=e.value;return e.isSmall?r==n?0:r>n?1:-1:r<0!==e.sign?r<0?-1:1:r<0?1:-1},o.prototype.compareTo=o.prototype.compare,i.prototype.equals=function(t){return 0===this.compare(t)},o.prototype.eq=o.prototype.equals=i.prototype.eq=i.prototype.equals,i.prototype.notEquals=function(t){return 0!==this.compare(t)},o.prototype.neq=o.prototype.notEquals=i.prototype.neq=i.prototype.notEquals,i.prototype.greater=function(t){return this.compare(t)>0},o.prototype.gt=o.prototype.greater=i.prototype.gt=i.prototype.greater,i.prototype.lesser=function(t){return this.compare(t)<0},o.prototype.lt=o.prototype.lesser=i.prototype.lt=i.prototype.lesser,i.prototype.greaterOrEquals=function(t){return this.compare(t)>=0},o.prototype.geq=o.prototype.greaterOrEquals=i.prototype.geq=i.prototype.greaterOrEquals,i.prototype.lesserOrEquals=function(t){return this.compare(t)<=0},o.prototype.leq=o.prototype.lesserOrEquals=i.prototype.leq=i.prototype.lesserOrEquals,i.prototype.isEven=function(){return 0==(1&this.value[0])},o.prototype.isEven=function(){return 0==(1&this.value)},i.prototype.isOdd=function(){return 1==(1&this.value[0])},o.prototype.isOdd=function(){return 1==(1&this.value)},i.prototype.isPositive=function(){return!this.sign},o.prototype.isPositive=function(){return this.value>0},i.prototype.isNegative=function(){return this.sign},o.prototype.isNegative=function(){return this.value<0},i.prototype.isUnit=function(){return!1},o.prototype.isUnit=function(){return 1===Math.abs(this.value)},i.prototype.isZero=function(){return!1},o.prototype.isZero=function(){return 0===this.value},i.prototype.isDivisibleBy=function(t){var e=q(t),r=e.value;return 0!==r&&(1===r||(2===r?this.isEven():this.mod(e).equals(n[0])))},o.prototype.isDivisibleBy=i.prototype.isDivisibleBy,i.prototype.isPrime=function(){var t=R(this);if(void 0!==t)return t;for(var e,r,i,o,a=this.abs(),s=a.prev(),u=[2,3,5,7,11,13,17,19],c=s;c.isEven();)c=c.divide(2);for(i=0;i<u.length;i++)if(o=bigInt(u[i]).modPow(c,a),!o.equals(n[1])&&!o.equals(s)){for(r=!0,e=c;r&&e.lesser(s);e=e.multiply(2))o=o.square().mod(a),o.equals(s)&&(r=!1);if(r)return!1}return!0},o.prototype.isPrime=i.prototype.isPrime,i.prototype.isProbablePrime=function(t){var e=R(this);if(void 0!==e)return e;for(var r=this.abs(),n=void 0===t?5:t,i=0;i<n;i++){if(!bigInt.randBetween(2,r.minus(2)).modPow(r.prev(),r).isUnit())return!1}return!0},o.prototype.isProbablePrime=i.prototype.isProbablePrime,i.prototype.modInv=function(t){for(var e,r,n,i=bigInt.zero,o=bigInt.one,a=q(t),s=this.abs();!s.equals(bigInt.zero);)e=a.divide(s),r=i,n=a,i=o,a=s,o=r.subtract(e.multiply(o)),s=n.subtract(e.multiply(s));if(!a.equals(1))throw new Error(this.toString()+" and "+t.toString()+" are not co-prime");return-1===i.compare(0)&&(i=i.add(t)),this.isNegative()?i.negate():i},o.prototype.modInv=i.prototype.modInv,i.prototype.next=function(){var t=this.value;return this.sign?v(t,1,this.sign):new i(_(t,1),this.sign)},o.prototype.next=function(){var t=this.value;return t+1<z?new o(t+1):new i(Y,!1)},i.prototype.prev=function(){var t=this.value;return this.sign?new i(_(t,1),!0):v(t,1,this.sign)},o.prototype.prev=function(){var t=this.value;return t-1>-z?new o(t-1):new i(Y,!0)};for(var Z=[1];Z[Z.length-1]<=J;)Z.push(2*Z[Z.length-1]);var Q=Z.length,X=Z[Q-1];i.prototype.shiftLeft=function(t){if(!O(t))throw new Error(String(t)+" is too large for shifting.");if((t=+t)<0)return this.shiftRight(-t);for(var e=this;t>=Q;)e=e.multiply(X),t-=Q-1;return e.multiply(Z[t])},o.prototype.shiftLeft=i.prototype.shiftLeft,i.prototype.shiftRight=function(t){var e;if(!O(t))throw new Error(String(t)+" is too large for shifting.");if((t=+t)<0)return this.shiftLeft(-t);for(var r=this;t>=Q;){if(r.isZero())return r;e=N(r,X),r=e[1].isNegative()?e[0].prev():e[0],t-=Q-1}return e=N(r,Z[t]),e[1].isNegative()?e[0].prev():e[0]},o.prototype.shiftRight=i.prototype.shiftRight,i.prototype.not=function(){return this.negate().prev()},o.prototype.not=i.prototype.not,i.prototype.and=function(t){return x(this,t,function(t,e){return t&e})},o.prototype.and=i.prototype.and,i.prototype.or=function(t){return x(this,t,function(t,e){return t|e})},o.prototype.or=i.prototype.or,i.prototype.xor=function(t){return x(this,t,function(t,e){return t^e})},o.prototype.xor=i.prototype.xor;var $=1<<30,tt=(J&-J)*(J&-J)|$,et=function(t,e){for(var r,n=t.length,i=Math.abs(e),r=0;r<n;r++){var a=t[r].toLowerCase();if("-"!==a&&/[a-z0-9]/.test(a)){if(/[0-9]/.test(a)&&+a>=i){if("1"===a&&1===i)continue;throw new Error(a+" is not a valid digit in base "+e+".")}if(a.charCodeAt(0)-87>=i)throw new Error(a+" is not a valid digit in base "+e+".")}}if(2<=e&&e<=36&&n<=K/Math.log(e)){var s=parseInt(t,e);if(isNaN(s))throw new Error(a+" is not a valid digit in base "+e+".");return new o(parseInt(t,e))}e=q(e);var u=[],c="-"===t[0];for(r=c?1:0;r<t.length;r++){var a=t[r].toLowerCase(),l=a.charCodeAt(0);if(48<=l&&l<=57)u.push(q(a));else if(97<=l&&l<=122)u.push(q(a.charCodeAt(0)-87));else{if("<"!==a)throw new Error(a+" is not a valid character");var h=r;do{r++}while(">"!==t[r]);u.push(q(t.slice(h+1,r)))}}return B(u,e,c)};i.prototype.toString=function(t){if(void 0===t&&(t=10),10!==t)return U(this,t);for(var e,r=this.value,n=r.length,i=String(r[--n]),o="0000000";--n>=0;)e=String(r[n]),i+=o.slice(e.length)+e;return(this.sign?"-":"")+i},o.prototype.toString=function(t){return void 0===t&&(t=10),10!=t?U(this,t):String(this.value)},i.prototype.valueOf=function(){return+this.toString()},i.prototype.toJSNumber=i.prototype.valueOf,o.prototype.valueOf=function(){return this.value},o.prototype.toJSNumber=o.prototype.valueOf;for(var rt=0;rt<1e3;rt++)n[rt]=new o(rt),rt>0&&(n[-rt]=new o(-rt));n.one=n[1],n.zero=n[0],n.minusOne=n[-1],n.max=L,n.min=F,n.gcd=M,n.lcm=D,n.isInstance=function(t){return t instanceof i||t instanceof o},n.randBetween=V,n.fromArray=function(t,e,r){return B(t.map(q),q(e||10),r)}},function(t,e,r){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){return new f.Token(t,e,p.UnknownPosition,p.UnknownPosition)}Object.defineProperty(e,"__esModule",{value:!0}),e.Runner=void 0;var o=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),a=r(15),s=r(17),u=r(8),c=r(19),l=r(4),h=r(20),p=r(6),f=r(3),_=r(2);e.Runner=function(){function t(){n(this,t),this.initialize()}return o(t,[{key:"initialize",value:function(){this._ast=null,this._primitives=new l.RuntimePrimitives,this._symtable=this._newSymtableWithPrimitives(),this._linter=new s.Linter(this._symtable),this._code=null,this._vm=null,this._result=null}},{key:"run",value:function(t){return this.runState(t,new l.RuntimeState).result}},{key:"runState",value:function(t,e){return this.parse(t),this.lint(),this.compile(),this.execute(e),{result:this._result,state:this._vm.globalState()}}},{key:"parse",value:function(t){var e=new a.Parser(t);this._ast=e.parse();var r=!0,n=!1,i=void 0;try{for(var o,s=e.getLanguageOptions()[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var u=o.value;this._setLanguageOption(u)}}catch(t){n=!0,i=t}finally{try{!r&&s.return&&s.return()}finally{if(n)throw i}}}},{key:"enableLintCheck",value:function(t,e){this._linter.enableCheck(t,e)}},{key:"lint",value:function(){this._symtable=this._linter.lint(this._ast)}},{key:"compile",value:function(){this._code=new c.Compiler(this._symtable).compile(this._ast)}},{key:"initializeVirtualMachine",value:function(t){this._vm=new h.VirtualMachine(this._code,t)}},{key:"execute",value:function(t){this.executeWithTimeout(t,0)}},{key:"executeWithTimeout",value:function(t,e){this.executeWithTimeoutTakingSnapshots(t,e,null)}},{key:"executeWithTimeoutTakingSnapshots",value:function(t,e,r){this.initializeVirtualMachine(t),this._result=this._vm.runWithTimeoutTakingSnapshots(e,r)}},{key:"executeEventWithTimeout",value:function(t,e){this._result=this._vm.runEventWithTimeout(t,e)}},{key:"_setLanguageOption",value:function(t){if("DestructuringForeach"===t)this.enableLintCheck("forbidden-extension-destructuring-foreach",!1);else{if("AllowRecursion"!==t)throw Error("Unknown language option: "+t);this.enableLintCheck("forbidden-extension-allow-recursion",!1)}}},{key:"regionStack",value:function(){return this._vm.regionStack()}},{key:"_newSymtableWithPrimitives",value:function(){var t=new u.SymbolTable,e=!0,r=!1,n=void 0;try{for(var i,o=this._primitives.types()[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var a=i.value;t.defType(this._astDefType(a))}}catch(t){r=!0,n=t}finally{try{!e&&o.return&&o.return()}finally{if(r)throw n}}var s=!0,c=!1,l=void 0;try{for(var h,p=this._primitives.procedures()[Symbol.iterator]();!(s=(h=p.next()).done);s=!0){var f=h.value;t.defProcedure(this._astDefProcedure(f))}}catch(t){c=!0,l=t}finally{try{!s&&p.return&&p.return()}finally{if(c)throw l}}var _=!0,m=!1,d=void 0;try{for(var v,y=this._primitives.functions()[Symbol.iterator]();!(_=(v=y.next()).done);_=!0){var g=v.value;t.defFunction(this._astDefFunction(g))}}catch(t){m=!0,d=t}finally{try{!_&&y.return&&y.return()}finally{if(m)throw d}}return t}},{key:"_astDefType",value:function(t){var e=[],r=!0,n=!1,o=void 0;try{for(var a,s=this._primitives.typeConstructors(t)[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var u=a.value;e.push(this._astConstructorDeclaration(t,u))}}catch(t){n=!0,o=t}finally{try{!r&&s.return&&s.return()}finally{if(n)throw o}}return new _.ASTDefType(i(f.T_UPPERID,t),e)}},{key:"_astDefProcedure",value:function(t){for(var e=this._primitives.getOperation(t).nargs(),r=[],n=1;n<=e;n++)r.push(i(f.T_LOWERID,"x"+n.toString()));return new _.ASTDefProcedure(i(f.T_LOWERID,t),r,new _.ASTStmtBlock([]))}},{key:"_astDefFunction",value:function(t){for(var e=this._primitives.getOperation(t).nargs(),r=[],n=1;n<=e;n++)r.push(i(f.T_LOWERID,"x"+n.toString()));return new _.ASTDefFunction(i(f.T_LOWERID,t),r,new _.ASTStmtBlock([]))}},{key:"_astConstructorDeclaration",value:function(t,e){var r=[],n=!0,o=!1,a=void 0;try{for(var s,u=this._primitives.constructorFields(t,e)[Symbol.iterator]();!(n=(s=u.next()).done);n=!0){var c=s.value;r.push(i(f.T_LOWERID,c))}}catch(t){o=!0,a=t}finally{try{!n&&u.return&&u.return()}finally{if(o)throw a}}return new _.ASTConstructorDeclaration(i(f.T_UPPERID,e),r)}},{key:"abstractSyntaxTree",get:function(){return this._ast}},{key:"primitives",get:function(){return this._primitives}},{key:"symbolTable",get:function(){return this._symtable}},{key:"virtualMachineCode",get:function(){return this._code}},{key:"result",get:function(){return this._result}},{key:"globalState",get:function(){return this._vm.globalState()}}]),t}()},function(t,e,r){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e,r,n){throw new a.GbsSyntaxError(t,e,r,n)}Object.defineProperty(e,"__esModule",{value:!0}),e.Parser=void 0;var o=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),a=r(1),s=r(16),u=r(0),c=r(3),l=r(2),h=Symbol.for("Infix"),p=Symbol.for("InfixL"),f=Symbol.for("InfixR"),_=Symbol.for("Prefix"),m=function(){function t(e,r){n(this,t),this._fixity=e,this._operators=r}return o(t,[{key:"isOperator",value:function(t){return Symbol.keyFor(t.tag)in this._operators}},{key:"functionName",value:function(t){return new c.Token(c.T_LOWERID,this._operators[Symbol.keyFor(t.tag)],t.startPos,t.endPos)}},{key:"fixity",get:function(){return this._fixity}}]),t}(),d=[new m(f,{T_OR:"||"}),new m(f,{T_AND:"&&"}),new m(_,{T_NOT:"not"}),new m(h,{T_EQ:"==",T_NE:"/=",T_LE:"<=",T_GE:">=",T_LT:"<",T_GT:">"}),new m(p,{T_CONCAT:"++"}),new m(p,{T_PLUS:"+",T_MINUS:"-"}),new m(p,{T_TIMES:"*"}),new m(p,{T_DIV:"div",T_MOD:"mod"}),new m(f,{T_POW:"^"}),new m(_,{T_MINUS:"-(unary)"})];e.Parser=function(){function t(e){n(this,t),this._lexer=new s.Lexer(e),this._nextToken()}return o(t,[{key:"parse",value:function(){for(var t=[];this._currentToken.tag!==c.T_EOF;)t.push(this._parseDefinition());return new l.ASTMain(t)}},{key:"getLanguageOptions",value:function(){return this._lexer.getLanguageOptions()}},{key:"_parseDefinition",value:function(){switch(this._currentToken.tag){case c.T_PROGRAM:return this._parseDefProgram();case c.T_INTERACTIVE:return this._parseDefInteractiveProgram();case c.T_PROCEDURE:return this._parseDefProcedure();case c.T_FUNCTION:return this._parseDefFunction();case c.T_TYPE:return this._parseDefType();default:return i(this._currentToken.startPos,this._currentToken.endPos,"expected-but-found",[(0,u.i18n)("definition"),(0,u.i18n)(Symbol.keyFor(this._currentToken.tag))])}}},{key:"_parseDefProgram",value:function(){var t=this._currentToken.startPos;this._match(c.T_PROGRAM);var e=this._lexer.getPendingAttributes(),r=this._parseStmtBlock(),n=new l.ASTDefProgram(r);return n.startPos=t,n.endPos=r.endPos,n.attributes=e,n}},{key:"_parseDefInteractiveProgram",value:function(){var t=this._currentToken.startPos;this._match(c.T_INTERACTIVE),this._match(c.T_PROGRAM);var e=this._lexer.getPendingAttributes();this._match(c.T_LBRACE);var r=this._parseSwitchBranches(),n=this._currentToken.startPos;this._match(c.T_RBRACE);var i=new l.ASTDefInteractiveProgram(r);return i.startPos=t,i.endPos=n,i.attributes=e,i}},{key:"_parseDefProcedure",value:function(){var t=this._currentToken.startPos;this._match(c.T_PROCEDURE);var e=this._parseUpperid();this._match(c.T_LPAREN);var r=this._parseLoweridSeq();this._match(c.T_RPAREN);var n=this._lexer.getPendingAttributes(),i=this._parseStmtBlock(),o=new l.ASTDefProcedure(e,r,i);return o.startPos=t,o.endPos=i.endPos,o.attributes=n,o}},{key:"_parseDefFunction",value:function(){var t=this._currentToken.startPos;this._match(c.T_FUNCTION);var e=this._currentToken;this._match(c.T_LOWERID),this._match(c.T_LPAREN);var r=this._parseLoweridSeq();this._match(c.T_RPAREN);var n=this._lexer.getPendingAttributes(),i=this._parseStmtBlock(),o=new l.ASTDefFunction(e,r,i);return o.startPos=t,o.endPos=i.endPos,o.attributes=n,o}},{key:"_parseDefType",value:function(){var t=this._currentToken.startPos;this._match(c.T_TYPE);var e=this._parseUpperid();switch(this._match(c.T_IS),this._currentToken.tag){case c.T_RECORD:return this._parseDefTypeRecord(t,e);case c.T_VARIANT:return this._parseDefTypeVariant(t,e);default:return i(this._currentToken.startPos,this._currentToken.endPos,"expected-but-found",[(0,u.i18n)("<alternative>")([(0,u.i18n)("T_RECORD"),(0,u.i18n)("T_VARIANT")]),(0,u.i18n)(Symbol.keyFor(this._currentToken.tag))])}}},{key:"_parseDefTypeRecord",value:function(t,e){this._match(c.T_RECORD);var r=this._lexer.getPendingAttributes();this._match(c.T_LBRACE);var n=this._parseFieldNames(),i=this._currentToken.startPos;this._matchExpected(c.T_RBRACE,[c.T_FIELD,c.T_RBRACE]);var o=new l.ASTDefType(e,[new l.ASTConstructorDeclaration(e,n)]);return o.startPos=t,o.endPos=i,o.attributes=r,o}},{key:"_parseDefTypeVariant",value:function(t,e){var r=[];this._match(c.T_VARIANT);var n=this._lexer.getPendingAttributes();for(this._match(c.T_LBRACE);this._currentToken.tag===c.T_CASE;)r.push(this._parseConstructorDeclaration());var i=this._currentToken.startPos;this._matchExpected(c.T_RBRACE,[c.T_CASE,c.T_RBRACE]);var o=new l.ASTDefType(e,r);return o.startPos=t,o.endPos=i,o.attributes=n,o}},{key:"_parseConstructorDeclaration",value:function(){var t=this._currentToken.startPos;this._match(c.T_CASE);var e=this._parseUpperid();this._match(c.T_LBRACE);var r=this._parseFieldNames(),n=this._currentToken.startPos;this._matchExpected(c.T_RBRACE,[c.T_FIELD,c.T_RBRACE]);var i=new l.ASTConstructorDeclaration(e,r);return i.startPos=t,i.endPos=n,i}},{key:"_parseFieldNames",value:function(){for(var t=[];this._currentToken.tag===c.T_FIELD;)this._match(c.T_FIELD),t.push(this._parseLowerid());return t}},{key:"_parseStatement",value:function(){var t=this._parsePureStatement();return this._currentToken.tag===c.T_SEMICOLON&&this._match(c.T_SEMICOLON),t}},{key:"_parsePureStatement",value:function(){switch(this._currentToken.tag){case c.T_ELLIPSIS:return this._parseStmtEllipsis();case c.T_RETURN:return this._parseStmtReturn();case c.T_IF:return this._parseStmtIf(!0);case c.T_REPEAT:return this._parseStmtRepeat();case c.T_FOREACH:return this._parseStmtForeach();case c.T_WHILE:return this._parseStmtWhile();case c.T_SWITCH:return this._parseStmtSwitch();case c.T_LET:return this._parseStmtLet();case c.T_LBRACE:return this._parseStmtBlock();case c.T_LOWERID:return this._parseStmtAssignVariable();case c.T_UPPERID:return this._parseStmtProcedureCall();case c.T_LPAREN:return i(this._currentToken.startPos,this._currentToken.endPos,"obsolete-tuple-assignment",[]);default:return i(this._currentToken.startPos,this._currentToken.endPos,"expected-but-found",[(0,u.i18n)("statement"),(0,u.i18n)(Symbol.keyFor(this._currentToken.tag))])}}},{key:"_parseStmtBlock",value:function(){var t=this._currentToken.startPos,e=[];for(this._match(c.T_LBRACE);this._currentToken.tag!==c.T_RBRACE;)e.push(this._parseStatement()),this._currentToken===c.T_SEMICOLON&&this._match(c.T_SEMICOLON);var r=this._currentToken.startPos;this._match(c.T_RBRACE);var n=new l.ASTStmtBlock(e);return n.startPos=t,n.endPos=r,n}},{key:"_parseStmtEllipsis",value:function(){var t=this._currentToken.startPos;this._match(c.T_ELLIPSIS);var e=new l.ASTStmtProcedureCall(new c.Token(c.T_UPPERID,(0,u.i18n)("PRIM:BOOM"),t,t),[new l.ASTExprConstantString(new c.Token(c.T_STRING,(0,u.i18n)("errmsg:ellipsis")))]);return e.startPos=t,e.endPos=this._currentToken.startPos,e}},{key:"_parseStmtReturn",value:function(){var t=this._currentToken.startPos;this._match(c.T_RETURN);var e=this._parseExprTuple(!1),r=new l.ASTStmtReturn(e);return r.startPos=t,r.endPos=e.endPos,r}},{key:"_parseStmtIf",value:function(t){var e=this._currentToken.startPos;t&&this._match(c.T_IF),this._match(c.T_LPAREN);var r=this._parseExpression();this._match(c.T_RPAREN),this._currentToken.tag===c.T_THEN&&this._match(c.T_THEN);var n=this._parseStmtBlock(),i=void 0,o=void 0;this._currentToken.tag===c.T_ELSEIF?(this._match(c.T_ELSEIF),o=this._parseStmtIf(!1),i=o.endPos):this._currentToken.tag===c.T_ELSE?(this._match(c.T_ELSE),o=this._parseStmtBlock(),i=o.endPos):(o=null,i=n.endPos);var a=new l.ASTStmtIf(r,n,o);return a.startPos=e,a.endPos=i,a}},{key:"_parseStmtRepeat",value:function(){var t=this._currentToken.startPos;this._match(c.T_REPEAT),this._match(c.T_LPAREN);var e=this._parseExpression();this._match(c.T_RPAREN);var r=this._parseStmtBlock(),n=new l.ASTStmtRepeat(e,r);return n.startPos=t,n.endPos=r.endPos,n}},{key:"_parseStmtForeach",value:function(){var t=this._currentToken.startPos;this._match(c.T_FOREACH);var e=this._parsePattern();this._match(c.T_IN);var r=this._parseExpression(),n=this._parseStmtBlock(),i=new l.ASTStmtForeach(e,r,n);return i.startPos=t,i.endPos=n.endPos,i}},{key:"_parseStmtWhile",value:function(){var t=this._currentToken.startPos;this._match(c.T_WHILE),this._match(c.T_LPAREN);var e=this._parseExpression();this._match(c.T_RPAREN);var r=this._parseStmtBlock(),n=new l.ASTStmtWhile(e,r);return n.startPos=t,n.endPos=r.endPos,n}},{key:"_parseStmtSwitch",value:function(){var t=this._currentToken.startPos;this._match(c.T_SWITCH),this._match(c.T_LPAREN);var e=this._parseExpression();this._match(c.T_RPAREN),this._currentToken.tag===c.T_TO&&this._match(c.T_TO),this._match(c.T_LBRACE);var r=this._parseSwitchBranches(),n=this._currentToken.startPos;this._match(c.T_RBRACE);var i=new l.ASTStmtSwitch(e,r);return i.startPos=t,i.endPos=n,i}},{key:"_parseStmtLet",value:function(){var t=this._currentToken.startPos;this._match(c.T_LET);var e=void 0;return this._currentToken.tag===c.T_LOWERID?e=this._parseStmtAssignVariable():this._currentToken.tag===c.T_LPAREN?e=this._parseStmtAssignTuple():i(this._currentToken.startPos,this._currentToken.endPos,"expected-but-found",[(0,u.i18n)("<alternative>")((0,u.i18n)("T_LOWERID"),(0,u.i18n)("T_LPAREN")),(0,u.i18n)(Symbol.keyfor(this._currentToken.tag))]),e.startPos=t,e}},{key:"_parseStmtAssignVariable",value:function(){var t=this._parseLowerid();this._match(c.T_ASSIGN);var e=this._parseExpression(),r=new l.ASTStmtAssignVariable(t,e);return r.startPos=t.startPos,r.endPos=e.endPos,r}},{key:"_parseStmtAssignTuple",value:function(){var t=this._currentToken.startPos;this._match(c.T_LPAREN);var e=this._parseLoweridSeq();1===e.length&&i(t,this._currentToken.endPos,"assignment-tuple-cannot-be-singleton",[]),this._match(c.T_RPAREN),this._match(c.T_ASSIGN);var r=this._parseExpression(),n=new l.ASTStmtAssignTuple(e,r);return n.startPos=t,n.endPos=r.endPos,n}},{key:"_parseStmtProcedureCall",value:function(){var t=this,e=this._parseUpperid();this._match(c.T_LPAREN);var r=this._parseDelimitedSeq(c.T_RPAREN,c.T_COMMA,function(){return t._parseExpression()}),n=this._currentToken.startPos;this._match(c.T_RPAREN);var i=new l.ASTStmtProcedureCall(e,r);return i.startPos=e.startPos,i.endPos=n,i}},{key:"_parsePattern",value:function(){switch(this._currentToken.tag){case c.T_UNDERSCORE:return this._parsePatternWildcard();case c.T_LOWERID:return this._parsePatternVariable();case c.T_NUM:case c.T_MINUS:return this._parsePatternNumber();case c.T_UPPERID:return this._parsePatternStructure();case c.T_LPAREN:return this._parsePatternTuple();case c.T_TIMEOUT:return this._parsePatternTimeout();default:return i(this._currentToken.startPos,this._currentToken.endPos,"expected-but-found",[(0,u.i18n)("pattern"),(0,u.i18n)(Symbol.keyFor(this._currentToken.tag))])}}},{key:"_parsePatternWildcard",value:function(){var t=this._currentToken.startPos;this._match(c.T_UNDERSCORE);var e=new l.ASTPatternWildcard,r=t;return e.startPos=t,e.endPos=r,e}},{key:"_parsePatternVariable",value:function(){var t=this._currentToken.startPos,e=this._parseLowerid(),r=new l.ASTPatternVariable(e);return r.startPos=t,r.endPos=e.endPos,r}},{key:"_parsePatternNumber",value:function(){var t=this._currentToken.startPos,e="";this._currentToken.tag===c.T_MINUS&&(this._match(c.T_MINUS),e="-");var r=this._currentToken;this._match(c.T_NUM);var n=e+r.value;"-0"===n&&i(t,r.endPos,"pattern-number-cannot-be-negative-zero",[]),r=new c.Token(c.T_NUM,n,r.startPos,r.endPos);var o=new l.ASTPatternNumber(r);return o.startPos=t,o.endPos=r.endPos,o}},{key:"_parsePatternStructure",value:function(){var t=this._currentToken.startPos,e=this._currentToken.startPos,r=this._parseUpperid(),n=void 0;this._currentToken.tag===c.T_LPAREN?(this._match(c.T_LPAREN),n=this._parseLoweridSeq(),e=this._currentToken.startPos,this._match(c.T_RPAREN)):n=[];var i=new l.ASTPatternStructure(r,n);return i.startPos=t,i.endPos=e,i}},{key:"_parsePatternTuple",value:function(){var t=this._currentToken.startPos;this._match(c.T_LPAREN);var e=this._parseLoweridSeq();1===e.length&&i(t,this._currentToken.endPos,"pattern-tuple-cannot-be-singleton",[]);var r=this._currentToken.startPos;this._match(c.T_RPAREN);var n=new l.ASTPatternTuple(e);return n.startPos=t,n.endPos=r,n}},{key:"_parsePatternTimeout",value:function(){var t=this._currentToken.startPos;this._match(c.T_TIMEOUT),this._match(c.T_LPAREN);var e=this._currentToken;this._match(c.T_NUM);var r=this._currentToken.startPos;this._match(c.T_RPAREN);var n=new l.ASTPatternTimeout(e);return n.startPos=t,n.endPos=r,n}},{key:"_parseExpression",value:function(){return this._parseExprOperator(0)}},{key:"_parseExprOperator",value:function(t){if(t===d.length)return this._parseExprAtom();switch(d[t].fixity){case h:return this._parseExprOperatorInfix(t);case p:return this._parseExprOperatorInfixL(t);case f:return this._parseExprOperatorInfixR(t);case _:return this._parseExprOperatorPrefix(t);default:throw Error("Invalid operator.")}}},{key:"_parseExprOperatorInfix",value:function(t){var e=this._parseExprOperator(t+1);if(d[t].isOperator(this._currentToken)){var r=this._currentToken;this._nextToken();var n=this._parseExprOperator(t+1);d[t].isOperator(this._currentToken)&&i(this._currentToken.startPos,this._currentToken.endPos,"operators-are-not-associative",[(0,u.i18n)(Symbol.keyFor(r.tag)),(0,u.i18n)(Symbol.keyFor(this._currentToken.tag))]);var o=new l.ASTExprFunctionCall(d[t].functionName(r),[e,n]);return o.startPos=e.startPos,o.endPos=n.endPos,o}return e}},{key:"_parseExprOperatorInfixL",value:function(t){for(var e=this._parseExprOperator(t+1);d[t].isOperator(this._currentToken);){var r=this._currentToken;this._nextToken();var n=this._parseExprOperator(t+1),i=new l.ASTExprFunctionCall(d[t].functionName(r),[e,n]);i.startPos=e.startPos,i.endPos=n.endPos,e=i}return e}},{key:"_parseExprOperatorInfixR",value:function(t){var e=this._parseExprOperator(t+1);if(d[t].isOperator(this._currentToken)){var r=this._currentToken;this._nextToken();var n=this._parseExprOperator(t),i=new l.ASTExprFunctionCall(d[t].functionName(r),[e,n]);return i.startPos=e.startPos,i.endPos=n.endPos,i}return e}},{key:"_parseExprOperatorPrefix",value:function(t){if(d[t].isOperator(this._currentToken)){var e=this._currentToken;this._nextToken();var r=this._parseExprOperator(t),n=new l.ASTExprFunctionCall(d[t].functionName(e),[r]);return n.startPos=e.startPos,n.endPos=r.endPos,n}return this._parseExprOperator(t+1)}},{key:"_parseExprAtom",value:function(){switch(this._currentToken.tag){case c.T_ELLIPSIS:return this._parseExprEllipsis();case c.T_LOWERID:return this._parseExprVariableOrFunctionCall();case c.T_NUM:return this._parseExprConstantNumber();case c.T_STRING:return this._parseExprConstantString();case c.T_CHOOSE:return this._parseExprChoose(!0);case c.T_MATCHING:return this._parseExprMatching();case c.T_UPPERID:return this._parseExprStructureOrStructureUpdate();case c.T_LPAREN:return this._parseExprTuple(!0);case c.T_LBRACK:return this._parseExprListOrRange();default:return i(this._currentToken.startPos,this._currentToken.endPos,"expected-but-found",[(0,u.i18n)("expression"),(0,u.i18n)(Symbol.keyFor(this._currentToken.tag))])}}},{key:"_parseExprEllipsis",value:function(){var t=this._currentToken.startPos;this._match(c.T_ELLIPSIS);var e=new l.ASTExprFunctionCall(new c.Token(c.T_LOWERID,(0,u.i18n)("PRIM:boom"),t,t),[new l.ASTExprConstantString(new c.Token(c.T_STRING,(0,u.i18n)("errmsg:ellipsis")))]);return e.startPos=t,e.endPos=this._currentToken.startPos,e}},{key:"_parseExprVariableOrFunctionCall",value:function(){var t=this._parseLowerid(),e=void 0,r=void 0;if(this._currentToken.tag===c.T_LPAREN){this._match(c.T_LPAREN);var n=this._parseExpressionSeq(c.T_RPAREN);e=new l.ASTExprFunctionCall(t,n),r=this._currentToken.startPos,this._match(c.T_RPAREN)}else e=new l.ASTExprVariable(t),r=t.endPos;return e.startPos=t.startPos,e.endPos=r,e}},{key:"_parseExprConstantNumber",value:function(){var t=this._currentToken;this._match(c.T_NUM);var e=new l.ASTExprConstantNumber(t);return e.startPos=t.startPos,e.endPos=t.endPos,e}},{key:"_parseExprConstantString",value:function(){var t=this._currentToken;this._match(c.T_STRING);var e=new l.ASTExprConstantString(t);return e.startPos=t.startPos,e.endPos=t.endPos,e}},{key:"_parseExprChoose",value:function(t){var e=this._currentToken.startPos;t&&this._match(c.T_CHOOSE);var r=this._parseExpression();if(this._currentToken.tag===c.T_WHEN){this._match(c.T_WHEN),this._match(c.T_LPAREN);var n=this._parseExpression();this._match(c.T_RPAREN);var i=this._parseExprChoose(!1),o=new l.ASTExprChoose(n,r,i);return o.startPos=e,o.endPos=i.endPos,o}var a=this._currentToken.endPos;return this._match(c.T_OTHERWISE),r.startPos=e,r.endPos=a,r}},{key:"_parseExprMatching",value:function(){var t=this._currentToken.startPos;this._match(c.T_MATCHING),this._match(c.T_LPAREN);var e=this._parseExpression();this._match(c.T_RPAREN),this._match(c.T_SELECT);var r=this._parseMatchingBranches(),n=new l.ASTExprMatching(e,r);return n.startPos=t,n.endPos=n.endPos,n}},{key:"_parseExprStructureOrStructureUpdate",value:function(){var t=this._parseUpperid();if(this._currentToken.tag!==c.T_LPAREN){var e=new l.ASTExprStructure(t,[]);return e.startPos=t.startPos,e.endPos=t.endPos,e}if(this._match(c.T_LPAREN),this._currentToken.tag===c.T_RPAREN){var r=new l.ASTExprStructure(t,[]),n=this._currentToken.startPos;return this._match(c.T_RPAREN),r.startPos=t.startPos,r.endPos=n,r}var o=this._parseExpression();switch(this._currentToken.tag){case c.T_GETS:return o.tag!==l.N_ExprVariable&&i(this._currentToken.startPos,this._currentToken.endPos,"expected-but-found",[(0,u.i18n)("T_PIPE"),(0,u.i18n)("T_GETS")]),this._parseStructure(t,o.variableName);case c.T_PIPE:return this._parseStructureUpdate(t,o);case c.T_COMMA:case c.T_RPAREN:return i(t.startPos,t.endPos,"expected-but-found",[(0,u.i18n)("expression"),(0,u.i18n)("procedure call")]);default:var a=void 0;return a=o.tag===l.N_ExprVariable?(0,u.i18n)("<alternative>")([(0,u.i18n)("T_GETS"),(0,u.i18n)("T_PIPE")]):(0,u.i18n)("T_PIPE"),i(t.startPos,t.endPos,"expected-but-found",[a,(0,u.i18n)(Symbol.keyFor(this._currentToken.tag))])}}},{key:"_parseStructure",value:function(t,e){var r=this;this._match(c.T_GETS);var n=this._parseExpression(),i=new l.ASTFieldBinding(e,n);i.startPos=e.startPos,i.endPos=n.endPos;var o=this._parseNonEmptyDelimitedSeq(c.T_RPAREN,c.T_COMMA,[i],function(){return r._parseFieldBinding()}),a=this._currentToken.startPos;this._match(c.T_RPAREN);var s=new l.ASTExprStructure(t,o);return s.startPos=t.startPos,s.endPos=a,s}},{key:"_parseStructureUpdate",value:function(t,e){var r=this;this._match(c.T_PIPE);var n=this._parseDelimitedSeq(c.T_RPAREN,c.T_COMMA,function(){return r._parseFieldBinding()}),i=this._currentToken.startPos;this._match(c.T_RPAREN);var o=new l.ASTExprStructureUpdate(t,e,n);return o.startPos=t.startPos,o.endPos=i,o}},{key:"_parseExprListOrRange",value:function(){var t=this._currentToken.startPos;if(this._match(c.T_LBRACK),this._currentToken.tag===c.T_RBRACK)return this._parseExprListRemainder(t,[]);var e=this._parseExpression();switch(this._currentToken.tag){case c.T_RBRACK:return this._parseExprListRemainder(t,[e]);case c.T_RANGE:return this._parseExprRange(t,e,null);case c.T_COMMA:this._match(c.T_COMMA);var r=this._parseExpression();switch(this._currentToken.tag){case c.T_RBRACK:case c.T_COMMA:return this._parseExprListRemainder(t,[e,r]);case c.T_RANGE:return this._parseExprRange(t,e,r);default:return i(this._currentToken.startPos,this._currentToken.endPos,"expected-but-found",[(0,u.i18n)("<alternative>")([(0,u.i18n)("T_COMMA"),(0,u.i18n)("T_RANGE"),(0,u.i18n)("T_RBRACK")]),(0,u.i18n)(Symbol.keyFor(this._currentToken.tag))])}default:return i(this._currentToken.startPos,this._currentToken.endPos,"expected-but-found",[(0,u.i18n)("<alternative>")([(0,u.i18n)("T_COMMA"),(0,u.i18n)("T_RANGE"),(0,u.i18n)("T_RBRACK")]),(0,u.i18n)(Symbol.keyFor(this._currentToken.tag))])}}},{key:"_parseExprListRemainder",value:function(t,e){var r=this,n=this._parseNonEmptyDelimitedSeq(c.T_RBRACK,c.T_COMMA,e,function(){return r._parseExpression()}),i=this._currentToken.startPos;this._match(c.T_RBRACK);var o=new l.ASTExprList(n);return o.startPos=t,o.endPos=i,o}},{key:"_parseExprRange",value:function(t,e,r){this._match(c.T_RANGE);var n=this._parseExpression(),i=this._currentToken.startPos;this._match(c.T_RBRACK);var o=new l.ASTExprRange(e,r,n);return o.startPos=t,o.endPos=i,o}},{key:"_parseExprTuple",value:function(t){var e=this._currentToken.startPos;this._match(c.T_LPAREN);var r=this._parseExpressionSeq(c.T_RPAREN),n=this._currentToken.startPos;this._match(c.T_RPAREN),t||0!==r||i(e,n,"return-tuple-cannot-be-empty",[]);var o=void 0;return o=1===r.length?r[0]:new l.ASTExprTuple(r),o.startPos=e,o.endPos=n,o}},{key:"_parseSwitchBranches",value:function(){for(var t=[];this._currentToken.tag!==c.T_RBRACE;)t.push(this._parseSwitchBranch());return t}},{key:"_parseSwitchBranch",value:function(){var t=this._parsePattern();this._match(c.T_ARROW);var e=this._parseStmtBlock(),r=new l.ASTSwitchBranch(t,e);return r.startPos=t.startPos,r.endPos=e.endPos,r}},{key:"_parseMatchingBranches",value:function(){for(var t=[];this._currentToken.tag!==c.T_OTHERWISE;)t.push(this._parseMatchingBranch());return this._match(c.T_OTHERWISE),t}},{key:"_parseMatchingBranch",value:function(){var t=this._parseExpression();switch(this._currentToken.tag){case c.T_ON:this._match(c.T_ON);var e=this._parsePattern(),r=new l.ASTMatchingBranch(e,t);return r.startPos=t.startPos,r.endPos=e.endPos,r;case c.T_OTHERWISE:var n=new l.ASTPatternWildcard;n.startPos=this._currentToken.startPos,n.endPos=this._currentToken.endPos;var o=new l.ASTMatchingBranch(n,t);return o.startPos=t.startPos,o.endPos=this._currentToken.endPos,o;default:return i(this._currentToken.startPos,this._currentToken.endPos,"expected-but-found",[(0,u.i18n)("<alternative>")([(0,u.i18n)("T_ON"),(0,u.i18n)("T_OTHERWISE")]),(0,u.i18n)(Symbol.keyFor(this._currentToken.tag))])}}},{key:"_parseFieldBinding",value:function(){var t=this._parseLowerid();this._match(c.T_GETS);var e=this._parseExpression(),r=new l.ASTFieldBinding(t,e);return r.startPos=t.startPos,r.endPos=e.endPos,r}},{key:"_nextToken",value:function(){this._currentToken=this._lexer.nextToken()}},{key:"_match",value:function(t){this._currentToken.tag!==t&&i(this._currentToken.startPos,this._currentToken.endPos,"expected-but-found",[(0,u.i18n)(Symbol.keyFor(t)),(0,u.i18n)(Symbol.keyFor(this._currentToken.tag))]),this._nextToken()}},{key:"_matchExpected",value:function(t,e){this._currentToken.tag!==t&&i(this._currentToken.startPos,this._currentToken.endPos,"expected-but-found",[(0,u.i18n)("<alternative>")(e.map(function(t){return(0,u.i18n)(Symbol.keyFor(t))})),(0,u.i18n)(Symbol.keyFor(this._currentToken.tag))]),this._nextToken()}},{key:"_parseDelimitedSeq",value:function(t,e,r){if(this._currentToken.tag===t)return[];var n=r();return this._parseNonEmptyDelimitedSeq(t,e,[n],r)}},{key:"_parseNonEmptyDelimitedSeq",value:function(t,e,r,n){for(var o=r;this._currentToken.tag===e;)this._match(e),o.push(n());return this._currentToken.tag!==t&&i(this._currentToken.startPos,this._currentToken.endPos,"expected-but-found",[(0,u.i18n)("<alternative>")([(0,u.i18n)(Symbol.keyFor(e)),(0,u.i18n)(Symbol.keyFor(t))]),(0,u.i18n)(Symbol.keyFor(this._currentToken.tag))]),o}},{key:"_parseLowerid",value:function(){var t=this._currentToken;return this._match(c.T_LOWERID),t}},{key:"_parseUpperid",value:function(){var t=this._currentToken;return this._match(c.T_UPPERID),t}},{key:"_parseLoweridSeq",value:function(){var t=this;return this._parseDelimitedSeq(c.T_RPAREN,c.T_COMMA,function(){return t._parseLowerid()})}},{key:"_parseExpressionSeq",value:function(t){var e=this;return this._parseDelimitedSeq(t,c.T_COMMA,function(){return e._parseExpression()})}}]),t}()},function(t,e,r){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t){return" "===t||"\t"===t||"\r"===t||"\n"===t}function o(t){return"0"<=t&&t<="9"}function a(t){return t.toUpperCase(t)!==t.toLowerCase()}function s(t){return a(t)&&t.toUpperCase()===t}function u(t){return a(t)&&t.toLowerCase()===t}function c(t){return a(t)||o(t)||"_"===t||"'"===t}function l(t){return t.length>=0&&"0"===t[0]}function h(t,e,r,n){throw new m.GbsSyntaxError(t,e,r,n)}Object.defineProperty(e,"__esModule",{value:!0}),e.Lexer=void 0;var p=function(){function t(t,e){var r=[],n=!0,i=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!e||r.length!==e);n=!0);}catch(t){i=!0,o=t}finally{try{!n&&s.return&&s.return()}finally{if(i)throw o}}return r}return function(e,r){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),f=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),_=r(0),m=r(1),d=r(6),v=r(3),y={program:v.T_PROGRAM,interactive:v.T_INTERACTIVE,procedure:v.T_PROCEDURE,function:v.T_FUNCTION,return:v.T_RETURN,if:v.T_IF,then:v.T_THEN,elseif:v.T_ELSEIF,else:v.T_ELSE,choose:v.T_CHOOSE,when:v.T_WHEN,otherwise:v.T_OTHERWISE,repeat:v.T_REPEAT,foreach:v.T_FOREACH,in:v.T_IN,while:v.T_WHILE,switch:v.T_SWITCH,to:v.T_TO,matching:v.T_MATCHING,select:v.T_SELECT,on:v.T_ON,let:v.T_LET,not:v.T_NOT,div:v.T_DIV,mod:v.T_MOD,type:v.T_TYPE,is:v.T_IS,record:v.T_RECORD,variant:v.T_VARIANT,case:v.T_CASE,field:v.T_FIELD,_:v.T_UNDERSCORE};y[(0,_.i18n)("CONS:TIMEOUT")]=v.T_TIMEOUT;var g=[["(",v.T_LPAREN],[")",v.T_RPAREN],["{",v.T_LBRACE],["}",v.T_RBRACE],["[",v.T_LBRACK],["]",v.T_RBRACK],[",",v.T_COMMA],[";",v.T_SEMICOLON],["...",v.T_ELLIPSIS],["..",v.T_RANGE],[":=",v.T_ASSIGN],["&&",v.T_AND],["||",v.T_OR],["<-",v.T_GETS],["|",v.T_PIPE],["->",v.T_ARROW],["==",v.T_EQ],["/=",v.T_NE],["<=",v.T_LE],[">=",v.T_GE],["<",v.T_LT],[">",v.T_GT],["++",v.T_CONCAT],["+",v.T_PLUS],["-",v.T_MINUS],["*",v.T_TIMES],["^",v.T_POW]],b=["DestructuringForeach","AllowRecursion"],T={"(":")","[":"]","{":"}"};e.Lexer=function(){function t(e){n(this,t),this._multifileReader=new d.MultifileReader(e),this._reader=this._multifileReader.readCurrentFile(),this._warnings=[],this._delimiterStack=[],this._pendingAttributes={},this._languageOptions=[]}return f(t,[{key:"nextToken",value:function(){if(!this._findNextToken()){var t=new v.Token(v.T_EOF,null,this._reader,this._reader);return this._checkBalancedDelimiters(t),t}if(o(this._reader.peek())){var e=this._reader,r=this._readStringWhile(o),n=this._reader;return l(r)&&r.length>1?h(e,n,"numeric-constant-should-not-have-leading-zeroes",[]):new v.Token(v.T_NUM,r,e,n)}if(c(this._reader.peek())){var i=this._reader,a=this._readStringWhile(c),p=this._reader;return a in y?new v.Token(y[a],a,i,p):s(a[0])?new v.Token(v.T_UPPERID,a,i,p):u(a[0])?new v.Token(v.T_LOWERID,a,i,p):h(i,p,"identifier-must-start-with-alphabetic-character",[])}return'"'===this._reader.peek()?this._readStringConstant():this._readSymbol()}},{key:"warnings",value:function(){return this._warnings}},{key:"_findNextToken",value:function(){for(;this._ignoreWhitespaceAndComments(),this._reader.eof();){if(!this._multifileReader.moreFiles())return!1;this._multifileReader.nextFile(),this._reader=this._multifileReader.readCurrentFile()}return!0}},{key:"_readStringWhile",value:function(t){for(var e=[];!this._reader.eof()&&t(this._reader.peek());)e.push(this._reader.peek()),this._reader=this._reader.consumeCharacter();return e.join("")}},{key:"_readStringConstant",value:function(){var t=this._reader,e=[];for(this._reader=this._reader.consumeCharacter();!this._reader.eof();){var r=this._reader.peek();if('"'===r)return this._reader=this._reader.consumeCharacter(),new v.Token(v.T_STRING,e.join(""),t,this._reader);if("\\"===r){if(this._reader=this._reader.consumeCharacter(),this._reader.eof())break;var n=this._reader.peek();switch(this._reader=this._reader.consumeCharacter(),n){case"a":e.push("");break;case"b":e.push("\b");break;case"f":e.push("\f");break;case"n":e.push("\n");break;case"r":e.push("\r");break;case"t":e.push("\t");break;case"v":e.push("\v");break;default:e.push(n)}}else e.push(r),this._reader=this._reader.consumeCharacter()}return h(t,this._reader,"unclosed-string-constant",[])}},{key:"_readSymbol",value:function(){var t=!0,e=!1,r=void 0;try{for(var n,i=g[Symbol.iterator]();!(t=(n=i.next()).done);t=!0){var o=p(n.value,2),a=o[0],s=o[1];if(this._reader.startsWith(a)){var u=this._reader;this._reader=this._reader.consumeString(a);var c=this._reader,l=new v.Token(s,a,u,c);return this._checkBalancedDelimiters(l),l}}}catch(t){e=!0,r=t}finally{try{!t&&i.return&&i.return()}finally{if(e)throw r}}return h(this._reader,this._reader,"unknown-token",[this._reader.peek()])}},{key:"_ignoreWhitespaceAndComments",value:function(){for(;this._ignoreWhitespace()||this._ignoreComments(););}},{key:"_ignoreWhitespace",value:function(){return!(this._reader.eof()||!i(this._reader.peek()))&&(this._reader=this._reader.consumeCharacter(),!0)}},{key:"_ignoreComments",value:function(){if(this._startSingleLineComment())return this._ignoreSingleLineComment(),!0;if(this._reader.startsWith("/*@")){var t=this._reader;return this._evaluatePragma(t,this._readInvisiblePragma("/*","*/","@")),!0}return this._reader.startsWith("{-")?(this._ignoreMultilineComment("{-","-}"),!0):!!this._reader.startsWith("/*")&&(this._ignoreMultilineComment("/*","*/"),!0)}},{key:"_startSingleLineComment",value:function(){return this._reader.startsWith("--")||this._reader.startsWith("//")||this._reader.startsWith("#")}},{key:"_ignoreSingleLineComment",value:function(){for(;!this._reader.eof()&&(this._reader=this._reader.consumeCharacter(),"\n"!==this._reader.peek()););}},{key:"_ignoreMultilineComment",value:function(t,e){for(var r=0,n=this._reader;!this._reader.eof();)if(this._reader.startsWith(t))this._reader=this._reader.consumeString(t),r++;else if(this._reader.startsWith(e)){if(this._reader=this._reader.consumeString(e),0===--r)return}else this._reader=this._reader.consumeCharacter();h(n,this._reader,"unclosed-multiline-comment",[])}},{key:"_readInvisiblePragma",value:function(t,e,r){var n=[],i=this._reader;for(this._reader=this._reader.consumeInvisibleString(t),this._reader=this._reader.consumeInvisibleString(r);!this._reader.eof();)if(n.push(this._readInvisibleStringUntilDelimiter(r)),this._reader=this._reader.consumeInvisibleString(r),this._reader.startsWith(e))return this._reader=this._reader.consumeInvisibleString(e),n;return h(i,this._reader,"unclosed-multiline-comment",[])}},{key:"_readInvisibleStringUntilDelimiter",value:function(t){for(var e=this._reader,r=[];!this._reader.eof();){if(this._reader.peek()===t)return r.join("");r.push(this._reader.peek()),this._reader=this._reader.consumeInvisibleCharacter()}return h(e,this._reader,"unclosed-multiline-comment",[])}},{key:"_evaluatePragma",value:function(t,e){if(0===e.length)this._emitWarning(t,this._reader,"empty-pragma",[]);else if("BEGIN_REGION"===e[0]){var r=e[1];this._reader=this._reader.beginRegion(r)}else if("END_REGION"===e[0])this._reader=this._reader.endRegion();else if("ATTRIBUTE"===e[0]&&e.length>=2){var n=e[1],i=e.slice(2,e.length).join("@");this.setAttribute(n,i)}else if("LANGUAGE"===e[0]&&2===e.length){var o=e[1];this.addLanguageOption(o)}else this._emitWarning(t,this._reader,"unknown-pragma",[e[0]])}},{key:"_emitWarning",value:function(t,e,r,n){this._warnings.push(new m.GbsWarning(t,e,r,n))}},{key:"_checkBalancedDelimiters",value:function(t){if(t.tag===v.T_EOF&&this._delimiterStack.length>0){var e=this._delimiterStack.pop();h(e.startPos,e.endPos,"unmatched-opening-delimiter",[e.value])}else if(t.tag===v.T_LPAREN||t.tag===v.T_LBRACE||t.tag===v.T_LBRACK)this._delimiterStack.push(t);else if(t.tag===v.T_RPAREN||t.tag===v.T_RBRACE||t.tag===v.T_RBRACK){0===this._delimiterStack.length&&h(t.startPos,t.endPos,"unmatched-closing-delimiter",[t.value]);var r=this._delimiterStack.pop();T[r.value]!==t.value&&h(r.startPos,r.endPos,"unmatched-opening-delimiter",[r.value])}}},{key:"getPendingAttributes",value:function(){var t=this._pendingAttributes;return this._pendingAttributes={},t}},{key:"setAttribute",value:function(t,e){this._pendingAttributes[t]=e}},{key:"getLanguageOptions",value:function(){return this._languageOptions}},{key:"addLanguageOption",value:function(t){-1!==b.indexOf(t)?this._languageOptions.push(t):h(this._reader,this._reader,"unknown-language-option",[t])}}]),t}()},function(t,e,r){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t){return t.tag===s.N_StmtBlock&&t.statements.length>0&&t.statements.slice(-1)[0].tag===s.N_StmtReturn}function o(t,e,r,n){throw new c.GbsSyntaxError(t,e,r,n)}Object.defineProperty(e,"__esModule",{value:!0}),e.Linter=void 0;var a=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),s=r(2),u=r(8),c=r(1),l=r(0),h=r(18);e.Linter=function(){function t(e){n(this,t),this._symtable=e,this._enabledLinterChecks={"source-should-have-a-program-definition":!0,"procedure-should-not-have-return":!0,"function-should-have-return":!0,"return-statement-not-allowed-here":!0,"wildcard-pattern-should-be-last":!0,"variable-pattern-should-be-last":!0,"structure-pattern-repeats-constructor":!0,"structure-pattern-repeats-tuple-arity":!0,"structure-pattern-repeats-timeout":!0,"pattern-does-not-match-type":!0,"patterns-in-interactive-program-must-be-events":!0,"patterns-in-interactive-program-cannot-be-variables":!0,"patterns-in-switch-must-not-be-events":!0,"patterns-in-foreach-must-not-be-events":!0,"repeated-variable-in-tuple-assignment":!0,"constructor-used-as-procedure":!0,"undefined-procedure":!0,"procedure-arity-mismatch":!0,"numeric-pattern-repeats-number":!0,"structure-pattern-arity-mismatch":!0,"structure-construction-repeated-field":!0,"structure-construction-invalid-field":!0,"structure-construction-missing-field":!0,"structure-construction-cannot-be-an-event":!0,"undefined-function":!0,"function-arity-mismatch":!0,"type-used-as-constructor":!0,"procedure-used-as-constructor":!0,"undeclared-constructor":!0,"forbidden-extension-destructuring-foreach":!0,"forbidden-extension-allow-recursion":!0}}return a(t,[{key:"lint",value:function(t){return this._lintMain(t),this._symtable}},{key:"_ensureLintCheckExists",value:function(t){if(!(t in this._enabledLinterChecks))throw Error('Linter check "'+t+'" does not exist.')}},{key:"enableCheck",value:function(t,e){this._ensureLintCheckExists(t),this._enabledLinterChecks[t]=e}},{key:"_lintCheck",value:function(t,e,r,n){this._ensureLintCheckExists(r),this._enabledLinterChecks[r]&&o(t,e,r,n)}},{key:"_lintMain",value:function(t){var e=!0,r=!1,n=void 0;try{for(var i,o=t.definitions[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var a=i.value;this._addDefinitionToSymbolTable(a)}}catch(t){r=!0,n=t}finally{try{!e&&o.return&&o.return()}finally{if(r)throw n}}t.definitions.length>0&&null===this._symtable.program&&this._lintCheck(t.startPos,t.endPos,"source-should-have-a-program-definition",[]);var s=!0,u=!1,c=void 0;try{for(var l,h=t.definitions[Symbol.iterator]();!(s=(l=h.next()).done);s=!0){var p=l.value;this._lintDefinition(p)}}catch(t){u=!0,c=t}finally{try{!s&&h.return&&h.return()}finally{if(u)throw c}}this._disableRecursion(t)}},{key:"_addDefinitionToSymbolTable",value:function(t){switch(t.tag){case s.N_DefProgram:return this._symtable.defProgram(t);case s.N_DefInteractiveProgram:return this._symtable.defInteractiveProgram(t);case s.N_DefProcedure:return this._symtable.defProcedure(t);case s.N_DefFunction:return this._symtable.defFunction(t);case s.N_DefType:return this._symtable.defType(t);default:throw Error("Unknown definition: "+Symbol.keyFor(t.tag))}}},{key:"_lintDefinition",value:function(t){switch(t.tag){case s.N_DefProgram:return this._lintDefProgram(t);case s.N_DefInteractiveProgram:return this._lintDefInteractiveProgram(t);case s.N_DefProcedure:return this._lintDefProcedure(t);case s.N_DefFunction:return this._lintDefFunction(t);case s.N_DefType:return this._lintDefType(t);default:throw Error("Linter: Definition not implemented: "+Symbol.keyFor(t.tag))}}},{key:"_lintDefProgram",value:function(t){this._lintStmtBlock(t.body,!0),this._symtable.exitScope()}},{key:"_lintDefInteractiveProgram",value:function(t){this._lintSwitchBranches(t.branches,!0)}},{key:"_lintDefProcedure",value:function(t){i(t.body)&&this._lintCheck(t.startPos,t.endPos,"procedure-should-not-have-return",[t.name.value]);var e=!0,r=!1,n=void 0;try{for(var o,a=t.parameters[Symbol.iterator]();!(e=(o=a.next()).done);e=!0){var s=o.value;this._symtable.addNewLocalName(s,u.LocalParameter)}}catch(t){r=!0,n=t}finally{try{!e&&a.return&&a.return()}finally{if(r)throw n}}this._lintStmtBlock(t.body,!1),this._symtable.exitScope()}},{key:"_lintDefFunction",value:function(t){i(t.body)||this._lintCheck(t.startPos,t.endPos,"function-should-have-return",[t.name.value]);var e=!0,r=!1,n=void 0;try{for(var o,a=t.parameters[Symbol.iterator]();!(e=(o=a.next()).done);e=!0){var s=o.value;this._symtable.addNewLocalName(s,u.LocalParameter)}}catch(t){r=!0,n=t}finally{try{!e&&a.return&&a.return()}finally{if(r)throw n}}this._lintStmtBlock(t.body,!0),this._symtable.exitScope()}},{key:"_lintDefType",value:function(t){}},{key:"_lintStatement",value:function(t){switch(t.tag){case s.N_StmtBlock:return this._lintStmtBlock(t,!1);case s.N_StmtReturn:return this._lintStmtReturn(t);case s.N_StmtIf:return this._lintStmtIf(t);case s.N_StmtRepeat:return this._lintStmtRepeat(t);case s.N_StmtForeach:return this._lintStmtForeach(t);case s.N_StmtWhile:return this._lintStmtWhile(t);case s.N_StmtSwitch:return this._lintStmtSwitch(t);case s.N_StmtAssignVariable:return this._lintStmtAssignVariable(t);case s.N_StmtAssignTuple:return this._lintStmtAssignTuple(t);case s.N_StmtProcedureCall:return this._lintStmtProcedureCall(t);default:throw Error("Linter: Statement not implemented: "+Symbol.keyFor(t.tag))}}},{key:"_lintStmtBlock",value:function(t,e){var r=0,n=!0,i=!1,o=void 0;try{for(var a,u=t.statements[Symbol.iterator]();!(n=(a=u.next()).done);n=!0){var c=a.value;e&&r===t.statements.length-1||c.tag!==s.N_StmtReturn||this._lintCheck(c.startPos,c.endPos,"return-statement-not-allowed-here",[]),this._lintStatement(c),r++}}catch(t){i=!0,o=t}finally{try{!n&&u.return&&u.return()}finally{if(i)throw o}}}},{key:"_lintStmtReturn",value:function(t){this._lintExpression(t.result)}},{key:"_lintStmtIf",value:function(t){this._lintExpression(t.condition),this._lintStatement(t.thenBlock),null!==t.elseBlock&&this._lintStatement(t.elseBlock)}},{key:"_lintStmtRepeat",value:function(t){this._lintExpression(t.times),this._lintStatement(t.body)}},{key:"_lintStmtForeach",value:function(t){this._lintStmtForeachPattern(t.pattern),this._lintExpression(t.range);var e=!0,r=!1,n=void 0;try{for(var i,o=t.pattern.boundVariables[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var a=i.value;this._symtable.addNewLocalName(a,u.LocalIndex)}}catch(t){r=!0,n=t}finally{try{!e&&o.return&&o.return()}finally{if(r)throw n}}this._lintStatement(t.body);var s=!0,c=!1,l=void 0;try{for(var h,p=t.pattern.boundVariables[Symbol.iterator]();!(s=(h=p.next()).done);s=!0){var f=h.value;this._symtable.removeLocalName(f)}}catch(t){c=!0,l=t}finally{try{!s&&p.return&&p.return()}finally{if(c)throw l}}}},{key:"_lintStmtForeachPattern",value:function(t){t.tag!==s.N_PatternVariable&&this._lintCheck(t.startPos,t.endPos,"forbidden-extension-destructuring-foreach",[]),this._lintPattern(t),this._patternType(t)===(0,l.i18n)("TYPE:Event")&&this._lintCheck(t.startPos,t.endPos,"patterns-in-foreach-must-not-be-events",[])}},{key:"_lintStmtWhile",value:function(t){this._lintExpression(t.condition),this._lintStatement(t.body)}},{key:"_lintStmtSwitch",value:function(t){this._lintExpression(t.subject),this._lintSwitchBranches(t.branches,!1)}},{key:"_lintSwitchBranches",value:function(t,e){this._lintBranches(t,e,!1)}},{key:"_lintBranches",value:function(t,e,r){var n=!0,i=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var u=a.value;this._lintPattern(u.pattern)}}catch(t){i=!0,o=t}finally{try{!n&&s.return&&s.return()}finally{if(i)throw o}}this._branchesCheckWildcardAndVariable(t),this._branchesCheckNoRepeats(t),this._branchesCheckCompatible(t),e?this._branchesCheckTypeEvent(t):this._branchesCheckTypeNotEvent(t);var c=!0,l=!1,h=void 0;try{for(var p,f=t[Symbol.iterator]();!(c=(p=f.next()).done);c=!0){var _=p.value;this._lintBranchBody(_,r)}}catch(t){l=!0,h=t}finally{try{!c&&f.return&&f.return()}finally{if(l)throw h}}}},{key:"_branchesCheckWildcardAndVariable",value:function(t){var e=0,r=t.length,n=!0,i=!1,o=void 0;try{for(var a,u=t[Symbol.iterator]();!(n=(a=u.next()).done);n=!0){var c=a.value;c.pattern.tag===s.N_PatternWildcard&&e!==r-1&&this._lintCheck(c.pattern.startPos,c.pattern.endPos,"wildcard-pattern-should-be-last",[]),c.pattern.tag===s.N_PatternVariable&&e!==r-1&&this._lintCheck(c.pattern.startPos,c.pattern.endPos,"variable-pattern-should-be-last",[c.pattern.variableName.value]),e++}}catch(t){i=!0,o=t}finally{try{!n&&u.return&&u.return()}finally{if(i)throw o}}}},{key:"_branchesCheckNoRepeats",value:function(t){var e={},r={},n={},i=!1,o=!0,a=!1,u=void 0;try{for(var c,l=t[Symbol.iterator]();!(o=(c=l.next()).done);o=!0){var h=c.value;switch(h.pattern.tag){case s.N_PatternWildcard:case s.N_PatternVariable:break;case s.N_PatternNumber:var p=h.pattern.number.value;p in e&&this._lintCheck(h.pattern.startPos,h.pattern.endPos,"numeric-pattern-repeats-number",[p]),e[p]=!0;break;case s.N_PatternStructure:var f=h.pattern.constructorName.value;f in r&&this._lintCheck(h.pattern.startPos,h.pattern.endPos,"structure-pattern-repeats-constructor",[f]),r[f]=!0;break;case s.N_PatternTuple:var _=h.pattern.boundVariables.length;_ in n&&this._lintCheck(h.pattern.startPos,h.pattern.endPos,"structure-pattern-repeats-tuple-arity",[_]),n[_]=!0;break;case s.N_PatternTimeout:i&&this._lintCheck(h.pattern.startPos,h.pattern.endPos,"structure-pattern-repeats-timeout",[]),i=!0;break;default:throw Error('Linter: pattern "'+Symbol.keyFor(h.pattern.tag)+'" not implemented.')}}}catch(t){a=!0,u=t}finally{try{!o&&l.return&&l.return()}finally{if(a)throw u}}}},{key:"_branchesCheckCompatible",value:function(t){var e=null,r=!0,n=!1,i=void 0;try{for(var o,a=t[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){var s=o.value,u=this._patternType(s.pattern);null===e?e=u:null!==u&&e!==u&&this._lintCheck(s.pattern.startPos,s.pattern.endPos,"pattern-does-not-match-type",[(0,l.i18n)("<pattern-type>")(e),(0,l.i18n)("<pattern-type>")(u)])}}catch(t){n=!0,i=t}finally{try{!r&&a.return&&a.return()}finally{if(n)throw i}}}},{key:"_branchesCheckTypeEvent",value:function(t){var e=!0,r=!1,n=void 0;try{for(var i,o=t[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var a=i.value,u=this._patternType(a.pattern);null!==u&&u!==(0,l.i18n)("TYPE:Event")&&this._lintCheck(a.pattern.startPos,a.pattern.endPos,"patterns-in-interactive-program-must-be-events",[]),a.pattern.tag===s.N_PatternVariable&&this._lintCheck(a.pattern.startPos,a.pattern.endPos,"patterns-in-interactive-program-cannot-be-variables",[])}}catch(t){r=!0,n=t}finally{try{!e&&o.return&&o.return()}finally{if(r)throw n}}}},{key:"_branchesCheckTypeNotEvent",value:function(t){var e=!0,r=!1,n=void 0;try{for(var i,o=t[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var a=i.value;this._patternType(a.pattern)===(0,l.i18n)("TYPE:Event")&&this._lintCheck(a.pattern.startPos,a.pattern.endPos,"patterns-in-switch-must-not-be-events",[])}}catch(t){r=!0,n=t}finally{try{!e&&o.return&&o.return()}finally{if(r)throw n}}}},{key:"_lintBranchBody",value:function(t,e){var r=!0,n=!1,i=void 0;try{for(var o,a=t.pattern.boundVariables[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){var s=o.value;this._symtable.addNewLocalName(s,u.LocalParameter)}}catch(t){n=!0,i=t}finally{try{!r&&a.return&&a.return()}finally{if(n)throw i}}e?this._lintExpression(t.body):this._lintStatement(t.body);var c=!0,l=!1,h=void 0;try{for(var p,f=t.pattern.boundVariables[Symbol.iterator]();!(c=(p=f.next()).done);c=!0){var _=p.value;this._symtable.removeLocalName(_)}}catch(t){l=!0,h=t}finally{try{!c&&f.return&&f.return()}finally{if(l)throw h}}}},{key:"_patternType",value:function(t){switch(t.tag){case s.N_PatternWildcard:case s.N_PatternVariable:return null;case s.N_PatternNumber:return(0,l.i18n)("TYPE:Integer");case s.N_PatternStructure:return this._symtable.constructorType(t.constructorName.value);case s.N_PatternTuple:return"_TUPLE_"+t.boundVariables.length.toString();case s.N_PatternTimeout:return(0,l.i18n)("TYPE:Event");default:throw Error('Linter: pattern "'+Symbol.keyFor(t.tag)+'" not implemented.')}}},{key:"_lintStmtAssignVariable",value:function(t){this._symtable.setLocalName(t.variable,u.LocalVariable),this._lintExpression(t.value)}},{key:"_lintStmtAssignTuple",value:function(t){var e={},r=!0,n=!1,i=void 0;try{for(var o,a=t.variables[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){var s=o.value;this._symtable.setLocalName(s,u.LocalVariable),s.value in e&&this._lintCheck(s.startPos,s.endPos,"repeated-variable-in-tuple-assignment",[s.value]),e[s.value]=!0}}catch(t){n=!0,i=t}finally{try{!r&&a.return&&a.return()}finally{if(n)throw i}}this._lintExpression(t.value)}},{key:"_lintStmtProcedureCall",value:function(t){var e=t.procedureName.value;this._symtable.isProcedure(e)||(this._symtable.isConstructor(e)?this._lintCheck(t.startPos,t.endPos,"constructor-used-as-procedure",[e,this._symtable.constructorType(e)]):this._lintCheck(t.startPos,t.endPos,"undefined-procedure",[e]));var r=this._symtable.procedureParameters(e).length,n=t.args.length;r!==n&&this._lintCheck(t.startPos,t.endPos,"procedure-arity-mismatch",[e,r,n]);var i=!0,o=!1,a=void 0;try{for(var s,u=t.args[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var c=s.value;this._lintExpression(c)}}catch(t){o=!0,a=t}finally{try{!i&&u.return&&u.return()}finally{if(o)throw a}}}},{key:"_lintPattern",value:function(t){switch(t.tag){case s.N_PatternWildcard:return this._lintPatternWildcard(t);case s.N_PatternVariable:return this._lintPatternVariable(t);case s.N_PatternNumber:return this._lintPatternNumber(t);case s.N_PatternStructure:return this._lintPatternStructure(t);case s.N_PatternTuple:return this._lintPatternTuple(t);case s.N_PatternTimeout:return this._lintPatternTimeout(t);default:throw Error('Linter: pattern "'+Symbol.keyFor(t.tag)+'" not implemented.')}}},{key:"_lintPatternWildcard",value:function(t){}},{key:"_lintPatternVariable",value:function(t){}},{key:"_lintPatternNumber",value:function(t){}},{key:"_lintPatternStructure",value:function(t){var e=t.constructorName.value;if(!this._symtable.isConstructor(e))return void this._failExpectedConstructorButGot(t.startPos,t.endPos,e);var r=this._symtable.constructorFields(e).length,n=t.boundVariables.length;n>0&&r!==n&&this._lintCheck(t.startPos,t.endPos,"structure-pattern-arity-mismatch",[e,r,n])}},{key:"_lintPatternTuple",value:function(t){}},{key:"_lintPatternTimeout",value:function(t){}},{key:"_lintExpression",value:function(t){switch(t.tag){case s.N_ExprVariable:return this._lintExprVariable(t);case s.N_ExprConstantNumber:return this._lintExprConstantNumber(t);case s.N_ExprConstantString:return this._lintExprConstantString(t);case s.N_ExprChoose:return this._lintExprChoose(t);case s.N_ExprMatching:return this._lintExprMatching(t);case s.N_ExprList:return this._lintExprList(t);case s.N_ExprRange:return this._lintExprRange(t);case s.N_ExprTuple:return this._lintExprTuple(t);case s.N_ExprStructure:return this._lintExprStructure(t);case s.N_ExprStructureUpdate:return this._lintExprStructureUpdate(t);case s.N_ExprFunctionCall:return this._lintExprFunctionCall(t);default:throw Error("Linter: Expression not implemented: "+Symbol.keyFor(t.tag))}}},{key:"_lintExprVariable",value:function(t){}},{key:"_lintExprConstantNumber",value:function(t){}},{key:"_lintExprConstantString",value:function(t){}},{key:"_lintExprChoose",value:function(t){this._lintExpression(t.condition),this._lintExpression(t.trueExpr),this._lintExpression(t.falseExpr)}},{key:"_lintExprMatching",value:function(t){this._lintExpression(t.subject),this._lintMatchingBranches(t.branches)}},{key:"_lintMatchingBranches",value:function(t){this._lintBranches(t,!1,!0)}},{key:"_lintExprList",value:function(t){var e=!0,r=!1,n=void 0;try{for(var i,o=t.elements[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var a=i.value;this._lintExpression(a)}}catch(t){r=!0,n=t}finally{try{!e&&o.return&&o.return()}finally{if(r)throw n}}}},{key:"_lintExprRange",value:function(t){this._lintExpression(t.first),null!==t.second&&this._lintExpression(t.second),this._lintExpression(t.last)}},{key:"_lintExprTuple",value:function(t){var e=!0,r=!1,n=void 0;try{for(var i,o=t.elements[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var a=i.value;this._lintExpression(a)}}catch(t){r=!0,n=t}finally{try{!e&&o.return&&o.return()}finally{if(r)throw n}}}},{key:"_lintExprStructure",value:function(t){this._lintExprStructureOrUpdate(t,null)}},{key:"_lintExprStructureUpdate",value:function(t){this._lintExprStructureOrUpdate(t,t.original)}},{key:"_lintExprStructureOrUpdate",value:function(t,e){var r=t.constructorName.value;if(!this._symtable.isConstructor(r))return void this._failExpectedConstructorButGot(t.startPos,t.endPos,r);this._checkStructureTypeNotEvent(r,t),this._checkStructureNoRepeatedFields(r,t),this._checkStructureBindingsCorrect(r,t),null===e&&this._checkStructureBindingsComplete(r,t),null!==e&&this._lintExpression(e);var n=!0,i=!1,o=void 0;try{for(var a,s=t.fieldBindings[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var u=a.value;this._lintExpression(u.value)}}catch(t){i=!0,o=t}finally{try{!n&&s.return&&s.return()}finally{if(i)throw o}}}},{key:"_checkStructureNoRepeatedFields",value:function(t,e){var r=e.fieldNames(),n={},i=!0,o=!1,a=void 0;try{for(var s,u=r[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var c=s.value;c in n&&this._lintCheck(e.startPos,e.endPos,"structure-construction-repeated-field",[t,c]),n[c]=!0}}catch(t){o=!0,a=t}finally{try{!i&&u.return&&u.return()}finally{if(o)throw a}}}},{key:"_checkStructureBindingsCorrect",value:function(t,e){var r=e.fieldNames(),n=this._symtable.constructorFields(t),i=!0,o=!1,a=void 0;try{for(var s,u=r[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var c=s.value;-1===n.indexOf(c)&&this._lintCheck(e.startPos,e.endPos,"structure-construction-invalid-field",[t,c])}}catch(t){o=!0,a=t}finally{try{!i&&u.return&&u.return()}finally{if(o)throw a}}}},{key:"_checkStructureBindingsComplete",value:function(t,e){var r=e.fieldNames(),n=this._symtable.constructorFields(t),i=!0,o=!1,a=void 0;try{for(var s,u=n[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var c=s.value;-1===r.indexOf(c)&&this._lintCheck(e.startPos,e.endPos,"structure-construction-missing-field",[t,c])}}catch(t){o=!0,a=t}finally{try{!i&&u.return&&u.return()}finally{if(o)throw a}}}},{key:"_checkStructureTypeNotEvent",value:function(t,e){this._symtable.constructorType(t)===(0,l.i18n)("TYPE:Event")&&this._lintCheck(e.startPos,e.endPos,"structure-construction-cannot-be-an-event",[t])}},{key:"_lintExprFunctionCall",value:function(t){var e=t.functionName.value;this._symtable.isFunction(e)||this._symtable.isField(e)||this._lintCheck(t.startPos,t.endPos,"undefined-function",[e]);var r=void 0;r=this._symtable.isFunction(e)?this._symtable.functionParameters(e).length:1;var n=t.args.length;r!==n&&this._lintCheck(t.startPos,t.endPos,"function-arity-mismatch",[e,r,n]);var i=!0,o=!1,a=void 0;try{for(var s,u=t.args[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var c=s.value;this._lintExpression(c)}}catch(t){o=!0,a=t}finally{try{!i&&u.return&&u.return()}finally{if(o)throw a}}}},{key:"_disableRecursion",value:function(t){if(this._enabledLinterChecks["forbidden-extension-allow-recursion"]){var e=(new h.RecursionChecker).callCycle(t);null!==e&&this._lintCheck(e[0].location.startPos,e[0].location.endPos,"forbidden-extension-allow-recursion",[e])}}},{key:"_failExpectedConstructorButGot",value:function(t,e,r){this._symtable.isType(r)?this._lintCheck(t,e,"type-used-as-constructor",[r,this._symtable.typeConstructors(r)]):this._symtable.isProcedure(r)?this._lintCheck(t,e,"procedure-used-as-constructor",[r]):this._lintCheck(t,e,"undeclared-constructor",[r])}}]),t}()},function(t,e,r){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0}),e.RecursionChecker=void 0;var i=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),o=r(2),a=r(3);e.RecursionChecker=function(){function t(){n(this,t),this._currentRoutine=null,this._callGraph={}}return i(t,[{key:"callCycle",value:function(t){return this._visitNode(t),this._findCallCycle()}},{key:"_addEdge",value:function(t,e){t in this._callGraph||(this._callGraph[t]={}),e.value in this._callGraph[t]||(this._callGraph[t][e.value]=e)}},{key:"_visitNode",value:function(t){null===t||t instanceof a.Token||(t instanceof Array?this._visitNodes(t):this._visitTaggedNode(t))}},{key:"_visitNodes",value:function(t){var e=!0,r=!1,n=void 0;try{for(var i,o=t[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var a=i.value;this._visitNode(a)}}catch(t){r=!0,n=t}finally{try{!e&&o.return&&o.return()}finally{if(r)throw n}}}},{key:"_visitTaggedNode",value:function(t){switch(t.tag){case o.N_DefProgram:case o.N_DefInteractiveProgram:this._visitProgramDefinition(t);break;case o.N_DefProcedure:case o.N_DefFunction:this._visitRoutineDefinition(t);break;case o.N_StmtProcedureCall:this._visitProcedureCall(t);break;case o.N_ExprFunctionCall:this._visitFunctionCall(t)}this._visitNodes(t.children)}},{key:"_visitProgramDefinition",value:function(t){this._currentRoutine="program"}},{key:"_visitRoutineDefinition",value:function(t){this._currentRoutine=t.name.value}},{key:"_visitProcedureCall",value:function(t){this._addEdge(this._currentRoutine,t.procedureName)}},{key:"_visitFunctionCall",value:function(t){this._addEdge(this._currentRoutine,t.functionName)}},{key:"_findCallCycle",value:function(){var t={},e={};for(var r in this._callGraph){t[r]=!0,e[r]=!0;var n=this._findCallCycleFrom(t,e,[],r);if(null!=n)return n;delete e[r]}return null}},{key:"_findCallCycleFrom",value:function(t,e,r,n){for(var i in this._callGraph[n]){if(r.push({caller:n,callee:i,location:this._callGraph[n][i]}),i in e){for(;r[0].caller!==i;)r.shift();return r.push(),r}if(!(i in t)){t[i]=!0,e[i]=!0;var o=this._findCallCycleFrom(t,e,r,i);if(null!==o)return o;delete e[i]}r.pop()}return null}}]),t}()},function(t,e,r){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0}),e.Compiler=void 0;var i=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),o=r(2),a=r(9),s=r(5),u=r(4),c=r(0);e.Compiler=function(){function t(e){n(this,t),this._symtable=e,this._code=new a.Code([]),this._nextLabel=0,this._nextVariable=0,this._primitives=new u.RuntimePrimitives}return i(t,[{key:"compile",value:function(t){return this._compileMain(t),this._code}},{key:"_compileMain",value:function(t){if(0===t.definitions.length)return void this._produce(t.startPos,t.endPos,new a.IReturn);var e=!0,r=!1,n=void 0;try{for(var i,s=t.definitions[Symbol.iterator]();!(e=(i=s.next()).done);e=!0){var u=i.value;u.tag===o.N_DefProgram?this._compileDefProgram(u):u.tag===o.N_DefInteractiveProgram&&this._compileDefInteractiveProgram(u)}}catch(t){r=!0,n=t}finally{try{!e&&s.return&&s.return()}finally{if(r)throw n}}var c=!0,l=!1,h=void 0;try{for(var p,f=t.definitions[Symbol.iterator]();!(c=(p=f.next()).done);c=!0){var _=p.value;_.tag===o.N_DefProcedure?this._compileDefProcedure(_):_.tag===o.N_DefFunction&&this._compileDefFunction(_)}}catch(t){l=!0,h=t}finally{try{!c&&f.return&&f.return()}finally{if(l)throw h}}}},{key:"_compileDefProgram",value:function(t){this._compileStatement(t.body),this._produce(t.startPos,t.endPos,new a.IReturn)}},{key:"_compileDefInteractiveProgram",value:function(t){this._compileMatchBranches(t,!1),this._produce(t.startPos,t.endPos,new a.IReturn)}},{key:"_compileDefProcedure",value:function(t){this._produce(t.startPos,t.endPos,new a.ILabel(t.name.value));for(var e=0;e<t.parameters.length;e++){var r=t.parameters[e].value;this._produce(t.startPos,t.endPos,new a.ISetVariable(r))}this._compileStatement(t.body),this._produce(t.startPos,t.endPos,new a.IReturn)}},{key:"_compileDefFunction",value:function(t){this._produceList(t.startPos,t.endPos,[new a.ILabel(t.name.value),new a.ISaveState]);for(var e=0;e<t.parameters.length;e++){var r=t.parameters[e].value;this._produce(t.startPos,t.endPos,new a.ISetVariable(r))}this._compileStatement(t.body),this._produceList(t.startPos,t.endPos,[new a.IRestoreState,new a.IReturn])}},{key:"_compileStatement",value:function(t){switch(t.tag){case o.N_StmtBlock:return this._compileStmtBlock(t);case o.N_StmtReturn:return this._compileStmtReturn(t);case o.N_StmtIf:return this._compileStmtIf(t);case o.N_StmtRepeat:return this._compileStmtRepeat(t);case o.N_StmtForeach:return this._compileStmtForeach(t);case o.N_StmtWhile:return this._compileStmtWhile(t);case o.N_StmtSwitch:return this._compileStmtSwitch(t);case o.N_StmtAssignVariable:return this._compileStmtAssignVariable(t);case o.N_StmtAssignTuple:return this._compileStmtAssignTuple(t);case o.N_StmtProcedureCall:return this._compileStmtProcedureCall(t);default:throw Error("Compiler: Statement not implemented: "+Symbol.keyFor(t.tag))}}},{key:"_compileStmtBlock",value:function(t){var e=!0,r=!1,n=void 0;try{for(var i,o=t.statements[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var a=i.value;this._compileStatement(a)}}catch(t){r=!0,n=t}finally{try{!e&&o.return&&o.return()}finally{if(r)throw n}}}},{key:"_compileStmtReturn",value:function(t){return this._compileExpression(t.result)}},{key:"_compileStmtIf",value:function(t){this._compileExpression(t.condition),this._produce(t.condition.startPos,t.condition.endPos,new a.ITypeCheck(new s.TypeStructure((0,c.i18n)("TYPE:Bool"),{})));var e=this._freshLabel();if(this._produce(t.startPos,t.endPos,new a.IJumpIfFalse(e)),this._compileStatement(t.thenBlock),null===t.elseBlock)this._produce(t.startPos,t.endPos,new a.ILabel(e));else{var r=this._freshLabel();this._produceList(t.startPos,t.endPos,[new a.IJump(r),new a.ILabel(e)]),this._compileStatement(t.elseBlock),this._produce(t.startPos,t.endPos,new a.ILabel(r))}}},{key:"_compileStmtRepeat",value:function(t){this._compileExpression(t.times),this._produce(t.times.startPos,t.times.endPos,new a.ITypeCheck(new s.TypeInteger));var e=this._freshLabel(),r=this._freshLabel();this._produceList(t.startPos,t.endPos,[new a.ILabel(e),new a.IDup,new a.IPushInteger(0),new a.IPrimitiveCall(">",2),new a.IJumpIfFalse(r)]),this._compileStatement(t.body),this._produceList(t.startPos,t.endPos,[new a.IPushInteger(1),new a.IPrimitiveCall("-",2),new a.IJump(e),new a.ILabel(r),new a.IPop])}},{key:"_compileStmtForeach",value:function(t){var e=this._freshLabel(),r=this._freshLabel(),n=this._freshVariable(),i=this._freshVariable(),o=this._freshVariable();this._compileExpression(t.range),this._produceList(t.range.startPos,t.range.endPos,[new a.ITypeCheck(new s.TypeList(new s.TypeAny)),new a.ISetVariable(n),new a.IPushVariable(n),new a.IPrimitiveCall("_unsafeListLength",1),new a.ISetVariable(o)]),this._produceList(t.startPos,t.endPos,[new a.IPushInteger(0),new a.ISetVariable(i),new a.ILabel(e),new a.IPushVariable(i),new a.IPushVariable(o),new a.IPrimitiveCall("<",2),new a.IJumpIfFalse(r),new a.IPushVariable(n),new a.IPushVariable(i),new a.IPrimitiveCall("_unsafeListNth",2)]),this._compileMatchForeachPatternOrFail(t.pattern),this._compileStatement(t.body),this._produceList(t.startPos,t.endPos,[new a.IPushVariable(i),new a.IPushInteger(1),new a.IPrimitiveCall("+",2),new a.ISetVariable(i),new a.IJump(e),new a.ILabel(r),new a.IUnsetVariable(n),new a.IUnsetVariable(o),new a.IUnsetVariable(i)]),this._compilePatternUnbind(t.pattern)}},{key:"_compileMatchForeachPatternOrFail",value:function(t){switch(t.tag){case o.N_PatternWildcard:return void this._produce(t.startPos,t.endPos,new a.IPop);case o.N_PatternVariable:return void this._produce(t.startPos,t.endPos,new a.ISetVariable(t.variableName.value));default:var e=this._freshLabel();return this._compilePatternCheck(t,e),this._produceList(t.startPos,t.endPos,[new a.IPushString("foreach-pattern-does-not-match"),new a.IPrimitiveCall("_FAIL",1),new a.ILabel(e)]),this._compilePatternBind(t),void this._produce(t.startPos,t.endPos,new a.IPop)}}},{key:"_compileStmtWhile",value:function(t){var e=this._freshLabel(),r=this._freshLabel();this._produce(t.startPos,t.endPos,new a.ILabel(e)),this._compileExpression(t.condition),this._produceList(t.startPos,t.endPos,[new a.ITypeCheck(new s.TypeStructure((0,c.i18n)("TYPE:Bool"),{})),new a.IJumpIfFalse(r)]),this._compileStatement(t.body),this._produceList(t.startPos,t.endPos,[new a.IJump(e),new a.ILabel(r)])}},{key:"_compileStmtSwitch",value:function(t){this._compileExpression(t.subject),this._compileMatchBranches(t,!1)}},{key:"_compileMatchBranches",value:function(t,e){var r=[],n=!0,i=!1,o=void 0;try{for(var s,u=t.branches[Symbol.iterator]();!(n=(s=u.next()).done);n=!0){var c=s.value,l=this._freshLabel();r.push(l),this._compilePatternCheck(c.pattern,l)}}catch(t){i=!0,o=t}finally{try{!n&&u.return&&u.return()}finally{if(i)throw o}}this._produceList(t.startPos,t.endPos,[new a.IPushString("switch-does-not-match"),new a.IPrimitiveCall("_FAIL",1)]);for(var h=this._freshLabel(),p=0;p<r.length;p++){var f=t.branches[p],_=r[p];this._produce(f.startPos,f.endPos,new a.ILabel(_)),this._compilePatternBind(f.pattern),this._produce(f.startPos,f.endPos,new a.IPop),e?this._compileExpression(f.body):this._compileStatement(f.body),this._compilePatternUnbind(f.pattern),this._produce(f.startPos,f.endPos,new a.IJump(h))}this._produce(t.startPos,t.endPos,new a.ILabel(h))}},{key:"_compileStmtAssignVariable",value:function(t){this._compileExpression(t.value),this._produce(t.startPos,t.endPos,new a.ISetVariable(t.variable.value))}},{key:"_compileStmtAssignTuple",value:function(t){this._compileExpression(t.value);for(var e=[],r=0;r<t.variables.length;r++)e.push(new s.TypeAny);var n=new s.TypeTuple(e);this._produce(t.startPos,t.endPos,new a.ITypeCheck(n));for(var i=0;i<t.variables.length;i++)this._produceList(t.startPos,t.endPos,[new a.IReadTupleComponent(i),new a.ISetVariable(t.variables[i].value)]);this._produce(t.startPos,t.endPos,new a.IPop)}},{key:"_compileStmtProcedureCall",value:function(t){var e=t.procedureName.value,r=!0,n=!1,i=void 0;try{for(var o,a=t.args[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){var s=o.value;this._compileExpression(s)}}catch(t){n=!0,i=t}finally{try{!r&&a.return&&a.return()}finally{if(n)throw i}}if(this._primitives.isProcedure(e))this._compileStmtProcedureCallPrimitive(t);else{if(!this._symtable.isProcedure(e))throw Error("Compiler: "+e+" is an undefined procedure.");this._compileStmtProcedureCallUserDefined(t)}}},{key:"_compileStmtProcedureCallPrimitive",value:function(t){this._produce(t.startPos,t.endPos,new a.IPrimitiveCall(t.procedureName.value,t.args.length))}},{key:"_compileStmtProcedureCallUserDefined",value:function(t){this._produce(t.startPos,t.endPos,new a.ICall(t.procedureName.value,t.args.length))}},{key:"_compilePatternCheck",value:function(t,e){switch(t.tag){case o.N_PatternWildcard:return this._compilePatternCheckWildcard(t,e);case o.N_PatternVariable:return this._compilePatternCheckVariable(t,e);case o.N_PatternNumber:return this._compilePatternCheckNumber(t,e);case o.N_PatternStructure:return this._compilePatternCheckStructure(t,e);case o.N_PatternTuple:return this._compilePatternCheckTuple(t,e);case o.N_PatternTimeout:return this._compilePatternCheckTimeout(t,e);default:throw Error("Compiler: Pattern check not implemented: "+Symbol.keyFor(t.tag))}}},{key:"_compilePatternCheckWildcard",value:function(t,e){this._produce(t.startPos,t.endPos,new a.IJump(e))}},{key:"_compilePatternCheckVariable",value:function(t,e){this._produce(t.startPos,t.endPos,new a.IJump(e))}},{key:"_compilePatternCheckNumber",value:function(t,e){this._produceList(t.startPos,t.endPos,[new a.IDup,new a.ITypeCheck(new s.TypeInteger),new a.IPushInteger(t.number.value),new a.IPrimitiveCall("/=",2),new a.IJumpIfFalse(e)])}},{key:"_compilePatternCheckStructure",value:function(t,e){var r=t.constructorName.value,n=this._symtable.constructorType(r),i=new s.TypeStructure(n,{});this._produce(t.startPos,t.endPos,new a.ITypeCheck(i)),this._produce(t.startPos,t.endPos,new a.IJumpIfStructure(r,e))}},{key:"_compilePatternCheckTuple",value:function(t,e){for(var r=[],n=0;n<t.boundVariables.length;n++)r.push(new s.TypeAny);var i=new s.TypeTuple(r);this._produce(t.startPos,t.endPos,new a.ITypeCheck(i)),this._produce(t.startPos,t.endPos,new a.IJumpIfTuple(t.boundVariables.length,e))}},{key:"_compilePatternCheckTimeout",value:function(t,e){this._produce(t.startPos,t.endPos,new a.IJumpIfStructure((0,c.i18n)("CONS:TIMEOUT"),e))}},{key:"_compilePatternBind",value:function(t){switch(t.tag){case o.N_PatternWildcard:return;case o.N_PatternVariable:return void this._compilePatternBindVariable(t);case o.N_PatternNumber:return;case o.N_PatternStructure:return void this._compilePatternBindStructure(t);case o.N_PatternTuple:return void this._compilePatternBindTuple(t);case o.N_PatternTimeout:return;default:throw Error("Compiler: Pattern binding not implemented: "+Symbol.keyFor(t.tag))}}},{key:"_compilePatternBindVariable",value:function(t){this._produceList(t.startPos,t.endPos,[new a.IDup,new a.ISetVariable(t.variableName.value)])}},{key:"_compilePatternBindStructure",value:function(t){if(0!==t.boundVariables.length)for(var e=t.constructorName.value,r=this._symtable.constructorFields(e),n=0;n<r.length;n++){var i=t.boundVariables[n],o=r[n];this._produceList(t.startPos,t.endPos,[new a.IReadStructureField(o),new a.ISetVariable(i.value)])}}},{key:"_compilePatternBindTuple",value:function(t){for(var e=0;e<t.boundVariables.length;e++){var r=t.boundVariables[e];this._produceList(t.startPos,t.endPos,[new a.IReadTupleComponent(e),new a.ISetVariable(r.value)])}}},{key:"_compilePatternUnbind",value:function(t){var e=!0,r=!1,n=void 0;try{for(var i,o=t.boundVariables[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var s=i.value;this._produceList(t.startPos,t.endPos,[new a.IUnsetVariable(s.value)])}}catch(t){r=!0,n=t}finally{try{!e&&o.return&&o.return()}finally{if(r)throw n}}}},{key:"_compileExpression",value:function(t){switch(t.tag){case o.N_ExprVariable:return this._compileExprVariable(t);case o.N_ExprConstantNumber:return this._compileExprConstantNumber(t);case o.N_ExprConstantString:return this._compileExprConstantString(t);case o.N_ExprChoose:return this._compileExprChoose(t);case o.N_ExprMatching:return this._compileExprMatching(t);case o.N_ExprList:return this._compileExprList(t);case o.N_ExprRange:return this._compileExprRange(t);case o.N_ExprTuple:return this._compileExprTuple(t);case o.N_ExprStructure:return this._compileExprStructure(t);case o.N_ExprStructureUpdate:return this._compileExprStructureUpdate(t);case o.N_ExprFunctionCall:return this._compileExprFunctionCall(t);default:throw Error("Compiler: Expression not implemented: "+Symbol.keyFor(t.tag))}}},{key:"_compileExprVariable",value:function(t){this._produce(t.startPos,t.endPos,new a.IPushVariable(t.variableName.value))}},{key:"_compileExprConstantNumber",value:function(t){this._produce(t.startPos,t.endPos,new a.IPushInteger(t.number.value))}},{key:"_compileExprConstantString",value:function(t){this._produce(t.startPos,t.endPos,new a.IPushString(t.string.value))}},{key:"_compileExprChoose",value:function(t){this._compileExpression(t.condition),this._produce(t.condition.startPos,t.condition.endPos,new a.ITypeCheck(new s.TypeStructure((0,c.i18n)("TYPE:Bool"),{})));var e=this._freshLabel();this._produce(t.startPos,t.endPos,new a.IJumpIfFalse(e)),this._compileExpression(t.trueExpr);var r=this._freshLabel();this._produceList(t.startPos,t.endPos,[new a.IJump(r),new a.ILabel(e)]),this._compileExpression(t.falseExpr),this._produce(t.startPos,t.endPos,new a.ILabel(r))}},{key:"_compileExprMatching",value:function(t){this._compileExpression(t.subject),this._compileMatchBranches(t,!0)}},{key:"_compileExprList",value:function(t){var e=!0,r=!1,n=void 0;try{for(var i,o=t.elements[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var s=i.value;this._compileExpression(s)}}catch(t){r=!0,n=t}finally{try{!e&&o.return&&o.return()}finally{if(r)throw n}}this._produce(t.startPos,t.endPos,new a.IMakeList(t.elements.length))}},{key:"_compileExprRange",value:function(t){this._compileExpression(t.first),this._compileExpression(t.last),null===t.second?this._produce(t.startPos,t.endPos,new a.IPrimitiveCall("_makeRange",2)):(this._compileExpression(t.second),this._produce(t.startPos,t.endPos,new a.IPrimitiveCall("_makeRangeWithSecond",3)))}},{key:"_compileExprTuple",value:function(t){var e=!0,r=!1,n=void 0;try{for(var i,o=t.elements[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var s=i.value;this._compileExpression(s)}}catch(t){r=!0,n=t}finally{try{!e&&o.return&&o.return()}finally{if(r)throw n}}this._produce(t.startPos,t.endPos,new a.IMakeTuple(t.elements.length))}},{key:"_compileExprStructure",value:function(t){var e=[],r=!0,n=!1,i=void 0;try{for(var o,s=t.fieldBindings[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var u=o.value;this._compileExpression(u.value),e.push(u.fieldName.value)}}catch(t){n=!0,i=t}finally{try{!r&&s.return&&s.return()}finally{if(n)throw i}}var c=t.constructorName.value,l=this._symtable.constructorType(c);this._produce(t.startPos,t.endPos,new a.IMakeStructure(l,c,e))}},{key:"_compileExprStructureUpdate",value:function(t){this._compileExpression(t.original);var e=[],r=!0,n=!1,i=void 0;try{for(var o,s=t.fieldBindings[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var u=o.value;this._compileExpression(u.value),e.push(u.fieldName.value)}}catch(t){n=!0,i=t}finally{try{!r&&s.return&&s.return()}finally{if(n)throw i}}var c=t.constructorName.value,l=this._symtable.constructorType(c);this._produce(t.startPos,t.endPos,new a.IUpdateStructure(l,c,e))}},{key:"_compileExprFunctionCall",value:function(t){var e=t.functionName.value;if("&&"===e)this._compileExprFunctionCallAnd(t);else if("||"===e)this._compileExprFunctionCallOr(t);else{var r=!0,n=!1,i=void 0;try{for(var o,a=t.args[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){var s=o.value;this._compileExpression(s)}}catch(t){n=!0,i=t}finally{try{!r&&a.return&&a.return()}finally{if(n)throw i}}if(this._primitives.isFunction(e))this._compileExprFunctionCallPrimitive(t);else if(this._symtable.isFunction(e))this._compileExprFunctionCallUserDefined(t);else{if(!this._symtable.isField(e))throw Error("Compiler: "+e+" is an undefined function.");this._compileExprFunctionCallFieldAccessor(t)}}}},{key:"_compileExprFunctionCallAnd",value:function(t){var e=t.args[0],r=t.args[1],n=this._freshLabel();this._compileExpression(e),this._produceList(t.startPos,t.endPos,[new a.ITypeCheck(new s.TypeStructure((0,c.i18n)("TYPE:Bool"),{})),new a.IJumpIfStructure((0,c.i18n)("CONS:False"),n),new a.IPop]),this._compileExpression(r),this._produceList(t.startPos,t.endPos,[new a.ITypeCheck(new s.TypeStructure((0,c.i18n)("TYPE:Bool"),{})),new a.ILabel(n)])}},{key:"_compileExprFunctionCallOr",value:function(t){var e=t.args[0],r=t.args[1],n=this._freshLabel();this._compileExpression(e),this._produceList(t.startPos,t.endPos,[new a.ITypeCheck(new s.TypeStructure((0,c.i18n)("TYPE:Bool"),{})),new a.IJumpIfStructure((0,c.i18n)("CONS:True"),n),new a.IPop]),this._compileExpression(r),this._produceList(t.startPos,t.endPos,[new a.ITypeCheck(new s.TypeStructure((0,c.i18n)("TYPE:Bool"),{})),new a.ILabel(n)])}},{key:"_compileExprFunctionCallPrimitive",value:function(t){this._produce(t.startPos,t.endPos,new a.IPrimitiveCall(t.functionName.value,t.args.length))}},{key:"_compileExprFunctionCallUserDefined",value:function(t){this._produce(t.startPos,t.endPos,new a.ICall(t.functionName.value,t.args.length))}},{key:"_compileExprFunctionCallFieldAccessor",value:function(t){this._produceList(t.startPos,t.endPos,[new a.IReadStructureFieldPop(t.functionName.value)])}},{key:"_produce",value:function(t,e,r){r.startPos=t,r.endPos=e,this._code.produce(r)}},{key:"_produceList",value:function(t,e,r){var n=!0,i=!1,o=void 0;try{for(var a,s=r[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var u=a.value;this._produce(t,e,u)}}catch(t){i=!0,o=t}finally{try{!n&&s.return&&s.return()}finally{if(i)throw o}}}},{key:"_freshLabel",value:function(){var t="_l"+this._nextLabel.toString();return this._nextLabel++,t}},{key:"_freshVariable",value:function(){var t="_v"+this._nextVariable.toString();return this._nextVariable++,t}}]),t}()},function(t,e,r){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function a(t,e,r,n){throw new l.GbsRuntimeError(t,e,r,n)}Object.defineProperty(e,"__esModule",{value:!0}),e.VirtualMachine=void 0;var s=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),u=r(9),c=r(5),l=r(1),h=r(0),p=r(4),f=Symbol.for("RT_ExitProgram"),_=function(t){function e(t){n(this,e);var r=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,Symbol.keyFor(t)));return r.tag=t,r}return o(e,t),e}(Error),m=function(t){function e(t){n(this,e);var r=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,f));return r.returnValue=t,r}return o(e,t),e}(_),d=function(){function t(e,r,i){n(this,t),this._routineName=r,this._instructionPointer=i,this._variableTypes={},this._variables={},this._stack=[],this._uniqueFrameId=e}return s(t,[{key:"setVariable",value:function(t,e,r){this._variableTypes[t]=e,this._variables[t]=r}},{key:"unsetVariable",value:function(t,e){delete this._variables[t]}},{key:"getVariableType",value:function(t){return t in this._variableTypes?this._variableTypes[t]:new c.TypeAny}},{key:"getVariable",value:function(t){return t in this._variables?this._variables[t]:null}},{key:"stackEmpty",value:function(){return 0===this._stack.length}},{key:"pushValue",value:function(t){this._stack.push(t)}},{key:"stackTop",value:function(){if(0===this._stack.length)throw Error("VM: no value at the top of the stack; the stack is empty.");return this._stack[this._stack.length-1]}},{key:"popValue",value:function(){if(0===this._stack.length)throw Error("VM: no value to pop; the stack is empty.");return this._stack.pop()}},{key:"routineName",get:function(){return this._routineName}},{key:"uniqueFrameId",get:function(){return this._uniqueFrameId}},{key:"instructionPointer",get:function(){return this._instructionPointer},set:function(t){this._instructionPointer=t}}]),t}();e.VirtualMachine=function(){function t(e,r){n(this,t),this._code=e,this._labelTargets=this._code.labelTargets(),this._nextFrameId=0,this._callStack=[],this._callStack.push(this._newFrame("program",0)),this._globalStateStack=[r],this._primitives=new p.RuntimePrimitives,this._snapshotCallback=null}return s(t,[{key:"run",value:function(){return this.runWithTimeout(0)}},{key:"runWithTimeout",value:function(t){return this.runWithTimeoutTakingSnapshots(t,null)}},{key:"runEventWithTimeout",value:function(t,e){return this._callStack=[this._newFrame("program",0)],this._currentFrame().pushValue(t),this.runWithTimeout(e)}},{key:"runWithTimeoutTakingSnapshots",value:function(t,e){var r=(new Date).getTime();this._snapshotCallback=e,this._takeSnapshot("program");try{for(;;)this._step(),this._timeoutIfNeeded(r,t)}catch(t){if(t.tag===f)return t.returnValue;throw t}}},{key:"_newFrame",value:function(t,e){var r=this._nextFrameId;return this._nextFrameId++,new d(r,t,e)}},{key:"_timeoutIfNeeded",value:function(t,e){if(e>0&&(new Date).getTime()-t>e){var r=this._currentInstruction();a(r.startPos,r.endPos,"timeout",[e])}}},{key:"_takeSnapshot",value:function(t){if(null!==this._snapshotCallback){var e=this._currentInstruction();this._snapshotCallback(t,e.startPos,this._callStack,this.globalState())}}},{key:"globalState",value:function(){return this._globalStateStack[this._globalStateStack.length-1]}},{key:"setGlobalState",value:function(t){this._globalStateStack[this._globalStateStack.length-1]=t}},{key:"_currentFrame",value:function(){return this._callStack[this._callStack.length-1]}},{key:"_currentInstruction",value:function(){return this._code.at(this._currentFrame().instructionPointer)}},{key:"_step",value:function(){switch(this._currentInstruction().opcode){case u.I_PushInteger:return this._stepPushInteger();case u.I_PushString:return this._stepPushString();case u.I_PushVariable:return this._stepPushVariable();case u.I_SetVariable:return this._stepSetVariable();case u.I_UnsetVariable:return this._stepUnsetVariable();case u.I_Label:return this._stepLabel();case u.I_Jump:return this._stepJump();case u.I_JumpIfFalse:return this._stepJumpIfFalse();case u.I_JumpIfStructure:return this._stepJumpIfStructure();case u.I_JumpIfTuple:return this._stepJumpIfTuple();case u.I_Call:return this._stepCall();case u.I_Return:return this._stepReturn();case u.I_MakeTuple:return this._stepMakeTuple();case u.I_MakeList:return this._stepMakeList();case u.I_MakeStructure:return this._stepMakeStructure();case u.I_UpdateStructure:return this._stepUpdateStructure();case u.I_ReadTupleComponent:return this._stepReadTupleComponent();case u.I_ReadStructureField:return this._stepReadStructureField();case u.I_ReadStructureFieldPop:return this._stepReadStructureFieldPop();case u.I_Add:return this._stepAdd();case u.I_Dup:return this._stepDup();case u.I_Pop:return this._stepPop();case u.I_PrimitiveCall:return this._stepPrimitiveCall();case u.I_SaveState:return this._stepSaveState();case u.I_RestoreState:return this._stepRestoreState();case u.I_TypeCheck:return this._stepTypeCheck();default:throw Error("VM: opcode "+Symbol.keyFor(this._currentInstruction().opcode)+" not implemented")}}},{key:"_stepPushInteger",value:function(){var t=this._currentFrame(),e=this._currentInstruction();t.pushValue(new c.ValueInteger(e.number)),t.instructionPointer++}},{key:"_stepPushString",value:function(){var t=this._currentFrame(),e=this._currentInstruction();t.pushValue(new c.ValueString(e.string)),t.instructionPointer++}},{key:"_stepPushVariable",value:function(){var t=this._currentFrame(),e=this._currentInstruction(),r=t.getVariable(e.variableName);null===r&&a(e.startPos,e.endPos,"undefined-variable",[e.variableName]),t.pushValue(r),t.instructionPointer++}},{key:"_stepSetVariable",value:function(){var t=this._currentFrame(),e=this._currentInstruction(),r=t.popValue(),n=t.getVariableType(e.variableName),i=r.type(),o=(0,c.joinTypes)(n,i);null===o&&a(e.startPos,e.endPos,"incompatible-types-on-assignment",[e.variableName,n,i]),t.setVariable(e.variableName,o,r),t.instructionPointer++}},{key:"_stepUnsetVariable",value:function(){var t=this._currentFrame(),e=this._currentInstruction();t.unsetVariable(e.variableName),t.instructionPointer++}},{key:"_stepLabel",value:function(){this._currentFrame().instructionPointer++}},{key:"_stepJump",value:function(){var t=this._currentFrame(),e=this._currentInstruction();t.instructionPointer=this._labelTargets[e.targetLabel]}},{key:"_stepJumpIfFalse",value:function(){var t=this._currentFrame(),e=this._currentInstruction(),r=t.popValue();r.tag===c.V_Structure&&"False"===r.constructorName?t.instructionPointer=this._labelTargets[e.targetLabel]:t.instructionPointer++}},{key:"_stepJumpIfStructure",value:function(){var t=this._currentFrame(),e=this._currentInstruction(),r=t.stackTop();r.tag===c.V_Structure&&r.constructorName===e.constructorName?t.instructionPointer=this._labelTargets[e.targetLabel]:t.instructionPointer++}},{key:"_stepJumpIfTuple",value:function(){var t=this._currentFrame(),e=this._currentInstruction(),r=t.stackTop();r.tag===c.V_Tuple&&r.size()===e.size?t.instructionPointer=this._labelTargets[e.targetLabel]:t.instructionPointer++}},{key:"_stepCall",value:function(){var t=this._currentFrame(),e=this._currentInstruction(),r=this._newFrame(e.targetLabel,this._labelTargets[e.targetLabel]);this._callStack.push(r);for(var n=0;n<e.nargs;n++)t.stackEmpty()&&a(e.startPos,e.endPos,"too-few-arguments",[e.targetLabel]),r.pushValue(t.popValue())}},{key:"_stepReturn",value:function(){var t=this._currentFrame(),e=void 0;if(t.stackEmpty())e=null;else if(this._takeSnapshot(t.routineName),e=t.popValue(),!t.stackEmpty())throw Error("VM: stack should be empty");if(this._callStack.pop(),0===this._callStack.length)throw new m(e);var r=this._currentFrame();null!==e&&r.pushValue(e),r.instructionPointer++}},{key:"_stepMakeTuple",value:function(){for(var t=this._currentFrame(),e=this._currentInstruction(),r=[],n=0;n<e.size;n++)r.unshift(t.popValue());t.pushValue(new c.ValueTuple(r)),t.instructionPointer++}},{key:"_stepMakeList",value:function(){for(var t=this._currentFrame(),e=this._currentInstruction(),r=[],n=0;n<e.size;n++)r.unshift(t.popValue());var i=new c.TypeAny,o=0,s=!0,u=!1,l=void 0;try{for(var h,p=r[Symbol.iterator]();!(s=(h=p.next()).done);s=!0){var f=h.value,_=i,m=f.type();i=(0,c.joinTypes)(_,m),null===i&&a(e.startPos,e.endPos,"incompatible-types-on-list-creation",[o,_,m]),o++}}catch(t){u=!0,l=t}finally{try{!s&&p.return&&p.return()}finally{if(u)throw l}}t.pushValue(new c.ValueList(r)),t.instructionPointer++}},{key:"_stepMakeStructure",value:function(){for(var t=this._currentFrame(),e=this._currentInstruction(),r={},n=e.fieldNames.length,i=0;i<n;i++){r[e.fieldNames[n-i-1]]=t.popValue()}t.pushValue(new c.ValueStructure(e.typeName,e.constructorName,r)),t.instructionPointer++}},{key:"_stepUpdateStructure",value:function(){for(var t=this._currentFrame(),e=this._currentInstruction(),r={},n=[],i=e.fieldNames.length,o=0;o<i;o++){var s=e.fieldNames[i-o-1];r[s]=t.popValue(),n.unshift(s)}var u=t.popValue();if(u.tag!==c.V_Structure&&a(e.startPos,e.endPos,"expected-structure-but-got",[e.constructorName,(0,h.i18n)(Symbol.keyFor(u.tag))]),u.constructorName!==e.constructorName&&a(e.startPos,e.endPos,"expected-constructor-but-got",[e.constructorName,u.constructorName]),u.typeName!==e.typeName)throw Error("VM: UpdateStructure instruction does not match type.");var l=!0,p=!1,f=void 0;try{for(var _,m=n[Symbol.iterator]();!(l=(_=m.next()).done);l=!0){var d=_.value,v=u.fields[d].type(),y=r[d].type();null===(0,c.joinTypes)(v,y)&&a(e.startPos,e.endPos,"incompatible-types-on-structure-update",[d,v,y])}}catch(t){p=!0,f=t}finally{try{!l&&m.return&&m.return()}finally{if(p)throw f}}t.pushValue(u.updateFields(r)),t.instructionPointer++}},{key:"_stepReadTupleComponent",value:function(){var t=this._currentFrame(),e=this._currentInstruction(),r=t.stackTop();r.tag!==c.V_Tuple&&a(e.startPos,e.endPos,"expected-tuple-value-but-got",[r.type()]),e.index>=r.size()&&a(e.startPos,e.endPos,"tuple-component-out-of-bounds",[r.size(),e.index]),t.pushValue(r.components[e.index]),t.instructionPointer++}},{key:"_stepReadStructureFieldGeneric",value:function(t){var e=this._currentFrame(),r=this._currentInstruction(),n=void 0;n=t?e.popValue():e.stackTop(),n.tag!==c.V_Structure&&a(r.startPos,r.endPos,"expected-structure-value-but-got",[n.type()]),r.fieldName in n.fields||a(r.startPos,r.endPos,"structure-field-not-present",[n.fieldNames(),r.fieldName]),e.pushValue(n.fields[r.fieldName]),e.instructionPointer++}},{key:"_stepReadStructureField",value:function(){this._stepReadStructureFieldGeneric(!1)}},{key:"_stepReadStructureFieldPop",value:function(){this._stepReadStructureFieldGeneric(!0)}},{key:"_stepAdd",value:function(){var t=this._currentFrame(),e=t.popValue(),r=t.popValue();t.pushValue(e.add(r)),t.instructionPointer++}},{key:"_stepDup",value:function(){var t=this._currentFrame(),e=t.popValue();t.pushValue(e),t.pushValue(e),t.instructionPointer++}},{key:"_stepPop",value:function(){var t=this._currentFrame();t.popValue(),t.instructionPointer++}},{key:"_stepPrimitiveCall",value:function(){for(var t=this._currentFrame(),e=this._currentInstruction(),r=[],n=0;n<e.nargs;n++)r.unshift(t.popValue());this._primitives.isOperation(e.primitiveName)||a(e.startPos,e.endPos,"primitive-does-not-exist",[e.primitiveName]);var i=this._primitives.getOperation(e.primitiveName);i.argumentTypes.length!==e.nargs&&a(e.startPos,e.endPos,"primitive-arity-mismatch",[e.primitiveName,i.argumentTypes.length,e.nargs]);for(var o=0;o<e.nargs;o++){var s=i.argumentTypes[o],u=r[o].type();null===(0,c.joinTypes)(s,u)&&a(e.startPos,e.endPos,"primitive-argument-type-mismatch",[e.primitiveName,o+1,e.nargs,s,u])}i.validateArguments(e.startPos,e.endPos,this.globalState(),r);var l=i.call(this.globalState(),r);null!==l&&t.pushValue(l),this._takeSnapshot(e.primitiveName),t.instructionPointer++}},{key:"_stepSaveState",value:function(){var t=this._currentFrame();this._globalStateStack.push(this.globalState().clone()),t.instructionPointer++}},{key:"_stepRestoreState",value:function(){var t=this._currentFrame();if(this._globalStateStack.pop(),0===this._globalStateStack.length)throw Error("RestoreState: the stack of global states is empty.");t.instructionPointer++}},{key:"_stepTypeCheck",value:function(){var t=this._currentFrame(),e=this._currentInstruction(),r=e.type,n=t.stackTop().type();null===(0,c.joinTypes)(r,n)&&a(e.startPos,e.endPos,"expected-value-of-type-but-got",[r,n]),t.instructionPointer++}},{key:"regionStack",value:function(){var t=[],e=!0,r=!1,n=void 0;try{for(var i,o=this._callStack[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var a=i.value,s=this._code.at(a.instructionPointer);t.push(s.startPos.region)}}catch(t){r=!0,n=t}finally{try{!e&&o.return&&o.return()}finally{if(r)throw n}}return t}}]),t}()},function(t,e,r){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t){var e={};e.head={x:t.head[0],y:t.head[1]},e.width=t.width,e.height=t.height,e.table=[];for(var r=0;r<t.height;r++){for(var n=[],i=0;i<t.width;i++){var o=t.board[i][r],a={};o.a>0&&(a.blue=o.a),o.n>0&&(a.black=o.n),o.r>0&&(a.red=o.r),o.v>0&&(a.green=o.v),n.push(a)}e.table.unshift(n)}return e}function o(t){var e={};e.head=[t.head.x,t.head.y],e.width=t.width,e.height=t.height,e.board=[];for(var r=0;r<e.width;r++){for(var n=[],i=0;i<e.height;i++){var o=t.table[e.height-i-1][r],a="blue"in o?o.blue:0,s="black"in o?o.black:0,u="red"in o?o.red:0,c="green"in o?o.green:0;n.push({a:a,n:s,r:u,v:c})}e.board.push(n)}return e}function a(t){var e={};e.x=t.head[0],e.y=t.head[1],e.sizeX=t.width,e.sizeY=t.height,e.table=[];for(var r=0;r<t.height;r++){for(var n=[],i=0;i<t.width;i++){var o=t.board[i][r];n.push({blue:o.a,black:o.n,red:o.r,green:o.v})}e.table.unshift(n)}return JSON.stringify(e)}function s(t){var e=JSON.parse(t),r={};r.head=[e.x,e.y],r.width=e.sizeX,r.height=e.sizeY,r.board=[];for(var n=0;n<r.width;n++){for(var i=[],o=0;o<r.height;o++){var a=e.table[r.height-o-1][n];i.push({a:a.blue,n:a.black,r:a.red,v:a.green})}r.board.push(i)}return r}function u(t){var e=[];e.push("GBB/1.0"),e.push("size "+t.width.toString()+" "+t.height.toString());for(var r=0;r<t.height;r++)for(var n=0;n<t.width;n++){var i=t.board[n][r];if(i.a+i.n+i.r+i.v!==0){var o="cell "+n.toString()+" "+r.toString();i.a>0&&(o+=" Azul "+i.a.toString()),i.n>0&&(o+=" Negro "+i.n.toString()),i.r>0&&(o+=" Rojo "+i.r.toString()),i.v>0&&(o+=" Verde "+i.v.toString()),e.push(o)}}return e.push("head "+t.head[0].toString()+" "+t.head[1].toString()),e.join("\n")+"\n"}function c(t){function e(t){return" "===t||"\t"===t||"\r"===t||"\n"===t}function r(t){for(var e=0;e<t.length;e++)if(-1==="0123456789".indexOf(t[e]))return!1;return t.length>0}function n(){for(;s<t.length&&e(t[s]);)s++}function i(){var r=[];for(n();s<t.length&&!e(t[s]);)r.push(t[s]),s++;return r.join("")}function o(t){var e=i();if(!r(e))throw Error(t);if((e=parseInt(e,10))<0)throw Error(t);return e}function a(t,e,r){var n=o(r);if(n<t||n>=e)throw Error(r);return n}var s=0,u={};if("GBB/1.0"!==i())throw Error("GBB/1.0: Board not in GBB/1.0 format.");if("size"!==i())throw Error("GBB/1.0: Board lacks a size declaration.");if(u.width=o("GBB/1.0: Board width is not a number."),u.height=o("GBB/1.0: Board height is not a number."),u.width<=0||u.height<=0)throw Error("GBB/1.0: Board size should be positive.");u.head=[0,0],u.board=[];for(var c=0;c<u.width;c++){for(var l=[],h=0;h<u.height;h++)l.push({a:0,n:0,r:0,v:0});u.board.push(l)}for(var p=!1,f={},_={Azul:"a",A:"a",Negro:"n",N:"n",Rojo:"r",R:"r",Verde:"v",V:"v"};s<t.length;){var m=i();if(""===m)break;if("head"===m){if(p)throw Error("GBB/1.0: Head position cannot be declared twice.");p=!0;var d=a(0,u.width,"GBB/1.0: Invalid head position."),v=a(0,u.height,"GBB/1.0: Invalid head position.");u.head=[d,v]}else{if("cell"!==m)throw Error('GBB/1.0: Malformed board: unknown command "'+m+'".');var y=a(0,u.width,"GBB/1.0: Invalid cell position."),g=a(0,u.height,"GBB/1.0: Invalid cell position.");if([y,g]in f)throw Error("GBB/1.0: Cell cannot be declared twice.");f[[y,g]]=!0;for(var b={};s<t.length;){var T=i();if(!(T in _)){s-=T.length;break}var P=_[T];if(P in b)throw Error("GBB/1.0: Color cannot be declared twice.");var S=o("GBB/1.0: Invalid amount of stones.");u.board[y][g][P]=S}}}return u}function l(t){var e=t.split(".");return e[e.length-1]}function h(t){var e=l(t),r=!0,n=!1,i=void 0;try{for(var o,a=d[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){var s=o.value;if(e===s.extension)return s}}catch(t){n=!0,i=t}finally{try{!r&&a.return&&a.return()}finally{if(n)throw i}}return y[v]}function p(t){var e=h(t),r=E.readFileSync(t,"utf8");return e.toJboard(r)}function f(t,e){var r=h(t),n=r.fromJboard(e);E.writeFileSync(t,n,"utf8")}Object.defineProperty(e,"__esModule",{value:!0});var _=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}();e.apiboardFromJboard=i,e.apiboardToJboard=o,e.gbbFromJboard=u,e.gbbToJboard=c,e.readJboardFromFile=p,e.writeJboardToFile=f;var m=function(){function t(e,r,i,o,a){n(this,t),this._formatName=e,this._description=r,this._extension=i,this._fromJboard=o,this._toJboard=a}return _(t,[{key:"formatName",get:function(){return this._formatName}},{key:"description",get:function(){return this._description}},{key:"extension",get:function(){return this._extension}},{key:"fromJboard",get:function(){return this._fromJboard}},{key:"toJboard",get:function(){return this._toJboard}}]),t}(),d=[new m("jboard","Representation of a board as a JavaScript object for internal usage.","jboard",JSON.stringify,JSON.parse),new m("gs-weblang-cli-json-board","Representation of a board as a Javascript object used by the gs-weblang-cli tool.","json",a,s),new m("gbb","GBB/1.0","gbb",u,c)],v=e.DEFAULT_FORMAT="gs-weblang-cli-json-board",y=e.BOARD_FORMATS={},g=!0,b=!1,T=void 0;try{for(var P,S=d[Symbol.iterator]();!(g=(P=S.next()).done);g=!0){var k=P.value;y[k.formatName]=k}}catch(t){b=!0,T=t}finally{try{!g&&S.return&&S.return()}finally{if(b)throw T}}var E=r(22)},function(t,e){}])});