{"version":3,"sources":["electron-runner.js"],"names":["finalhandler","require","http","serveStatic","freeport","path","app","BrowserWindow","ipcMain","globalShortcut","Menu","isMac","process","platform","template","label","getName","submenu","role","type","start","mode","server","createServer","mainWindow","runModeSuffix","runModeTitle","names","preloadScript","join","appFolder","__dirname","serverAddress","port","serve","req","res","customPrompt","promptResponse","on","eventRet","arg","encodeHtmlEntity","str","buf","i","length","unshift","charCodeAt","promptWindow","width","height","show","resizable","movable","alwaysOnTop","frame","val","promptHtml","title","loadURL","returnValue","event","createWindow","icon","getVersion","webPreferences","nodeIntegration","preload","webSecurity","menu","buildFromTemplate","setApplicationMenu","maximize","ev","preventDefault","err","listen","register","reload","webContents","reloadIgnoringCache","openDevTools","unregister","quit","module","exports"],"mappings":"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","file":"electron-runner.js","sourcesContent":["// Import required libraries\nconst finalhandler = require('finalhandler');\nconst http = require('http');\nconst serveStatic = require('serve-static');\nconst freeport = require('freeport');\nconst path = require('path');\nconst {app, BrowserWindow, ipcMain, globalShortcut, Menu} = require('electron');\n\n  isMac = process.platform === 'darwin';\n\n  const template = [\n   // { role: 'appMenu' }\n   ...(isMac ? [{\n     label: app.getName(),\n     submenu: [\n       { role: 'about',\n         label: 'Acerca de Gobstones' },\n       { type: 'separator' },\n       { role: 'hide',\n         label: 'Ocultar Gobstones' },\n       { role: 'hideothers',\n         label: 'Ocultar otros' },\n       { role: 'unhide',\n         label: 'Mostrar Gobstones' },\n       { type: 'separator' },\n       { role: 'quit',\n         label: 'Salir de Gobstones'}\n     ]\n   }] : [\n     {\n       label: 'Archivo',\n       submenu: [\n         { role: 'quit',\n           label: 'Salir de Gobstones' }\n       ]\n     }\n   ])\n   ,\n   // { role: 'editMenu' }\n   {\n     label: 'Editar',\n     submenu: [\n       { role: 'undo',\n         label: 'Deshacer' },\n       { role: 'redo',\n         label: 'Rehacer' },\n       { type: 'separator' },\n       { role: 'cut',\n         label: 'Cortar' },\n       { role: 'copy',\n         label: 'Copiar' },\n       { role: 'paste',\n         label: 'Pegar' },\n       { type: 'separator' },\n       { role: 'delete',\n         label: 'Borrar' },\n       { type: 'separator' },\n       { role: 'selectAll',\n         label: 'Seleccionar todo'}\n     ]\n   },\n   // { role: 'viewMenu' }\n   {\n     label: 'Vista',\n     submenu: [\n       { role: 'reload',\n         label: 'Recargar'},\n       { role: 'forcereload',\n         label: 'Forzar Recarga'},\n       { role: 'toggledevtools',\n         label: 'Mostrar herramientas de desarrollador'},\n       { type: 'separator' },\n       { role: 'resetzoom',\n         label: 'TamaÃ±o original'},\n       { role: 'zoomin',\n         label: 'Acercar'},\n       { role: 'zoomout',\n         label: 'Alejar'},\n       { type: 'separator' },\n       { role: 'togglefullscreen',\n         label: 'Mostrar en pantalla completa'}\n     ]\n   },\n   // { role: 'windowMenu' }\n   {\n     label: 'Ventana',\n     submenu: [\n       { role: 'minimize',\n         label: 'Minimizar' },\n       { role: 'zoom',\n         label: 'Acercarse'},\n       ...(isMac ? [\n         { type: 'separator' },\n         { role: 'front',\n           label: 'Traer al frente' },\n         { type: 'separator' },\n         { role: 'window',\n           label: 'Ventana'}\n       ] : [\n         { role: 'close',\n           label: 'Cerrar'}\n       ])\n     ]\n   },\n ]\n\n\nfunction start(mode) {\n  // The running node.js server, the main app window\n  // are all global to the function\n  const server = createServer();\n  let mainWindow;\n\n  // Useful functions\n  function runModeSuffix(mode) {\n    return mode ? ('#/' + mode) : ''\n  }\n\n  function runModeTitle(mode) {\n    const names = {\n      'code': 'Gobstones Sr.',\n      'blocks': 'Gobstones Jr.',\n      'teacher': 'Gobstones Teacher',\n    }\n    return mode ? names[mode] :'Gobstones'\n  }\n\n  function preloadScript() {\n    return path.join(appFolder(), 'electron-preload.js');\n  }\n\n  function appFolder() {\n    return __dirname;\n  }\n\n  function serverAddress(port) {\n    return `http://localhost:${port}/` + runModeSuffix(mode);\n  }\n\n  function createServer() {\n    const serve = serveStatic(appFolder(), { 'index': ['index.html'] });\n\n    return http.createServer((req, res) => {\n      serve(req, res, finalhandler(req, res));\n    });\n  }\n\n  function customPrompt() {\n    var promptResponse;\n    ipcMain.on('prompt', function(eventRet, arg) {\n      var encodeHtmlEntity = function(str) {\n        var buf = [];\n        for (var i=str.length-1;i>=0;i--) {\n          buf.unshift(['&#', str[i].charCodeAt(), ';'].join(''));\n        }\n        return buf.join('');\n      };\n      promptResponse = null\n      var promptWindow = new BrowserWindow({\n        width: 400,\n        height: 200,\n        show: false,\n        resizable: false,\n        movable: false,\n        alwaysOnTop: true,\n        frame: false\n      })\n      arg.val = arg.val || ''\n      const promptHtml = '<form><label for=\"val\">' + encodeHtmlEntity(arg.title) + '</label>\\\n      <input id=\"val\" value=\"' + arg.val + '\" autofocus />\\\n      <button type=\"submit\" onclick=\"require(\\'electron\\').ipcRenderer.send(\\'prompt-response\\', document.getElementById(\\'val\\').value);window.close()\">Ok</button>\\\n      <button type=\"cancel\" onclick=\"window.close()\">Cancel</button>\\\n      <style>body {font-family: sans-serif;} button {float:right; margin-left: 10px;} label,input {margin-bottom: 10px; width: 100%; display:block;}</style></form>'\n      promptWindow.loadURL('data:text/html,' + promptHtml)\n      promptWindow.show()\n      promptWindow.on('closed', function() {\n        eventRet.returnValue = promptResponse\n        promptWindow = null\n      })\n    })\n    ipcMain.on('prompt-response', function(event, arg) {\n      if (arg === ''){ arg = null }\n      promptResponse = arg\n    })\n  }\n\n  function createWindow(port) {\n    mainWindow = new BrowserWindow({\n      width: 1024,\n      height: 800,\n      icon: path.join(appFolder(), 'favicon.ico'),\n      title: runModeTitle(mode) + \" \" + `v${app.getVersion()}`,\n      webPreferences: {\n        nodeIntegration: true,\n        preload: preloadScript(),\n        webSecurity: false\n      }\n    });\n    const menu = Menu.buildFromTemplate(template)\n    Menu.setApplicationMenu(menu)\n    mainWindow.loadURL(serverAddress(port));\n    mainWindow.maximize();\n    mainWindow.on('closed', () => mainWindow = null);\n    mainWindow.on('page-title-updated', (ev) => ev.preventDefault());\n    return mainWindow;\n  }\n\n  // Run the application\n  freeport((err, port) => {\n    if (err) throw err;\n    server.listen(port);\n    // Configure custom prompt\n    customPrompt()\n    // Configure electron app default actions\n    app.on('ready', () => {\n      globalShortcut.register('CommandOrControl+R', () => {\n        mainWindow.reload();\n      });\n      globalShortcut.register('CommandOrControl+Shift+R', () => {\n        mainWindow.webContents.reloadIgnoringCache();\n      });\n      globalShortcut.register('CommandOrControl+Shift+I', () => {\n        mainWindow.webContents.openDevTools();\n      });\n      mainWindow = createWindow(port)\n    });\n\n    app.on('window-all-closed', () => {\n      globalShortcut.unregister('CommandOrControl+R');\n      globalShortcut.unregister('CommandOrControl+Shift+R');\n      globalShortcut.unregister('CommandOrControl+Shift+I');\n      if (process.platform !== 'darwin') {\n        app.quit()\n      };\n    });\n\n    app.on('activate', () => {\n      if (mainWindow === null) { mainWindow = createWindow(port); }\n    });\n  })\n}\n\nmodule.exports = start\n"]}